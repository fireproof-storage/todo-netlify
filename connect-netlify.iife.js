"use strict";var FireproofConnect=(()=>{var kn=Object.defineProperty;var Lp=Object.getOwnPropertyDescriptor;var Ip=Object.getOwnPropertyNames;var Up=Object.prototype.hasOwnProperty;var Dp=(e,t,r)=>t in e?kn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Np=(e,t)=>{for(var r in t)kn(e,r,{get:t[r],enumerable:!0})},jp=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ip(t))!Up.call(e,i)&&i!==r&&kn(e,i,{get:()=>t[i],enumerable:!(n=Lp(t,i))||n.enumerable});return e};var zp=e=>jp(kn({},"__esModule",{value:!0}),e);var cl=(e,t,r)=>(Dp(e,typeof t!="symbol"?t+"":t,r),r);var p4={};Np(p4,{ConnectNetlify:()=>mn,connect:()=>d4});var wl="3.7.5",Mp=wl,Op=typeof atob=="function",$p=typeof btoa=="function",Qt=typeof Buffer=="function",hl=typeof TextDecoder=="function"?new TextDecoder:void 0,fl=typeof TextEncoder=="function"?new TextEncoder:void 0,Pp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Br=Array.prototype.slice.call(Pp),En=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(Br),Rp=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,oe=String.fromCharCode.bind(String),dl=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),gl=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_"),bl=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),ml=e=>{let t,r,n,i,o="",s=e.length%3;for(let a=0;a<e.length;){if((r=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|i,o+=Br[t>>18&63]+Br[t>>12&63]+Br[t>>6&63]+Br[t&63]}return s?o.slice(0,s-3)+"===".substring(s):o},lo=$p?e=>btoa(e):Qt?e=>Buffer.from(e,"binary").toString("base64"):ml,so=Qt?e=>Buffer.from(e).toString("base64"):e=>{let r=[];for(let n=0,i=e.length;n<i;n+=4096)r.push(oe.apply(null,e.subarray(n,n+4096)));return lo(r.join(""))},Sn=(e,t=!1)=>t?gl(so(e)):so(e),Hp=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?oe(192|t>>>6)+oe(128|t&63):oe(224|t>>>12&15)+oe(128|t>>>6&63)+oe(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return oe(240|t>>>18&7)+oe(128|t>>>12&63)+oe(128|t>>>6&63)+oe(128|t&63)}},Vp=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,vl=e=>e.replace(Vp,Hp),pl=Qt?e=>Buffer.from(e,"utf8").toString("base64"):fl?e=>so(fl.encode(e)):e=>lo(vl(e)),Jt=(e,t=!1)=>t?gl(pl(e)):pl(e),yl=e=>Jt(e,!0),qp=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Wp=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return oe((r>>>10)+55296)+oe((r&1023)+56320);case 3:return oe((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return oe((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},kl=e=>e.replace(qp,Wp),El=e=>{if(e=e.replace(/\s+/g,""),!Rp.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,i;for(let o=0;o<e.length;)t=En[e.charAt(o++)]<<18|En[e.charAt(o++)]<<12|(n=En[e.charAt(o++)])<<6|(i=En[e.charAt(o++)]),r+=n===64?oe(t>>16&255):i===64?oe(t>>16&255,t>>8&255):oe(t>>16&255,t>>8&255,t&255);return r},uo=Op?e=>atob(bl(e)):Qt?e=>Buffer.from(e,"base64").toString("binary"):El,Sl=Qt?e=>dl(Buffer.from(e,"base64")):e=>dl(uo(e).split("").map(t=>t.charCodeAt(0))),xl=e=>Sl(Al(e)),Gp=Qt?e=>Buffer.from(e,"base64").toString("utf8"):hl?e=>hl.decode(Sl(e)):e=>kl(uo(e)),Al=e=>bl(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),ao=e=>Gp(Al(e)),Kp=e=>{if(typeof e!="string")return!1;let t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},Cl=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),Tl=function(){let e=(t,r)=>Object.defineProperty(String.prototype,t,Cl(r));e("fromBase64",function(){return ao(this)}),e("toBase64",function(t){return Jt(this,t)}),e("toBase64URI",function(){return Jt(this,!0)}),e("toBase64URL",function(){return Jt(this,!0)}),e("toUint8Array",function(){return xl(this)})},Bl=function(){let e=(t,r)=>Object.defineProperty(Uint8Array.prototype,t,Cl(r));e("toBase64",function(t){return Sn(this,t)}),e("toBase64URI",function(){return Sn(this,!0)}),e("toBase64URL",function(){return Sn(this,!0)})},Jp=()=>{Tl(),Bl()},Fr={version:wl,VERSION:Mp,atob:uo,atobPolyfill:El,btoa:lo,btoaPolyfill:ml,fromBase64:ao,toBase64:Jt,encode:Jt,encodeURI:yl,encodeURL:yl,utob:vl,btou:kl,decode:ao,isValid:Kp,fromUint8Array:Sn,toUint8Array:xl,extendString:Tl,extendUint8Array:Bl,extendBuiltins:Jp};var Qp=Object.create,Ci=Object.defineProperty,Zp=Object.getOwnPropertyDescriptor,Yp=Object.getOwnPropertyNames,Xp=Object.getPrototypeOf,ey=Object.prototype.hasOwnProperty,ty=(e,t,r)=>t in e?Ci(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ry=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ny=(e,t)=>{for(var r in t)Ci(e,r,{get:t[r],enumerable:!0})},iy=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Yp(t))!ey.call(e,i)&&i!==r&&Ci(e,i,{get:()=>t[i],enumerable:!(n=Zp(t,i))||n.enumerable});return e},oy=(e,t,r)=>(r=e!=null?Qp(Xp(e)):{},iy(t||!e||!e.__esModule?Ci(r,"default",{value:e,enumerable:!0}):r,e)),Ee=(e,t,r)=>(ty(e,typeof t!="symbol"?t+"":t,r),r),lc=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},Zt=(e,t,r)=>(lc(e,t,"read from private field"),r?r.call(e):t.get(e)),sy=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},ay=(e,t,r,n)=>(lc(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),ly=ry((e,t)=>{var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global,n=function(){function o(){this.fetch=!1,this.DOMException=r.DOMException}return o.prototype=r,new o}();(function(o){var s=function(a){var l=typeof o<"u"&&o||typeof self<"u"&&self||typeof l<"u"&&l,u={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function c(E){return E&&DataView.prototype.isPrototypeOf(E)}if(u.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],w=ArrayBuffer.isView||function(E){return E&&f.indexOf(Object.prototype.toString.call(E))>-1};function p(E){if(typeof E!="string"&&(E=String(E)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(E)||E==="")throw new TypeError('Invalid character in header field name: "'+E+'"');return E.toLowerCase()}function d(E){return typeof E!="string"&&(E=String(E)),E}function h(E){var _={next:function(){var R=E.shift();return{done:R===void 0,value:R}}};return u.iterable&&(_[Symbol.iterator]=function(){return _}),_}function y(E){this.map={},E instanceof y?E.forEach(function(_,R){this.append(R,_)},this):Array.isArray(E)?E.forEach(function(_){this.append(_[0],_[1])},this):E&&Object.getOwnPropertyNames(E).forEach(function(_){this.append(_,E[_])},this)}y.prototype.append=function(E,_){E=p(E),_=d(_);var R=this.map[E];this.map[E]=R?R+", "+_:_},y.prototype.delete=function(E){delete this.map[p(E)]},y.prototype.get=function(E){return E=p(E),this.has(E)?this.map[E]:null},y.prototype.has=function(E){return this.map.hasOwnProperty(p(E))},y.prototype.set=function(E,_){this.map[p(E)]=d(_)},y.prototype.forEach=function(E,_){for(var R in this.map)this.map.hasOwnProperty(R)&&E.call(_,this.map[R],R,this)},y.prototype.keys=function(){var E=[];return this.forEach(function(_,R){E.push(R)}),h(E)},y.prototype.values=function(){var E=[];return this.forEach(function(_){E.push(_)}),h(E)},y.prototype.entries=function(){var E=[];return this.forEach(function(_,R){E.push([R,_])}),h(E)},u.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function g(E){if(E.bodyUsed)return Promise.reject(new TypeError("Already read"));E.bodyUsed=!0}function m(E){return new Promise(function(_,R){E.onload=function(){_(E.result)},E.onerror=function(){R(E.error)}})}function b(E){var _=new FileReader,R=m(_);return _.readAsArrayBuffer(E),R}function v(E){var _=new FileReader,R=m(_);return _.readAsText(E),R}function S(E){for(var _=new Uint8Array(E),R=new Array(_.length),ee=0;ee<_.length;ee++)R[ee]=String.fromCharCode(_[ee]);return R.join("")}function T(E){if(E.slice)return E.slice(0);var _=new Uint8Array(E.byteLength);return _.set(new Uint8Array(E)),_.buffer}function B(){return this.bodyUsed=!1,this._initBody=function(E){this.bodyUsed=this.bodyUsed,this._bodyInit=E,E?typeof E=="string"?this._bodyText=E:u.blob&&Blob.prototype.isPrototypeOf(E)?this._bodyBlob=E:u.formData&&FormData.prototype.isPrototypeOf(E)?this._bodyFormData=E:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)?this._bodyText=E.toString():u.arrayBuffer&&u.blob&&c(E)?(this._bodyArrayBuffer=T(E.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(E)||w(E))?this._bodyArrayBuffer=T(E):this._bodyText=E=Object.prototype.toString.call(E):this._bodyText="",this.headers.get("content-type")||(typeof E=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(E)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var E=g(this);if(E)return E;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var E=g(this);return E||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(b)}),this.text=function(){var E=g(this);if(E)return E;if(this._bodyBlob)return v(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(S(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(Wt)}),this.json=function(){return this.text().then(JSON.parse)},this}var N=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function L(E){var _=E.toUpperCase();return N.indexOf(_)>-1?_:E}function Q(E,_){if(!(this instanceof Q))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');_=_||{};var R=_.body;if(E instanceof Q){if(E.bodyUsed)throw new TypeError("Already read");this.url=E.url,this.credentials=E.credentials,_.headers||(this.headers=new y(E.headers)),this.method=E.method,this.mode=E.mode,this.signal=E.signal,!R&&E._bodyInit!=null&&(R=E._bodyInit,E.bodyUsed=!0)}else this.url=String(E);if(this.credentials=_.credentials||this.credentials||"same-origin",(_.headers||!this.headers)&&(this.headers=new y(_.headers)),this.method=L(_.method||this.method||"GET"),this.mode=_.mode||this.mode||null,this.signal=_.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&R)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(R),(this.method==="GET"||this.method==="HEAD")&&(_.cache==="no-store"||_.cache==="no-cache")){var ee=/([?&])_=[^&]*/;if(ee.test(this.url))this.url=this.url.replace(ee,"$1_="+new Date().getTime());else{var te=/\?/;this.url+=(te.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Q.prototype.clone=function(){return new Q(this,{body:this._bodyInit})};function Wt(E){var _=new FormData;return E.trim().split("&").forEach(function(R){if(R){var ee=R.split("="),te=ee.shift().replace(/\+/g," "),J=ee.join("=").replace(/\+/g," ");_.append(decodeURIComponent(te),decodeURIComponent(J))}}),_}function Gt(E){var _=new y,R=E.replace(/\r?\n[\t ]+/g," ");return R.split("\r").map(function(ee){return ee.indexOf(`
`)===0?ee.substr(1,ee.length):ee}).forEach(function(ee){var te=ee.split(":"),J=te.shift().trim();if(J){var vn=te.join(":").trim();_.append(J,vn)}}),_}B.call(Q.prototype);function de(E,_){if(!(this instanceof de))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');_||(_={}),this.type="default",this.status=_.status===void 0?200:_.status,this.ok=this.status>=200&&this.status<300,this.statusText=_.statusText===void 0?"":""+_.statusText,this.headers=new y(_.headers),this.url=_.url||"",this._initBody(E)}B.call(de.prototype),de.prototype.clone=function(){return new de(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},de.error=function(){var E=new de(null,{status:0,statusText:""});return E.type="error",E};var Kt=[301,302,303,307,308];de.redirect=function(E,_){if(Kt.indexOf(_)===-1)throw new RangeError("Invalid status code");return new de(null,{status:_,headers:{location:E}})},a.DOMException=l.DOMException;try{new a.DOMException}catch{a.DOMException=function(E,_){this.message=E,this.name=_;var R=Error(E);this.stack=R.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function P(E,_){return new Promise(function(R,ee){var te=new Q(E,_);if(te.signal&&te.signal.aborted)return ee(new a.DOMException("Aborted","AbortError"));var J=new XMLHttpRequest;function vn(){J.abort()}J.onload=function(){var Ae={status:J.status,statusText:J.statusText,headers:Gt(J.getAllResponseHeaders()||"")};Ae.url="responseURL"in J?J.responseURL:Ae.headers.get("X-Request-URL");var oo="response"in J?J.response:J.responseText;setTimeout(function(){R(new de(oo,Ae))},0)},J.onerror=function(){setTimeout(function(){ee(new TypeError("Network request failed"))},0)},J.ontimeout=function(){setTimeout(function(){ee(new TypeError("Network request failed"))},0)},J.onabort=function(){setTimeout(function(){ee(new a.DOMException("Aborted","AbortError"))},0)};function _p(Ae){try{return Ae===""&&l.location.href?l.location.href:Ae}catch{return Ae}}J.open(te.method,_p(te.url),!0),te.credentials==="include"?J.withCredentials=!0:te.credentials==="omit"&&(J.withCredentials=!1),"responseType"in J&&(u.blob?J.responseType="blob":u.arrayBuffer&&te.headers.get("Content-Type")&&te.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(J.responseType="arraybuffer")),_&&typeof _.headers=="object"&&!(_.headers instanceof y)?Object.getOwnPropertyNames(_.headers).forEach(function(Ae){J.setRequestHeader(Ae,d(_.headers[Ae]))}):te.headers.forEach(function(Ae,oo){J.setRequestHeader(oo,Ae)}),te.signal&&(te.signal.addEventListener("abort",vn),J.onreadystatechange=function(){J.readyState===4&&te.signal.removeEventListener("abort",vn)}),J.send(typeof te._bodyInit>"u"?null:te._bodyInit)})}return P.polyfill=!0,l.fetch||(l.fetch=P,l.Headers=y,l.Request=Q,l.Response=de),a.Headers=y,a.Request=Q,a.Response=de,a.fetch=P,a}({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=r.fetch?r:n;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e}),uy=Object.create,Ti=Object.defineProperty,cy=Object.getOwnPropertyDescriptor,uc=Object.getOwnPropertyNames,hy=Object.getPrototypeOf,fy=Object.prototype.hasOwnProperty,dy=(e,t,r)=>t in e?Ti(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,K=(e,t)=>function(){return t||(0,e[uc(e)[0]])((t={exports:{}}).exports,t),t.exports},ie=(e,t)=>{for(var r in t)Ti(e,r,{get:t[r],enumerable:!0})},py=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of uc(t))!fy.call(e,i)&&i!==r&&Ti(e,i,{get:()=>t[i],enumerable:!(n=cy(t,i))||n.enumerable});return e},X=(e,t,r)=>(r=e!=null?uy(hy(e)):{},py(t||!e||!e.__esModule?Ti(r,"default",{value:e,enumerable:!0}):r,e)),x=(e,t,r)=>(dy(e,typeof t!="symbol"?t+"":t,r),r),cc=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},be=(e,t,r)=>(cc(e,t,"read from private field"),r?r.call(e):t.get(e)),ar=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Me=(e,t,r,n)=>(cc(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Fl=(e,t,r,n)=>({set _(i){Me(e,t,i,r)},get _(){return be(e,t,n)}}),yy=K({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/encode.js"(e,t){t.exports=s;var r=128,n=127,i=~n,o=Math.pow(2,31);function s(a,l,u){if(Number.MAX_SAFE_INTEGER&&a>Number.MAX_SAFE_INTEGER)throw s.bytes=0,new RangeError("Could not encode varint");l=l||[],u=u||0;for(var c=u;a>=o;)l[u++]=a&255|r,a/=128;for(;a&i;)l[u++]=a&255|r,a>>>=7;return l[u]=a|0,s.bytes=u-c+1,l}}}),wy=K({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/decode.js"(e,t){t.exports=i;var r=128,n=127;function i(o,l){var a=0,l=l||0,u=0,c=l,f,w=o.length;do{if(c>=w||u>49)throw i.bytes=0,new RangeError("Could not decode varint");f=o[c++],a+=u<28?(f&n)<<u:(f&n)*Math.pow(2,u),u+=7}while(f>=r);return i.bytes=c-l,a}}}),gy=K({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/length.js"(e,t){var r=Math.pow(2,7),n=Math.pow(2,14),i=Math.pow(2,21),o=Math.pow(2,28),s=Math.pow(2,35),a=Math.pow(2,42),l=Math.pow(2,49),u=Math.pow(2,56),c=Math.pow(2,63);t.exports=function(f){return f<r?1:f<n?2:f<i?3:f<o?4:f<s?5:f<a?6:f<l?7:f<u?8:f<c?9:10}}}),fs=K({"../../node_modules/.pnpm/varint@6.0.0/node_modules/varint/index.js"(e,t){t.exports={encode:yy(),decode:wy(),encodingLength:gy()}}}),by=K({"../../node_modules/.pnpm/charwise@3.0.1/node_modules/charwise/codec/number.js"(e){e.encode=function(n){if(isNaN(n))return"DaN";if(n===0)return"FE  0M0";if(n===1/0)return"FF";if(n===-1/0)return"DD";var i=n.toExponential().split("e"),o=Number(i[1])+500,s=i[0]+(i[0].indexOf(".")===-1?".":"")+"0".repeat(20),a="E"+r(String(o),3)+"M"+String(s);return n>0?"F"+a:"D"+t(a)},e.decode=function(n){if(n==="DaN")return NaN;if(n==="FF")return 1/0;if(n==="DD")return-1/0;var i=n[0]==="D",o=(i?t(n):n).slice(2).split("M");return+((i?"-":"")+o[1]+"e"+String(Number(o[0])-500))};function t(n){for(var i="",o=0;o<n.length;o++){var s=n[o];isNaN(Number(s))||s===" "?s!=="-"&&(i+=s):i+=String(9-Number(s))}return i}function r(n,i){return" ".repeat(i-n.length).substr(0,i)+n}}}),my=K({"../../node_modules/.pnpm/charwise@3.0.1/node_modules/charwise/codec/object.js"(e){var t={"?":"?@","!":"??",'"':"?%"};function r(o){return/[!"]/.test(o)?o.replace(/[\?!"]/g,function(s){return t[s]}):o}var n={"?@":"?","??":"!","?%":'"'};function i(o){return/\?[%\?@]/.test(o)?o.replace(/\?[%\?@]/g,function(s){return n[s]}):o}e.factory=function(o){return{encode:s,decode:l};function s(u){if(u===null)return"A";if(!Array.isArray(u))throw new Error("can only encode arrays");var c=u.length;if(c==0)return"K!";for(var f=a(u[0]),w=1;w<c;w++)f+='"'+a(u[w]);return"K"+f+"!"}function a(u){return typeof u=="object"?s(u):r(o.encode(u))}function l(u){if(u==="A")return null;if(u==="K!")return[];for(var c=u.split('"'),f=[[]],w,p=0,d=c.length,h=0;h<d;h++){for(var y=c[h],g=y.length,m=0;y[m]=="K";)m++;for(var b=0;y[g-b-1]=="!";)b++;for(var v=y.slice(m,g-b),S=p+m,T=p;T<S;T++)f[T+1]=[],f[T].push(f[T+1]),p=S,w=f[p];v.length!==0&&w.push(o.decode(i(v)));for(var S=p-b,T=S;T<p;T++)f[T+1]=[],p=S,w=f[p]}return f[0][0]}}}}),vy=K({"../../node_modules/.pnpm/charwise@3.0.1/node_modules/charwise/index.js"(e){var t=by(),r=my(),n=e.flip=function(o){var s=o.toString(),a="";for(var l in s)a+=s[l]=="."?".":9-+s[l];return a};e.number=t,e.string={encode:function(o){return/\x00|\x01/.test(o)?"J"+o.replace(/\x01/g,"").replace(/\x00/g,""):"J"+o},decode:function(o){if(o[0]==="J")return o.substring(1)}},e.encode=function(o){return e[typeof o].encode(o)},e.decode=function(o){if(o==="")return o;if(!i[o[0]])throw new Error("no decoder for:"+JSON.stringify(o));return i[o[0]](o)},e.object=r.factory(e),e.boolean={encode:function(o){return o?"C":"B"},decode:function(o){return o==="C"}},e.undefined={encode:function(o){return"L"},decode:function(){}};var i={A:e.object.decode,B:e.boolean.decode,C:e.boolean.decode,D:e.number.decode,F:e.number.decode,J:e.string.decode,K:e.object.decode,L:e.undefined.decode};e.buffer=!1,e.type="charwise"}}),ky=K({"../../node_modules/.pnpm/@protobufjs+aspromise@1.1.2/node_modules/@protobufjs/aspromise/index.js"(e,t){"use strict";t.exports=r;function r(n,i){for(var o=new Array(arguments.length-1),s=0,a=2,l=!0;a<arguments.length;)o[s++]=arguments[a++];return new Promise(function(u,c){o[s]=function(f){if(l)if(l=!1,f)c(f);else{for(var w=new Array(arguments.length-1),p=0;p<w.length;)w[p++]=arguments[p];u.apply(null,w)}};try{n.apply(i||null,o)}catch(f){l&&(l=!1,c(f))}})}}}),Ey=K({"../../node_modules/.pnpm/@protobufjs+base64@1.1.2/node_modules/@protobufjs/base64/index.js"(e){"use strict";var t=e;t.length=function(s){var a=s.length;if(!a)return 0;for(var l=0;--a%4>1&&s.charAt(a)==="=";)++l;return Math.ceil(s.length*3)/4-l};var r=new Array(64),n=new Array(123);for(i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;var i;t.encode=function(s,a,l){for(var u=null,c=[],f=0,w=0,p;a<l;){var d=s[a++];switch(w){case 0:c[f++]=r[d>>2],p=(d&3)<<4,w=1;break;case 1:c[f++]=r[p|d>>4],p=(d&15)<<2,w=2;break;case 2:c[f++]=r[p|d>>6],c[f++]=r[d&63],w=0;break}f>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,c)),f=0)}return w&&(c[f++]=r[p],c[f++]=61,w===1&&(c[f++]=61)),u?(f&&u.push(String.fromCharCode.apply(String,c.slice(0,f))),u.join("")):String.fromCharCode.apply(String,c.slice(0,f))};var o="invalid encoding";t.decode=function(s,a,l){for(var u=l,c=0,f,w=0;w<s.length;){var p=s.charCodeAt(w++);if(p===61&&c>1)break;if((p=n[p])===void 0)throw Error(o);switch(c){case 0:f=p,c=1;break;case 1:a[l++]=f<<2|(p&48)>>4,f=p,c=2;break;case 2:a[l++]=(f&15)<<4|(p&60)>>2,f=p,c=3;break;case 3:a[l++]=(f&3)<<6|p,c=0;break}}if(c===1)throw Error(o);return l-u},t.test=function(s){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(s)}}}),Sy=K({"../../node_modules/.pnpm/@protobufjs+eventemitter@1.1.0/node_modules/@protobufjs/eventemitter/index.js"(e,t){"use strict";t.exports=r;function r(){this._listeners={}}r.prototype.on=function(n,i,o){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:i,ctx:o||this}),this},r.prototype.off=function(n,i){if(n===void 0)this._listeners={};else if(i===void 0)this._listeners[n]=[];else for(var o=this._listeners[n],s=0;s<o.length;)o[s].fn===i?o.splice(s,1):++s;return this},r.prototype.emit=function(n){var i=this._listeners[n];if(i){for(var o=[],s=1;s<arguments.length;)o.push(arguments[s++]);for(s=0;s<i.length;)i[s].fn.apply(i[s++].ctx,o)}return this}}}),xy=K({"../../node_modules/.pnpm/@protobufjs+float@1.0.2/node_modules/@protobufjs/float/index.js"(e,t){"use strict";t.exports=r(r);function r(a){return typeof Float32Array<"u"?function(){var l=new Float32Array([-0]),u=new Uint8Array(l.buffer),c=u[3]===128;function f(h,y,g){l[0]=h,y[g]=u[0],y[g+1]=u[1],y[g+2]=u[2],y[g+3]=u[3]}function w(h,y,g){l[0]=h,y[g]=u[3],y[g+1]=u[2],y[g+2]=u[1],y[g+3]=u[0]}a.writeFloatLE=c?f:w,a.writeFloatBE=c?w:f;function p(h,y){return u[0]=h[y],u[1]=h[y+1],u[2]=h[y+2],u[3]=h[y+3],l[0]}function d(h,y){return u[3]=h[y],u[2]=h[y+1],u[1]=h[y+2],u[0]=h[y+3],l[0]}a.readFloatLE=c?p:d,a.readFloatBE=c?d:p}():function(){function l(c,f,w,p){var d=f<0?1:0;if(d&&(f=-f),f===0)c(1/f>0?0:2147483648,w,p);else if(isNaN(f))c(2143289344,w,p);else if(f>34028234663852886e22)c((d<<31|2139095040)>>>0,w,p);else if(f<11754943508222875e-54)c((d<<31|Math.round(f/1401298464324817e-60))>>>0,w,p);else{var h=Math.floor(Math.log(f)/Math.LN2),y=Math.round(f*Math.pow(2,-h)*8388608)&8388607;c((d<<31|h+127<<23|y)>>>0,w,p)}}a.writeFloatLE=l.bind(null,n),a.writeFloatBE=l.bind(null,i);function u(c,f,w){var p=c(f,w),d=(p>>31)*2+1,h=p>>>23&255,y=p&8388607;return h===255?y?NaN:d*(1/0):h===0?d*1401298464324817e-60*y:d*Math.pow(2,h-150)*(y+8388608)}a.readFloatLE=u.bind(null,o),a.readFloatBE=u.bind(null,s)}(),typeof Float64Array<"u"?function(){var l=new Float64Array([-0]),u=new Uint8Array(l.buffer),c=u[7]===128;function f(h,y,g){l[0]=h,y[g]=u[0],y[g+1]=u[1],y[g+2]=u[2],y[g+3]=u[3],y[g+4]=u[4],y[g+5]=u[5],y[g+6]=u[6],y[g+7]=u[7]}function w(h,y,g){l[0]=h,y[g]=u[7],y[g+1]=u[6],y[g+2]=u[5],y[g+3]=u[4],y[g+4]=u[3],y[g+5]=u[2],y[g+6]=u[1],y[g+7]=u[0]}a.writeDoubleLE=c?f:w,a.writeDoubleBE=c?w:f;function p(h,y){return u[0]=h[y],u[1]=h[y+1],u[2]=h[y+2],u[3]=h[y+3],u[4]=h[y+4],u[5]=h[y+5],u[6]=h[y+6],u[7]=h[y+7],l[0]}function d(h,y){return u[7]=h[y],u[6]=h[y+1],u[5]=h[y+2],u[4]=h[y+3],u[3]=h[y+4],u[2]=h[y+5],u[1]=h[y+6],u[0]=h[y+7],l[0]}a.readDoubleLE=c?p:d,a.readDoubleBE=c?d:p}():function(){function l(c,f,w,p,d,h){var y=p<0?1:0;if(y&&(p=-p),p===0)c(0,d,h+f),c(1/p>0?0:2147483648,d,h+w);else if(isNaN(p))c(0,d,h+f),c(2146959360,d,h+w);else if(p>17976931348623157e292)c(0,d,h+f),c((y<<31|2146435072)>>>0,d,h+w);else{var g;if(p<22250738585072014e-324)g=p/5e-324,c(g>>>0,d,h+f),c((y<<31|g/4294967296)>>>0,d,h+w);else{var m=Math.floor(Math.log(p)/Math.LN2);m===1024&&(m=1023),g=p*Math.pow(2,-m),c(g*4503599627370496>>>0,d,h+f),c((y<<31|m+1023<<20|g*1048576&1048575)>>>0,d,h+w)}}}a.writeDoubleLE=l.bind(null,n,0,4),a.writeDoubleBE=l.bind(null,i,4,0);function u(c,f,w,p,d){var h=c(p,d+f),y=c(p,d+w),g=(y>>31)*2+1,m=y>>>20&2047,b=4294967296*(y&1048575)+h;return m===2047?b?NaN:g*(1/0):m===0?g*5e-324*b:g*Math.pow(2,m-1075)*(b+4503599627370496)}a.readDoubleLE=u.bind(null,o,0,4),a.readDoubleBE=u.bind(null,s,4,0)}(),a}function n(a,l,u){l[u]=a&255,l[u+1]=a>>>8&255,l[u+2]=a>>>16&255,l[u+3]=a>>>24}function i(a,l,u){l[u]=a>>>24,l[u+1]=a>>>16&255,l[u+2]=a>>>8&255,l[u+3]=a&255}function o(a,l){return(a[l]|a[l+1]<<8|a[l+2]<<16|a[l+3]<<24)>>>0}function s(a,l){return(a[l]<<24|a[l+1]<<16|a[l+2]<<8|a[l+3])>>>0}}}),Ay=K({"../../node_modules/.pnpm/@protobufjs+inquire@1.1.0/node_modules/@protobufjs/inquire/index.js"(exports,module){"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}}}),Cy=K({"../../node_modules/.pnpm/@protobufjs+utf8@1.1.0/node_modules/@protobufjs/utf8/index.js"(e){"use strict";var t=e;t.length=function(r){for(var n=0,i=0,o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?n+=1:i<2048?n+=2:(i&64512)===55296&&(r.charCodeAt(o+1)&64512)===56320?(++o,n+=4):n+=3;return n},t.read=function(r,n,i){var o=i-n;if(o<1)return"";for(var s=null,a=[],l=0,u;n<i;)u=r[n++],u<128?a[l++]=u:u>191&&u<224?a[l++]=(u&31)<<6|r[n++]&63:u>239&&u<365?(u=((u&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,a[l++]=55296+(u>>10),a[l++]=56320+(u&1023)):a[l++]=(u&15)<<12|(r[n++]&63)<<6|r[n++]&63,l>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),l=0);return s?(l&&s.push(String.fromCharCode.apply(String,a.slice(0,l))),s.join("")):String.fromCharCode.apply(String,a.slice(0,l))},t.write=function(r,n,i){for(var o=i,s,a,l=0;l<r.length;++l)s=r.charCodeAt(l),s<128?n[i++]=s:s<2048?(n[i++]=s>>6|192,n[i++]=s&63|128):(s&64512)===55296&&((a=r.charCodeAt(l+1))&64512)===56320?(s=65536+((s&1023)<<10)+(a&1023),++l,n[i++]=s>>18|240,n[i++]=s>>12&63|128,n[i++]=s>>6&63|128,n[i++]=s&63|128):(n[i++]=s>>12|224,n[i++]=s>>6&63|128,n[i++]=s&63|128);return i-o}}}),Ty=K({"../../node_modules/.pnpm/@protobufjs+pool@1.1.0/node_modules/@protobufjs/pool/index.js"(e,t){"use strict";t.exports=r;function r(n,i,o){var s=o||8192,a=s>>>1,l=null,u=s;return function(c){if(c<1||c>a)return n(c);u+c>s&&(l=n(s),u=0);var f=i.call(l,u,u+=c);return u&7&&(u=(u|7)+1),f}}}}),By=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/util/longbits.js"(e,t){"use strict";t.exports=n;var r=kt();function n(a,l){this.lo=a>>>0,this.hi=l>>>0}var i=n.zero=new n(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(a){if(a===0)return i;var l=a<0;l&&(a=-a);var u=a>>>0,c=(a-u)/4294967296>>>0;return l&&(c=~c>>>0,u=~u>>>0,++u>4294967295&&(u=0,++c>4294967295&&(c=0))),new n(u,c)},n.from=function(a){if(typeof a=="number")return n.fromNumber(a);if(r.isString(a))if(r.Long)a=r.Long.fromString(a);else return n.fromNumber(parseInt(a,10));return a.low||a.high?new n(a.low>>>0,a.high>>>0):i},n.prototype.toNumber=function(a){if(!a&&this.hi>>>31){var l=~this.lo+1>>>0,u=~this.hi>>>0;return l||(u=u+1>>>0),-(l+u*4294967296)}return this.lo+this.hi*4294967296},n.prototype.toLong=function(a){return r.Long?new r.Long(this.lo|0,this.hi|0,!!a):{low:this.lo|0,high:this.hi|0,unsigned:!!a}};var s=String.prototype.charCodeAt;n.fromHash=function(a){return a===o?i:new n((s.call(a,0)|s.call(a,1)<<8|s.call(a,2)<<16|s.call(a,3)<<24)>>>0,(s.call(a,4)|s.call(a,5)<<8|s.call(a,6)<<16|s.call(a,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var a=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0,this.lo=(this.lo<<1^a)>>>0,this},n.prototype.zzDecode=function(){var a=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0,this.hi=(this.hi>>>1^a)>>>0,this},n.prototype.length=function(){var a=this.lo,l=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?l===0?a<16384?a<128?1:2:a<2097152?3:4:l<16384?l<128?5:6:l<2097152?7:8:u<128?9:10}}}),kt=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/util/minimal.js"(e){"use strict";var t=e;t.asPromise=ky(),t.base64=Ey(),t.EventEmitter=Sy(),t.float=xy(),t.inquire=Ay(),t.utf8=Cy(),t.pool=Ty(),t.LongBits=By(),t.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node),t.global=t.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||e,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i},t.isString=function(i){return typeof i=="string"||i instanceof String},t.isObject=function(i){return i&&typeof i=="object"},t.isset=t.isSet=function(i,o){var s=i[o];return s!=null&&i.hasOwnProperty(o)?typeof s!="object"||(Array.isArray(s)?s.length:Object.keys(s).length)>0:!1},t.Buffer=function(){try{var i=t.inquire("buffer").Buffer;return i.prototype.utf8Write?i:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(i){return typeof i=="number"?t.Buffer?t._Buffer_allocUnsafe(i):new t.Array(i):t.Buffer?t._Buffer_from(i):typeof Uint8Array>"u"?i:new Uint8Array(i)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(i){return i?t.LongBits.from(i).toHash():t.LongBits.zeroHash},t.longFromHash=function(i,o){var s=t.LongBits.fromHash(i);return t.Long?t.Long.fromBits(s.lo,s.hi,o):s.toNumber(!!o)};function r(i,o,s){for(var a=Object.keys(o),l=0;l<a.length;++l)(i[a[l]]===void 0||!s)&&(i[a[l]]=o[a[l]]);return i}t.merge=r,t.lcFirst=function(i){return i.charAt(0).toLowerCase()+i.substring(1)};function n(i){function o(s,a){if(!(this instanceof o))return new o(s,a);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,o):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&r(this,a)}return o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return i},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),o}t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(i){for(var o={},s=0;s<i.length;++s)o[i[s]]=1;return function(){for(var a=Object.keys(this),l=a.length-1;l>-1;--l)if(o[a[l]]===1&&this[a[l]]!==void 0&&this[a[l]]!==null)return a[l]}},t.oneOfSetter=function(i){return function(o){for(var s=0;s<i.length;++s)i[s]!==o&&delete this[i[s]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var i=t.Buffer;if(!i){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=i.from!==Uint8Array.from&&i.from||function(o,s){return new i(o,s)},t._Buffer_allocUnsafe=i.allocUnsafe||function(o){return new i(o)}}}}),ds=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/writer.js"(e,t){"use strict";t.exports=c;var r=kt(),n,i=r.LongBits,o=r.base64,s=r.utf8;function a(m,b,v){this.fn=m,this.len=b,this.next=void 0,this.val=v}function l(){}function u(m){this.head=m.head,this.tail=m.tail,this.len=m.len,this.next=m.states}function c(){this.len=0,this.head=new a(l,0,0),this.tail=this.head,this.states=null}var f=function(){return r.Buffer?function(){return(c.create=function(){return new n})()}:function(){return new c}};c.create=f(),c.alloc=function(m){return new r.Array(m)},r.Array!==Array&&(c.alloc=r.pool(c.alloc,r.Array.prototype.subarray)),c.prototype._push=function(m,b,v){return this.tail=this.tail.next=new a(m,b,v),this.len+=b,this};function w(m,b,v){b[v]=m&255}function p(m,b,v){for(;m>127;)b[v++]=m&127|128,m>>>=7;b[v]=m}function d(m,b){this.len=m,this.next=void 0,this.val=b}d.prototype=Object.create(a.prototype),d.prototype.fn=p,c.prototype.uint32=function(m){return this.len+=(this.tail=this.tail.next=new d((m=m>>>0)<128?1:m<16384?2:m<2097152?3:m<268435456?4:5,m)).len,this},c.prototype.int32=function(m){return m<0?this._push(h,10,i.fromNumber(m)):this.uint32(m)},c.prototype.sint32=function(m){return this.uint32((m<<1^m>>31)>>>0)};function h(m,b,v){for(;m.hi;)b[v++]=m.lo&127|128,m.lo=(m.lo>>>7|m.hi<<25)>>>0,m.hi>>>=7;for(;m.lo>127;)b[v++]=m.lo&127|128,m.lo=m.lo>>>7;b[v++]=m.lo}c.prototype.uint64=function(m){var b=i.from(m);return this._push(h,b.length(),b)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(m){var b=i.from(m).zzEncode();return this._push(h,b.length(),b)},c.prototype.bool=function(m){return this._push(w,1,m?1:0)};function y(m,b,v){b[v]=m&255,b[v+1]=m>>>8&255,b[v+2]=m>>>16&255,b[v+3]=m>>>24}c.prototype.fixed32=function(m){return this._push(y,4,m>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(m){var b=i.from(m);return this._push(y,4,b.lo)._push(y,4,b.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(m){return this._push(r.float.writeFloatLE,4,m)},c.prototype.double=function(m){return this._push(r.float.writeDoubleLE,8,m)};var g=r.Array.prototype.set?function(m,b,v){b.set(m,v)}:function(m,b,v){for(var S=0;S<m.length;++S)b[v+S]=m[S]};c.prototype.bytes=function(m){var b=m.length>>>0;if(!b)return this._push(w,1,0);if(r.isString(m)){var v=c.alloc(b=o.length(m));o.decode(m,v,0),m=v}return this.uint32(b)._push(g,b,m)},c.prototype.string=function(m){var b=s.length(m);return b?this.uint32(b)._push(s.write,b,m):this._push(w,1,0)},c.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new a(l,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new a(l,0,0),this.len=0),this},c.prototype.ldelim=function(){var m=this.head,b=this.tail,v=this.len;return this.reset().uint32(v),v&&(this.tail.next=m.next,this.tail=b,this.len+=v),this},c.prototype.finish=function(){for(var m=this.head.next,b=this.constructor.alloc(this.len),v=0;m;)m.fn(m.val,b,v),v+=m.len,m=m.next;return b},c._configure=function(m){n=m,c.create=f(),n._configure()}}}),hc=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/writer_buffer.js"(e,t){"use strict";t.exports=i;var r=ds();(i.prototype=Object.create(r.prototype)).constructor=i;var n=kt();function i(){r.call(this)}i._configure=function(){i.alloc=n._Buffer_allocUnsafe,i.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&n.Buffer.prototype.set.name==="set"?function(s,a,l){a.set(s,l)}:function(s,a,l){if(s.copy)s.copy(a,l,0,s.length);else for(var u=0;u<s.length;)a[l++]=s[u++]}},i.prototype.bytes=function(s){n.isString(s)&&(s=n._Buffer_from(s,"base64"));var a=s.length>>>0;return this.uint32(a),a&&this._push(i.writeBytesBuffer,a,s),this};function o(s,a,l){s.length<40?n.utf8.write(s,a,l):a.utf8Write?a.utf8Write(s,l):a.write(s,l)}i.prototype.string=function(s){var a=n.Buffer.byteLength(s);return this.uint32(a),a&&this._push(o,a,s),this},i._configure()}}),ps=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/reader.js"(e,t){"use strict";t.exports=a;var r=kt(),n,i=r.LongBits,o=r.utf8;function s(p,d){return RangeError("index out of range: "+p.pos+" + "+(d||1)+" > "+p.len)}function a(p){this.buf=p,this.pos=0,this.len=p.length}var l=typeof Uint8Array<"u"?function(p){if(p instanceof Uint8Array||Array.isArray(p))return new a(p);throw Error("illegal buffer")}:function(p){if(Array.isArray(p))return new a(p);throw Error("illegal buffer")},u=function(){return r.Buffer?function(p){return(a.create=function(d){return r.Buffer.isBuffer(d)?new n(d):l(d)})(p)}:l};a.create=u(),a.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,a.prototype.uint32=function(){var p=4294967295;return function(){if(p=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(p=(p|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(p=(p|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(p=(p|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(p=(p|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return p;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return p}}(),a.prototype.int32=function(){return this.uint32()|0},a.prototype.sint32=function(){var p=this.uint32();return p>>>1^-(p&1)|0};function c(){var p=new i(0,0),d=0;if(this.len-this.pos>4){for(;d<4;++d)if(p.lo=(p.lo|(this.buf[this.pos]&127)<<d*7)>>>0,this.buf[this.pos++]<128)return p;if(p.lo=(p.lo|(this.buf[this.pos]&127)<<28)>>>0,p.hi=(p.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return p;d=0}else{for(;d<3;++d){if(this.pos>=this.len)throw s(this);if(p.lo=(p.lo|(this.buf[this.pos]&127)<<d*7)>>>0,this.buf[this.pos++]<128)return p}return p.lo=(p.lo|(this.buf[this.pos++]&127)<<d*7)>>>0,p}if(this.len-this.pos>4){for(;d<5;++d)if(p.hi=(p.hi|(this.buf[this.pos]&127)<<d*7+3)>>>0,this.buf[this.pos++]<128)return p}else for(;d<5;++d){if(this.pos>=this.len)throw s(this);if(p.hi=(p.hi|(this.buf[this.pos]&127)<<d*7+3)>>>0,this.buf[this.pos++]<128)return p}throw Error("invalid varint encoding")}a.prototype.bool=function(){return this.uint32()!==0};function f(p,d){return(p[d-4]|p[d-3]<<8|p[d-2]<<16|p[d-1]<<24)>>>0}a.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)},a.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)|0};function w(){if(this.pos+8>this.len)throw s(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}a.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var p=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,p},a.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var p=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,p},a.prototype.bytes=function(){var p=this.uint32(),d=this.pos,h=this.pos+p;if(h>this.len)throw s(this,p);return this.pos+=p,Array.isArray(this.buf)?this.buf.slice(d,h):d===h?new this.buf.constructor(0):this._slice.call(this.buf,d,h)},a.prototype.string=function(){var p=this.bytes();return o.read(p,0,p.length)},a.prototype.skip=function(p){if(typeof p=="number"){if(this.pos+p>this.len)throw s(this,p);this.pos+=p}else do if(this.pos>=this.len)throw s(this);while(this.buf[this.pos++]&128);return this},a.prototype.skipType=function(p){switch(p){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(p=this.uint32()&7)!==4;)this.skipType(p);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+p+" at offset "+this.pos)}return this},a._configure=function(p){n=p,a.create=u(),n._configure();var d=r.Long?"toLong":"toNumber";r.merge(a.prototype,{int64:function(){return c.call(this)[d](!1)},uint64:function(){return c.call(this)[d](!0)},sint64:function(){return c.call(this).zzDecode()[d](!1)},fixed64:function(){return w.call(this)[d](!0)},sfixed64:function(){return w.call(this)[d](!1)}})}}}),fc=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/reader_buffer.js"(e,t){"use strict";t.exports=i;var r=ps();(i.prototype=Object.create(r.prototype)).constructor=i;var n=kt();function i(o){r.call(this,o)}i._configure=function(){n.Buffer&&(i.prototype._slice=n.Buffer.prototype.slice)},i.prototype.string=function(){var o=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+o,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+o,this.len))},i._configure()}}),Fy=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/rpc/service.js"(e,t){"use strict";t.exports=n;var r=kt();(n.prototype=Object.create(r.EventEmitter.prototype)).constructor=n;function n(i,o,s){if(typeof i!="function")throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=!!o,this.responseDelimited=!!s}n.prototype.rpcCall=function i(o,s,a,l,u){if(!l)throw TypeError("request must be specified");var c=this;if(!u)return r.asPromise(i,c,o,s,a,l);if(!c.rpcImpl){setTimeout(function(){u(Error("already ended"))},0);return}try{return c.rpcImpl(o,s[c.requestDelimited?"encodeDelimited":"encode"](l).finish(),function(f,w){if(f)return c.emit("error",f,o),u(f);if(w===null){c.end(!0);return}if(!(w instanceof a))try{w=a[c.responseDelimited?"decodeDelimited":"decode"](w)}catch(p){return c.emit("error",p,o),u(p)}return c.emit("data",w,o),u(null,w)})}catch(f){c.emit("error",f,o),setTimeout(function(){u(f)},0);return}},n.prototype.end=function(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}}}),_y=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/rpc.js"(e){"use strict";var t=e;t.Service=Fy()}}),Ly=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/roots.js"(e,t){"use strict";t.exports={}}}),Iy=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/src/index-minimal.js"(e){"use strict";var t=e;t.build="minimal",t.Writer=ds(),t.BufferWriter=hc(),t.Reader=ps(),t.BufferReader=fc(),t.util=kt(),t.rpc=_y(),t.roots=Ly(),t.configure=r;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}r()}}),Uy=K({"../../node_modules/.pnpm/protobufjs@7.2.2/node_modules/protobufjs/minimal.js"(e,t){"use strict";t.exports=Iy()}}),Dy=K({"../../node_modules/.pnpm/murmurhash3js-revisited@3.0.0/node_modules/murmurhash3js-revisited/lib/murmurHash3js.js"(e,t){(function(r,n){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function o(h){if(!Array.isArray(h)&&!ArrayBuffer.isView(h))return!1;for(var y=0;y<h.length;y++)if(!Number.isInteger(h[y])||h[y]<0||h[y]>255)return!1;return!0}function s(h,y){return(h&65535)*y+(((h>>>16)*y&65535)<<16)}function a(h,y){return h<<y|h>>>32-y}function l(h){return h^=h>>>16,h=s(h,2246822507),h^=h>>>13,h=s(h,3266489909),h^=h>>>16,h}function u(h,y){h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535],y=[y[0]>>>16,y[0]&65535,y[1]>>>16,y[1]&65535];var g=[0,0,0,0];return g[3]+=h[3]+y[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=h[2]+y[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=h[1]+y[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=h[0]+y[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function c(h,y){h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535],y=[y[0]>>>16,y[0]&65535,y[1]>>>16,y[1]&65535];var g=[0,0,0,0];return g[3]+=h[3]*y[3],g[2]+=g[3]>>>16,g[3]&=65535,g[2]+=h[2]*y[3],g[1]+=g[2]>>>16,g[2]&=65535,g[2]+=h[3]*y[2],g[1]+=g[2]>>>16,g[2]&=65535,g[1]+=h[1]*y[3],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=h[2]*y[2],g[0]+=g[1]>>>16,g[1]&=65535,g[1]+=h[3]*y[1],g[0]+=g[1]>>>16,g[1]&=65535,g[0]+=h[0]*y[3]+h[1]*y[2]+h[2]*y[1]+h[3]*y[0],g[0]&=65535,[g[0]<<16|g[1],g[2]<<16|g[3]]}function f(h,y){return y%=64,y===32?[h[1],h[0]]:y<32?[h[0]<<y|h[1]>>>32-y,h[1]<<y|h[0]>>>32-y]:(y-=32,[h[1]<<y|h[0]>>>32-y,h[0]<<y|h[1]>>>32-y])}function w(h,y){return y%=64,y===0?h:y<32?[h[0]<<y|h[1]>>>32-y,h[1]<<y]:[h[1]<<y-32,0]}function p(h,y){return[h[0]^y[0],h[1]^y[1]]}function d(h){return h=p(h,[0,h[0]>>>1]),h=c(h,[4283543511,3981806797]),h=p(h,[0,h[0]>>>1]),h=c(h,[3301882366,444984403]),h=p(h,[0,h[0]>>>1]),h}i.x86.hash32=function(h,y){if(i.inputValidation&&!o(h))return n;y=y||0;for(var g=h.length%4,m=h.length-g,b=y,v=0,S=3432918353,T=461845907,B=0;B<m;B=B+4)v=h[B]|h[B+1]<<8|h[B+2]<<16|h[B+3]<<24,v=s(v,S),v=a(v,15),v=s(v,T),b^=v,b=a(b,13),b=s(b,5)+3864292196;switch(v=0,g){case 3:v^=h[B+2]<<16;case 2:v^=h[B+1]<<8;case 1:v^=h[B],v=s(v,S),v=a(v,15),v=s(v,T),b^=v}return b^=h.length,b=l(b),b>>>0},i.x86.hash128=function(h,y){if(i.inputValidation&&!o(h))return n;y=y||0;for(var g=h.length%16,m=h.length-g,b=y,v=y,S=y,T=y,B=0,N=0,L=0,Q=0,Wt=597399067,Gt=2869860233,de=951274213,Kt=2716044179,P=0;P<m;P=P+16)B=h[P]|h[P+1]<<8|h[P+2]<<16|h[P+3]<<24,N=h[P+4]|h[P+5]<<8|h[P+6]<<16|h[P+7]<<24,L=h[P+8]|h[P+9]<<8|h[P+10]<<16|h[P+11]<<24,Q=h[P+12]|h[P+13]<<8|h[P+14]<<16|h[P+15]<<24,B=s(B,Wt),B=a(B,15),B=s(B,Gt),b^=B,b=a(b,19),b+=v,b=s(b,5)+1444728091,N=s(N,Gt),N=a(N,16),N=s(N,de),v^=N,v=a(v,17),v+=S,v=s(v,5)+197830471,L=s(L,de),L=a(L,17),L=s(L,Kt),S^=L,S=a(S,15),S+=T,S=s(S,5)+2530024501,Q=s(Q,Kt),Q=a(Q,18),Q=s(Q,Wt),T^=Q,T=a(T,13),T+=b,T=s(T,5)+850148119;switch(B=0,N=0,L=0,Q=0,g){case 15:Q^=h[P+14]<<16;case 14:Q^=h[P+13]<<8;case 13:Q^=h[P+12],Q=s(Q,Kt),Q=a(Q,18),Q=s(Q,Wt),T^=Q;case 12:L^=h[P+11]<<24;case 11:L^=h[P+10]<<16;case 10:L^=h[P+9]<<8;case 9:L^=h[P+8],L=s(L,de),L=a(L,17),L=s(L,Kt),S^=L;case 8:N^=h[P+7]<<24;case 7:N^=h[P+6]<<16;case 6:N^=h[P+5]<<8;case 5:N^=h[P+4],N=s(N,Gt),N=a(N,16),N=s(N,de),v^=N;case 4:B^=h[P+3]<<24;case 3:B^=h[P+2]<<16;case 2:B^=h[P+1]<<8;case 1:B^=h[P],B=s(B,Wt),B=a(B,15),B=s(B,Gt),b^=B}return b^=h.length,v^=h.length,S^=h.length,T^=h.length,b+=v,b+=S,b+=T,v+=b,S+=b,T+=b,b=l(b),v=l(v),S=l(S),T=l(T),b+=v,b+=S,b+=T,v+=b,S+=b,T+=b,("00000000"+(b>>>0).toString(16)).slice(-8)+("00000000"+(v>>>0).toString(16)).slice(-8)+("00000000"+(S>>>0).toString(16)).slice(-8)+("00000000"+(T>>>0).toString(16)).slice(-8)},i.x64.hash128=function(h,y){if(i.inputValidation&&!o(h))return n;y=y||0;for(var g=h.length%16,m=h.length-g,b=[0,y],v=[0,y],S=[0,0],T=[0,0],B=[2277735313,289559509],N=[1291169091,658871167],L=0;L<m;L=L+16)S=[h[L+4]|h[L+5]<<8|h[L+6]<<16|h[L+7]<<24,h[L]|h[L+1]<<8|h[L+2]<<16|h[L+3]<<24],T=[h[L+12]|h[L+13]<<8|h[L+14]<<16|h[L+15]<<24,h[L+8]|h[L+9]<<8|h[L+10]<<16|h[L+11]<<24],S=c(S,B),S=f(S,31),S=c(S,N),b=p(b,S),b=f(b,27),b=u(b,v),b=u(c(b,[0,5]),[0,1390208809]),T=c(T,N),T=f(T,33),T=c(T,B),v=p(v,T),v=f(v,31),v=u(v,b),v=u(c(v,[0,5]),[0,944331445]);switch(S=[0,0],T=[0,0],g){case 15:T=p(T,w([0,h[L+14]],48));case 14:T=p(T,w([0,h[L+13]],40));case 13:T=p(T,w([0,h[L+12]],32));case 12:T=p(T,w([0,h[L+11]],24));case 11:T=p(T,w([0,h[L+10]],16));case 10:T=p(T,w([0,h[L+9]],8));case 9:T=p(T,[0,h[L+8]]),T=c(T,N),T=f(T,33),T=c(T,B),v=p(v,T);case 8:S=p(S,w([0,h[L+7]],56));case 7:S=p(S,w([0,h[L+6]],48));case 6:S=p(S,w([0,h[L+5]],40));case 5:S=p(S,w([0,h[L+4]],32));case 4:S=p(S,w([0,h[L+3]],24));case 3:S=p(S,w([0,h[L+2]],16));case 2:S=p(S,w([0,h[L+1]],8));case 1:S=p(S,[0,h[L]]),S=c(S,B),S=f(S,31),S=c(S,N),b=p(b,S)}return b=p(b,[0,h.length]),v=p(v,[0,h.length]),b=u(b,v),v=u(v,b),b=d(b),v=d(v),b=u(b,v),v=u(v,b),("00000000"+(b[0]>>>0).toString(16)).slice(-8)+("00000000"+(b[1]>>>0).toString(16)).slice(-8)+("00000000"+(v[0]>>>0).toString(16)).slice(-8)+("00000000"+(v[1]>>>0).toString(16)).slice(-8)},typeof e<"u"?(typeof t<"u"&&t.exports&&(e=t.exports=i),e.murmurHash3=i):typeof define=="function"&&define.amd?define([],function(){return i}):(i._murmurHash3=r.murmurHash3,i.noConflict=function(){return r.murmurHash3=i._murmurHash3,i._murmurHash3=n,i.noConflict=n,i},r.murmurHash3=i)})(e)}}),dc=K({"../../node_modules/.pnpm/murmurhash3js-revisited@3.0.0/node_modules/murmurhash3js-revisited/index.js"(e,t){t.exports=Dy()}}),Xe=K({"../../node_modules/.pnpm/err-code@3.0.1/node_modules/err-code/index.js"(e,t){"use strict";function r(i,o){for(let s in o)Object.defineProperty(i,s,{value:o[s],enumerable:!0,configurable:!0});return i}function n(i,o,s){if(!i||typeof i=="string")throw new TypeError("Please pass an Error to err-code");s||(s={}),typeof o=="object"&&(s=o,o=""),o&&(s.code=o);try{return r(i,s)}catch{s.message=i.message,s.stack=i.stack;let a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(i)),r(new a,s)}}t.exports=n}}),Ny=K({"../../node_modules/.pnpm/sparse-array@1.3.2/node_modules/sparse-array/index.js"(e,t){"use strict";var r=7;t.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(a,l){let u=this._internalPositionFor(a,!1);if(l===void 0)u!==-1&&(this._unsetInternalPos(u),this._unsetBit(a),this._changedLength=!0,this._changedData=!0);else{let c=!1;u===-1?(u=this._data.length,this._setBit(a),this._changedData=!0):c=!0,this._setInternalPos(u,a,l,c),this._changedLength=!0}}unset(a){this.set(a,void 0)}get(a){this._sortData();let l=this._internalPositionFor(a,!0);if(l!==-1)return this._data[l][1]}push(a){return this.set(this.length,a),this.length}get length(){if(this._sortData(),this._changedLength){let a=this._data[this._data.length-1];this._length=a?a[0]+1:0,this._changedLength=!1}return this._length}forEach(a){let l=0;for(;l<this.length;)a(this.get(l),l,this),l++}map(a){let l=0,u=new Array(this.length);for(;l<this.length;)u[l]=a(this.get(l),l,this),l++;return u}reduce(a,l){let u=0,c=l;for(;u<this.length;){let f=this.get(u);c=a(c,f,u),u++}return c}find(a){let l=0,u,c;for(;l<this.length&&!u;)c=this.get(l),u=a(c),l++;return u?c:void 0}_internalPositionFor(a,l){let u=this._bytePosFor(a,l);if(u>=this._bitArrays.length)return-1;let c=this._bitArrays[u],f=a-u*r;if(!((c&1<<f)>0))return-1;let w=this._bitArrays.slice(0,u).reduce(n,0),p=~(4294967295<<f+1),d=i(c&p);return w+d-1}_bytePosFor(a,l){let u=Math.floor(a/r),c=u+1;for(;!l&&this._bitArrays.length<c;)this._bitArrays.push(0);return u}_setBit(a){let l=this._bytePosFor(a,!1);this._bitArrays[l]|=1<<a-l*r}_unsetBit(a){let l=this._bytePosFor(a,!1);this._bitArrays[l]&=~(1<<a-l*r)}_setInternalPos(a,l,u,c){let f=this._data,w=[l,u];if(c)this._sortData(),f[a]=w;else{if(f.length)if(f[f.length-1][0]>=l)f.push(w);else if(f[0][0]<=l)f.unshift(w);else{let p=Math.round(f.length/2);this._data=f.slice(0,p).concat(w).concat(f.slice(p))}else this._data.push(w);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(a){this._data.splice(a,1)}_sortData(){this._changedData&&this._data.sort(o),this._changedData=!1}bitField(){let a=[],l=8,u=0,c=0,f,w=this._bitArrays.slice();for(;w.length||u;){u===0&&(f=w.shift(),u=7);let d=Math.min(u,l),h=~(255<<d),y=f&h;c|=y<<8-l,f=f>>>d,u-=d,l-=d,(!l||!u&&!w.length)&&(a.push(c),c=0,l=8)}for(var p=a.length-1;p>0&&a[p]===0;p--)a.pop();return a}compactArray(){return this._sortData(),this._data.map(s)}};function n(a,l){return a+i(l)}function i(a){let l=a;return l=l-(l>>1&1431655765),l=(l&858993459)+(l>>2&858993459),(l+(l>>4)&252645135)*16843009>>24}function o(a,l){return a[0]-l[0]}function s(a){return a[1]}}}),jy=K({"../../node_modules/.pnpm/eventemitter3@4.0.7/node_modules/eventemitter3/index.js"(e,t){"use strict";var r=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function o(u,c,f){this.fn=u,this.context=c,this.once=f||!1}function s(u,c,f,w,p){if(typeof f!="function")throw new TypeError("The listener must be a function");var d=new o(f,w||u,p),h=n?n+c:c;return u._events[h]?u._events[h].fn?u._events[h]=[u._events[h],d]:u._events[h].push(d):(u._events[h]=d,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new i:delete u._events[c]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],c,f;if(this._eventsCount===0)return u;for(f in c=this._events)r.call(c,f)&&u.push(n?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},l.prototype.listeners=function(u){var c=n?n+u:u,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var w=0,p=f.length,d=new Array(p);w<p;w++)d[w]=f[w].fn;return d},l.prototype.listenerCount=function(u){var c=n?n+u:u,f=this._events[c];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,c,f,w,p,d){var h=n?n+u:u;if(!this._events[h])return!1;var y=this._events[h],g=arguments.length,m,b;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),g){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,f),!0;case 4:return y.fn.call(y.context,c,f,w),!0;case 5:return y.fn.call(y.context,c,f,w,p),!0;case 6:return y.fn.call(y.context,c,f,w,p,d),!0}for(b=1,m=new Array(g-1);b<g;b++)m[b-1]=arguments[b];y.fn.apply(y.context,m)}else{var v=y.length,S;for(b=0;b<v;b++)switch(y[b].once&&this.removeListener(u,y[b].fn,void 0,!0),g){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,c);break;case 3:y[b].fn.call(y[b].context,c,f);break;case 4:y[b].fn.call(y[b].context,c,f,w);break;default:if(!m)for(S=1,m=new Array(g-1);S<g;S++)m[S-1]=arguments[S];y[b].fn.apply(y[b].context,m)}}return!0},l.prototype.on=function(u,c,f){return s(this,u,c,f,!1)},l.prototype.once=function(u,c,f){return s(this,u,c,f,!0)},l.prototype.removeListener=function(u,c,f,w){var p=n?n+u:u;if(!this._events[p])return this;if(!c)return a(this,p),this;var d=this._events[p];if(d.fn)d.fn===c&&(!w||d.once)&&(!f||d.context===f)&&a(this,p);else{for(var h=0,y=[],g=d.length;h<g;h++)(d[h].fn!==c||w&&!d[h].once||f&&d[h].context!==f)&&y.push(d[h]);y.length?this._events[p]=y.length===1?y[0]:y:a(this,p)}return this},l.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,typeof t<"u"&&(t.exports=l)}}),xn="0123456789abcdef",_l=class Dr{constructor(t){this.bytes=t}static ofInner(t){if(t.length!==16)throw new TypeError("not 128-bit length");return new Dr(t)}static fromFieldsV7(t,r,n,i){if(!Number.isInteger(t)||!Number.isInteger(r)||!Number.isInteger(n)||!Number.isInteger(i)||t<0||r<0||n<0||i<0||t>0xffffffffffff||r>4095||n>1073741823||i>4294967295)throw new RangeError("invalid field value");let o=new Uint8Array(16);return o[0]=t/2**40,o[1]=t/2**32,o[2]=t/2**24,o[3]=t/2**16,o[4]=t/2**8,o[5]=t,o[6]=112|r>>>8,o[7]=r,o[8]=128|n>>>24,o[9]=n>>>16,o[10]=n>>>8,o[11]=n,o[12]=i>>>24,o[13]=i>>>16,o[14]=i>>>8,o[15]=i,new Dr(o)}static parse(t){var r,n,i,o;let s;switch(t.length){case 32:s=(r=/^[0-9a-f]{32}$/i.exec(t))===null||r===void 0?void 0:r[0];break;case 36:s=(n=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))===null||n===void 0?void 0:n.slice(1,6).join("");break;case 38:s=(i=/^\{([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\}$/i.exec(t))===null||i===void 0?void 0:i.slice(1,6).join("");break;case 45:s=(o=/^urn:uuid:([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/i.exec(t))===null||o===void 0?void 0:o.slice(1,6).join("");break;default:break}if(s){let a=new Uint8Array(16);for(let l=0;l<16;l+=4){let u=parseInt(s.substring(2*l,2*l+8),16);a[l+0]=u>>>24,a[l+1]=u>>>16,a[l+2]=u>>>8,a[l+3]=u}return new Dr(a)}else throw new SyntaxError("could not parse UUID string")}toString(){let t="";for(let r=0;r<this.bytes.length;r++)t+=xn.charAt(this.bytes[r]>>>4),t+=xn.charAt(this.bytes[r]&15),(r===3||r===5||r===7||r===9)&&(t+="-");return t}toHex(){let t="";for(let r=0;r<this.bytes.length;r++)t+=xn.charAt(this.bytes[r]>>>4),t+=xn.charAt(this.bytes[r]&15);return t}toJSON(){return this.toString()}getVariant(){let t=this.bytes[8]>>>4;if(t<0)throw new Error("unreachable");if(t<=7)return this.bytes.every(r=>r===0)?"NIL":"VAR_0";if(t<=11)return"VAR_10";if(t<=13)return"VAR_110";if(t<=15)return this.bytes.every(r=>r===255)?"MAX":"VAR_RESERVED";throw new Error("unreachable")}getVersion(){return this.getVariant()==="VAR_10"?this.bytes[6]>>>4:void 0}clone(){return new Dr(this.bytes.slice(0))}equals(t){return this.compareTo(t)===0}compareTo(t){for(let r=0;r<16;r++){let n=this.bytes[r]-t.bytes[r];if(n!==0)return Math.sign(n)}return 0}},zy=class{constructor(e){this.timestamp=0,this.counter=0,this.random=e??My()}generate(){return this.generateOrResetCore(Date.now(),1e4)}generateOrAbort(){return this.generateOrAbortCore(Date.now(),1e4)}generateOrResetCore(e,t){let r=this.generateOrAbortCore(e,t);return r===void 0&&(this.timestamp=0,r=this.generateOrAbortCore(e,t)),r}generateOrAbortCore(e,t){if(!Number.isInteger(e)||e<1||e>0xffffffffffff)throw new RangeError("`unixTsMs` must be a 48-bit positive integer");if(t<0||t>0xffffffffffff)throw new RangeError("`rollbackAllowance` out of reasonable range");if(e>this.timestamp)this.timestamp=e,this.resetCounter();else if(e+t>=this.timestamp)this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter());else return;return _l.fromFieldsV7(this.timestamp,Math.trunc(this.counter/2**30),this.counter&2**30-1,this.random.nextUint32())}resetCounter(){this.counter=this.random.nextUint32()*1024+(this.random.nextUint32()&1023)}generateV4(){let e=new Uint8Array(Uint32Array.of(this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32(),this.random.nextUint32()).buffer);return e[6]=64|e[6]>>>4,e[8]=128|e[8]>>>2,_l.ofInner(e)}},My=()=>{if(typeof crypto<"u"&&typeof crypto.getRandomValues<"u")return new Oy;if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");return{nextUint32:()=>Math.trunc(Math.random()*65536)*65536+Math.trunc(Math.random()*65536)}},Oy=class{constructor(){this.buffer=new Uint32Array(8),this.cursor=65535}nextUint32(){return this.cursor>=this.buffer.length&&(crypto.getRandomValues(this.buffer),this.cursor=0),this.buffer[this.cursor++]}},Ll,$y=()=>Py().toString(),Py=()=>(Ll||(Ll=new zy)).generate();function Ry(e,t=1/0,r=!1){let n=[],i=!1;async function o(){if(i||n.length===0)return;i=!0;let s=n.splice(0,t),a=s.map(l=>l.task);if(r){let l=a.map(async(u,c)=>{try{let f=await e([u]);s[c].resolve(f)}catch(f){s[c].reject(f)}});await Promise.all(l)}else try{let l=await e(a);s.forEach(u=>u.resolve(l))}catch(l){s.forEach(u=>u.reject(l))}i=!1,o()}return{push(s){return new Promise((a,l)=>{n.push({task:s,resolve:a,reject:l}),o()})}}}var Hy=pc,Il=128,Vy=127,qy=~Vy,Wy=Math.pow(2,31);function pc(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Wy;)t[r++]=e&255|Il,e/=128;for(;e&qy;)t[r++]=e&255|Il,e>>>=7;return t[r]=e|0,pc.bytes=r-n+1,t}var Gy=Bo,Ky=128,Ul=127;function Bo(e,n){var r=0,n=n||0,i=0,o=n,s,a=e.length;do{if(o>=a)throw Bo.bytes=0,new RangeError("Could not decode varint");s=e[o++],r+=i<28?(s&Ul)<<i:(s&Ul)*Math.pow(2,i),i+=7}while(s>=Ky);return Bo.bytes=o-n,r}var Jy=Math.pow(2,7),Qy=Math.pow(2,14),Zy=Math.pow(2,21),Yy=Math.pow(2,28),Xy=Math.pow(2,35),ew=Math.pow(2,42),tw=Math.pow(2,49),rw=Math.pow(2,56),nw=Math.pow(2,63),iw=function(e){return e<Jy?1:e<Qy?2:e<Zy?3:e<Yy?4:e<Xy?5:e<ew?6:e<tw?7:e<rw?8:e<nw?9:10},ow={encode:Hy,decode:Gy,encodingLength:iw},sw=ow,Gn=sw,Fo=(e,t=0)=>[Gn.decode(e,t),Gn.decode.bytes],Kn=(e,t,r=0)=>(Gn.encode(e,t,r),t),Jn=e=>Gn.encodingLength(e),g4=new Uint8Array(0),aw=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},Bi=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},lw=e=>new TextEncoder().encode(e),uw=e=>new TextDecoder().decode(e),Qn=(e,t)=>{let r=t.byteLength,n=Jn(e),i=n+Jn(r),o=new Uint8Array(i+r);return Kn(e,o,0),Kn(r,o,n),o.set(t,i),new ys(e,r,t,o)},_o=e=>{let t=Bi(e),[r,n]=Fo(t),[i,o]=Fo(t.subarray(n)),s=t.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new ys(r,i,s,t)},cw=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&aw(e.bytes,r.bytes)}},ys=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}},yc={};ie(yc,{base58btc:()=>Je,base58flickr:()=>kw});function hw(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(r[s]!==255)throw new TypeError(o+" is ambiguous");r[s]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var h=0,y=0,g=0,m=d.length;g!==m&&d[g]===0;)g++,h++;for(var b=(m-g)*c+1>>>0,v=new Uint8Array(b);g!==m;){for(var S=d[g],T=0,B=b-1;(S!==0||T<y)&&B!==-1;B--,T++)S+=256*v[B]>>>0,v[B]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");y=T,g++}for(var N=b-y;N!==b&&v[N]===0;)N++;for(var L=l.repeat(h);N<b;++N)L+=e.charAt(v[N]);return L}function w(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var h=0;if(d[h]!==" "){for(var y=0,g=0;d[h]===l;)y++,h++;for(var m=(d.length-h)*u+1>>>0,b=new Uint8Array(m);d[h];){var v=r[d.charCodeAt(h)];if(v===255)return;for(var S=0,T=m-1;(v!==0||S<g)&&T!==-1;T--,S++)v+=a*b[T]>>>0,b[T]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=S,h++}if(d[h]!==" "){for(var B=m-g;B!==m&&b[B]===0;)B++;for(var N=new Uint8Array(y+(m-B)),L=y;B!==m;)N[L++]=b[B++];return N}}}function p(d){var h=w(d);if(h)return h;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:w,decode:p}}var fw=hw,dw=fw,pw=dw,yw=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ww=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wc(this,e)}},gw=class{constructor(e){this.decoders=e}or(e){return wc(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},wc=(e,t)=>new gw({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),bw=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new yw(e,t,r),this.decoder=new ww(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Fi=({name:e,prefix:t,encode:r,decode:n})=>new bw(e,t,r,n),Yr=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=pw(r,t);return Fi({prefix:e,name:t,encode:n,decode:o=>Bi(i(o))})},mw=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),a=0,l=0,u=0;for(let c=0;c<o;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<r|f,a+=r,a>=8&&(a-=8,s[u++]=255&l>>a)}if(a>=r||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s},vw=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>r;)s-=r,o+=t[i&a>>s];if(s&&(o+=t[i&a<<r-s]),n)for(;o.length*r&7;)o+="=";return o},fe=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Fi({prefix:t,name:e,encode(i){return vw(i,n,r)},decode(i){return mw(i,n,r,e)}}),Je=Yr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kw=Yr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),gc={};ie(gc,{base32:()=>Mr,base32hex:()=>Aw,base32hexpad:()=>Tw,base32hexpadupper:()=>Bw,base32hexupper:()=>Cw,base32pad:()=>Sw,base32padupper:()=>xw,base32upper:()=>Ew,base32z:()=>Fw});var Mr=fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ew=fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Sw=fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xw=fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Aw=fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Cw=fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Tw=fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bw=fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fw=fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Dl=(e,t)=>{let{bytes:r,version:n}=e;switch(n){case 0:return Lw(r,Lo(e),t||Je.encoder);default:return Iw(r,Lo(e),t||Mr.encoder)}},Nl=new WeakMap,Lo=e=>{let t=Nl.get(e);if(t==null){let r=new Map;return Nl.set(e,r),r}return t},ce=class pe{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==_r)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Uw)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return pe.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=Qn(t,r);return pe.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return pe.equals(this,t)}static equals(t,r){let n=r;return n&&t.code===n.code&&t.version===n.version&&cw(t.multihash,n.multihash)}toString(t){return Dl(this,t)}toJSON(){return{"/":Dl(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof pe)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:o,bytes:s}=r;return new pe(n,i,o,s||jl(n,i,o.bytes))}else if(r[Dw]===!0){let{version:n,multihash:i,code:o}=r,s=_o(i);return pe.create(n,o,s)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==_r)throw new Error(`Version 0 CID must use dag-pb (code: ${_r}) block encoding`);return new pe(t,r,n,n.bytes)}case 1:{let i=jl(t,r,n.bytes);return new pe(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return pe.create(0,_r,t)}static createV1(t,r){return pe.create(1,t,r)}static decode(t){let[r,n]=pe.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=pe.inspectBytes(t),n=r.size-r.multihashSize,i=Bi(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let o=i.subarray(r.multihashSize-r.digestSize),s=new ys(r.multihashCode,r.digestSize,o,i);return[r.version===0?pe.createV0(s):pe.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,w]=Fo(t.subarray(r));return r+=w,f},i=n(),o=_r;if(i===18?(i=0,r=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=r,a=n(),l=n(),u=r+l,c=u-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:u}}static parse(t,r){let[n,i]=_w(t,r),o=pe.decode(i);if(o.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Lo(o).set(n,t),o}},_w=(e,t)=>{switch(e[0]){case"Q":{let r=t||Je;return[Je.prefix,r.decode(`${Je.prefix}${e}`)]}case Je.prefix:{let r=t||Je;return[Je.prefix,r.decode(e)]}case Mr.prefix:{let r=t||Mr;return[Mr.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}},Lw=(e,t,r)=>{let{prefix:n}=r;if(n!==Je.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let o=r.encode(e).slice(1);return t.set(n,o),o}else return i},Iw=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let o=r.encode(e);return t.set(n,o),o}else return i},_r=112,Uw=18,jl=(e,t,r)=>{let n=Jn(e),i=n+Jn(t),o=new Uint8Array(i+r.byteLength);return Kn(e,o,0),Kn(t,o,n),o.set(r,i),o},Dw=Symbol.for("@ipld/js-cid/CID"),Nw=(e,t)=>ce.parse(e,t),qe,Bt=class{constructor(e){ar(this,qe,new Map),e&&Me(this,qe,new Map(e.map(t=>[t.cid.toString(),t.bytes])))}async get(e){let t=be(this,qe).get(e.toString());if(t)return{cid:e,bytes:t}}async put(e,t){be(this,qe).set(e.toString(),t)}putSync(e,t){be(this,qe).set(e.toString(),t)}async delete(e){be(this,qe).delete(e.toString())}deleteSync(e){be(this,qe).delete(e.toString())}*entries(){for(let[e,t]of be(this,qe))yield{cid:Nw(e),bytes:t}}};qe=new WeakMap;var Dn,_i=class{constructor(...e){ar(this,Dn,void 0),Me(this,Dn,e)}async get(e){for(let t of be(this,Dn)){let r=await t.get(e);if(r)return r}}};Dn=new WeakMap;var jw=class{constructor(e){x(this,"value"),x(this,"next"),this.value=e}},We,er,tr,zw=class{constructor(){ar(this,We,void 0),ar(this,er,void 0),ar(this,tr,void 0),this.clear()}enqueue(e){let t=new jw(e);be(this,We)?(be(this,er).next=t,Me(this,er,t)):(Me(this,We,t),Me(this,er,t)),Fl(this,tr)._++}dequeue(){let e=be(this,We);if(e)return Me(this,We,be(this,We).next),Fl(this,tr)._--,e.value}clear(){Me(this,We,void 0),Me(this,er,void 0),Me(this,tr,0)}get size(){return be(this,tr)}*[Symbol.iterator](){let e=be(this,We);for(;e;)yield e.value,e=e.next}};We=new WeakMap;er=new WeakMap;tr=new WeakMap;function bc(e){if(!((Number.isInteger(e)||e===Number.POSITIVE_INFINITY)&&e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let t=new zw,r=0,n=()=>{r--,t.size>0&&t.dequeue()()},i=async(a,l,u)=>{r++;let c=(async()=>a(...u))();l(c);try{await c}catch{}n()},o=(a,l,u)=>{t.enqueue(i.bind(void 0,a,l,u)),(async()=>(await Promise.resolve(),r<e&&t.size>0&&t.dequeue()()))()},s=(a,...l)=>new Promise(u=>{o(a,u,l)});return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),s}var he={};ie(he,{code:()=>Pc,decode:()=>Bs,encode:()=>Rc,name:()=>Hb});var Mw=["string","number","bigint","symbol"],Ow=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function $w(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";let t=typeof e;return Mw.includes(t)?t:t==="function"?"Function":Array.isArray(e)?"Array":Pw(e)?"Buffer":Rw(e)||"Object"}function Pw(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function Rw(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(Ow.includes(t))return t}var k=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};k.uint=new k(0,"uint",!0);k.negint=new k(1,"negint",!0);k.bytes=new k(2,"bytes",!0);k.string=new k(3,"string",!0);k.array=new k(4,"array",!1);k.map=new k(5,"map",!1);k.tag=new k(6,"tag",!1);k.float=new k(7,"float",!0);k.false=new k(7,"false",!0);k.true=new k(7,"true",!0);k.null=new k(7,"null",!0);k.undefined=new k(7,"undefined",!0);k.break=new k(7,"break",!0);var F=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},dr=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",Hw=new TextDecoder,Vw=new TextEncoder;function Zn(e){return dr&&globalThis.Buffer.isBuffer(e)}function ws(e){return e instanceof Uint8Array?Zn(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var qw=dr?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):Ml(e,t,r):(e,t,r)=>r-t>64?Hw.decode(e.subarray(t,r)):Ml(e,t,r),mc=dr?e=>e.length>64?globalThis.Buffer.from(e):zl(e):e=>e.length>64?Vw.encode(e):zl(e),Re=e=>Uint8Array.from(e),gs=dr?(e,t,r)=>Zn(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),Ww=dr?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),ws(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let i of e)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},Gw=dr?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Kw(e,t){if(Zn(e)&&Zn(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function zl(e,t=1/0){let r,n=e.length,i=null,o=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return o}function Ml(e,t,r){let n=[];for(;t<r;){let i=e[t],o=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=r){let a,l,u,c;switch(s){case 1:i<128&&(o=i);break;case 2:a=e[t+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(o=c));break;case 3:a=e[t+1],l=e[t+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:a=e[t+1],l=e[t+2],u=e[t+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),t+=s}return vc(n)}var Ol=4096;function vc(e){let t=e.length;if(t<=Ol)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Ol));return r}var Jw=256,kc=class{constructor(e=Jw){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let r=t.length-(this.maxCursor-this.cursor)-1;r<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,r),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Gw(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=gs(r,0,this.cursor)}else t=Ww(this.chunks,this.cursor);return e&&this.reset(),t}},O="CBOR decode error:",At="CBOR encode error:",Xr=[];Xr[23]=1;Xr[24]=2;Xr[25]=3;Xr[26]=5;Xr[27]=9;function pr(e,t,r){if(e.length-t<r)throw new Error(`${O} not enough data for type`)}var ae=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ft(e,t,r){pr(e,t,1);let n=e[t];if(r.strict===!0&&n<ae[0])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function _t(e,t,r){pr(e,t,2);let n=e[t]<<8|e[t+1];if(r.strict===!0&&n<ae[1])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function Lt(e,t,r){pr(e,t,4);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<ae[2])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);return n}function It(e,t,r){pr(e,t,8);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&o<ae[3])throw new Error(`${O} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(r.allowBigInt===!0)return o;throw new Error(`${O} integers outside of the safe integer range are not supported`)}function Qw(e,t,r,n){return new F(k.uint,Ft(e,t+1,n),2)}function Zw(e,t,r,n){return new F(k.uint,_t(e,t+1,n),3)}function Yw(e,t,r,n){return new F(k.uint,Lt(e,t+1,n),5)}function Xw(e,t,r,n){return new F(k.uint,It(e,t+1,n),9)}function Ut(e,t){return Fe(e,0,t.value)}function Fe(e,t,r){if(r<ae[0]){let n=Number(r);e.push([t|n])}else if(r<ae[1]){let n=Number(r);e.push([t|24,n])}else if(r<ae[2]){let n=Number(r);e.push([t|25,n>>>8,n&255])}else if(r<ae[3]){let n=Number(r);e.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<ae[4]){let i=[t|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,e.push(i)}else throw new Error(`${O} encountered BigInt larger than allowable range`)}}Ut.encodedSize=function e(t){return Fe.encodedSize(t.value)};Fe.encodedSize=function e(t){return t<ae[0]?1:t<ae[1]?2:t<ae[2]?3:t<ae[3]?5:9};Ut.compareTokens=function e(t,r){return t.value<r.value?-1:t.value>r.value?1:0};function eg(e,t,r,n){return new F(k.negint,-1-Ft(e,t+1,n),2)}function tg(e,t,r,n){return new F(k.negint,-1-_t(e,t+1,n),3)}function rg(e,t,r,n){return new F(k.negint,-1-Lt(e,t+1,n),5)}var bs=BigInt(-1),Ec=BigInt(1);function ng(e,t,r,n){let i=It(e,t+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new F(k.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${O} integers outside of the safe integer range are not supported`);return new F(k.negint,bs-BigInt(i),9)}function ms(e,t){let r=t.value,n=typeof r=="bigint"?r*bs-Ec:r*-1-1;Fe(e,t.type.majorEncoded,n)}ms.encodedSize=function e(t){let r=t.value,n=typeof r=="bigint"?r*bs-Ec:r*-1-1;return n<ae[0]?1:n<ae[1]?2:n<ae[2]?3:n<ae[3]?5:9};ms.compareTokens=function e(t,r){return t.value<r.value?1:t.value>r.value?-1:0};function en(e,t,r,n){pr(e,t,r+n);let i=gs(e,t+r,t+r+n);return new F(k.bytes,i,r+n)}function ig(e,t,r,n){return en(e,t,1,r)}function og(e,t,r,n){return en(e,t,2,Ft(e,t+1,n))}function sg(e,t,r,n){return en(e,t,3,_t(e,t+1,n))}function ag(e,t,r,n){return en(e,t,5,Lt(e,t+1,n))}function lg(e,t,r,n){let i=It(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer bytes lengths not supported`);return en(e,t,9,i)}function Yn(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===k.string?mc(e.value):e.value),e.encodedBytes}function Li(e,t){let r=Yn(t);Fe(e,t.type.majorEncoded,r.length),e.push(r)}Li.encodedSize=function e(t){let r=Yn(t);return Fe.encodedSize(r.length)+r.length};Li.compareTokens=function e(t,r){return ug(Yn(t),Yn(r))};function ug(e,t){return e.length<t.length?-1:e.length>t.length?1:Kw(e,t)}function tn(e,t,r,n,i){let o=r+n;pr(e,t,o);let s=new F(k.string,qw(e,t+r,t+o),o);return i.retainStringBytes===!0&&(s.byteValue=gs(e,t+r,t+o)),s}function cg(e,t,r,n){return tn(e,t,1,r,n)}function hg(e,t,r,n){return tn(e,t,2,Ft(e,t+1,n),n)}function fg(e,t,r,n){return tn(e,t,3,_t(e,t+1,n),n)}function dg(e,t,r,n){return tn(e,t,5,Lt(e,t+1,n),n)}function pg(e,t,r,n){let i=It(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer string lengths not supported`);return tn(e,t,9,i,n)}var yg=Li;function yr(e,t,r,n){return new F(k.array,n,r)}function wg(e,t,r,n){return yr(e,t,1,r)}function gg(e,t,r,n){return yr(e,t,2,Ft(e,t+1,n))}function bg(e,t,r,n){return yr(e,t,3,_t(e,t+1,n))}function mg(e,t,r,n){return yr(e,t,5,Lt(e,t+1,n))}function vg(e,t,r,n){let i=It(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer array lengths not supported`);return yr(e,t,9,i)}function kg(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return yr(e,t,1,1/0)}function vs(e,t){Fe(e,k.array.majorEncoded,t.value)}vs.compareTokens=Ut.compareTokens;vs.encodedSize=function e(t){return Fe.encodedSize(t.value)};function wr(e,t,r,n){return new F(k.map,n,r)}function Eg(e,t,r,n){return wr(e,t,1,r)}function Sg(e,t,r,n){return wr(e,t,2,Ft(e,t+1,n))}function xg(e,t,r,n){return wr(e,t,3,_t(e,t+1,n))}function Ag(e,t,r,n){return wr(e,t,5,Lt(e,t+1,n))}function Cg(e,t,r,n){let i=It(e,t+1,n);if(typeof i=="bigint")throw new Error(`${O} 64-bit integer map lengths not supported`);return wr(e,t,9,i)}function Tg(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return wr(e,t,1,1/0)}function ks(e,t){Fe(e,k.map.majorEncoded,t.value)}ks.compareTokens=Ut.compareTokens;ks.encodedSize=function e(t){return Fe.encodedSize(t.value)};function Bg(e,t,r,n){return new F(k.tag,r,1)}function Fg(e,t,r,n){return new F(k.tag,Ft(e,t+1,n),2)}function _g(e,t,r,n){return new F(k.tag,_t(e,t+1,n),3)}function Lg(e,t,r,n){return new F(k.tag,Lt(e,t+1,n),5)}function Ig(e,t,r,n){return new F(k.tag,It(e,t+1,n),9)}function Es(e,t){Fe(e,k.tag.majorEncoded,t.value)}Es.compareTokens=Ut.compareTokens;Es.encodedSize=function e(t){return Fe.encodedSize(t.value)};var Ug=20,Dg=21,Ng=22,jg=23;function zg(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${O} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new F(k.null,null,1):new F(k.undefined,void 0,1)}function Mg(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${O} indefinite length items not allowed`);return new F(k.break,void 0,1)}function Ss(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${O} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${O} Infinity values are not supported`)}return new F(k.float,e,t)}function Og(e,t,r,n){return Ss(As(e,t+1),3,n)}function $g(e,t,r,n){return Ss(Cs(e,t+1),5,n)}function Pg(e,t,r,n){return Ss(Cc(e,t+1),9,n)}function xs(e,t,r){let n=t.value;if(n===!1)e.push([k.float.majorEncoded|Ug]);else if(n===!0)e.push([k.float.majorEncoded|Dg]);else if(n===null)e.push([k.float.majorEncoded|Ng]);else if(n===void 0)e.push([k.float.majorEncoded|jg]);else{let i,o=!1;(!r||r.float64!==!0)&&(xc(n),i=As(Ne,1),n===i||Number.isNaN(n)?(Ne[0]=249,e.push(Ne.slice(0,3)),o=!0):(Ac(n),i=Cs(Ne,1),n===i&&(Ne[0]=250,e.push(Ne.slice(0,5)),o=!0))),o||(Rg(n),i=Cc(Ne,1),Ne[0]=251,e.push(Ne.slice(0,9)))}}xs.encodedSize=function e(t,r){let n=t.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!r||r.float64!==!0){xc(n);let i=As(Ne,1);if(n===i||Number.isNaN(n))return 3;if(Ac(n),i=Cs(Ne,1),n===i)return 5}return 9};var Sc=new ArrayBuffer(9),Ce=new DataView(Sc,1),Ne=new Uint8Array(Sc,0);function xc(e){if(e===1/0)Ce.setUint16(0,31744,!1);else if(e===-1/0)Ce.setUint16(0,64512,!1);else if(Number.isNaN(e))Ce.setUint16(0,32256,!1);else{Ce.setFloat32(0,e);let t=Ce.getUint32(0),r=(t&2139095040)>>23,n=t&8388607;if(r===255)Ce.setUint16(0,31744,!1);else if(r===0)Ce.setUint16(0,(e&2147483648)>>16|n>>13,!1);else{let i=r-127;i<-24?Ce.setUint16(0,0):i<-14?Ce.setUint16(0,(t&2147483648)>>16|1<<24+i,!1):Ce.setUint16(0,(t&2147483648)>>16|i+15<<10|n>>13,!1)}}}function As(e,t){if(e.length-t<2)throw new Error(`${O} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=r&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,r&32768?-o:o}function Ac(e){Ce.setFloat32(0,e,!1)}function Cs(e,t){if(e.length-t<4)throw new Error(`${O} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function Rg(e){Ce.setFloat64(0,e,!1)}function Cc(e,t){if(e.length-t<8)throw new Error(`${O} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}xs.compareTokens=Ut.compareTokens;function q(e,t,r){throw new Error(`${O} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function Ii(e){return()=>{throw new Error(`${O} ${e}`)}}var I=[];for(let e=0;e<=23;e++)I[e]=q;I[24]=Qw;I[25]=Zw;I[26]=Yw;I[27]=Xw;I[28]=q;I[29]=q;I[30]=q;I[31]=q;for(let e=32;e<=55;e++)I[e]=q;I[56]=eg;I[57]=tg;I[58]=rg;I[59]=ng;I[60]=q;I[61]=q;I[62]=q;I[63]=q;for(let e=64;e<=87;e++)I[e]=ig;I[88]=og;I[89]=sg;I[90]=ag;I[91]=lg;I[92]=q;I[93]=q;I[94]=q;I[95]=Ii("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)I[e]=cg;I[120]=hg;I[121]=fg;I[122]=dg;I[123]=pg;I[124]=q;I[125]=q;I[126]=q;I[127]=Ii("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)I[e]=wg;I[152]=gg;I[153]=bg;I[154]=mg;I[155]=vg;I[156]=q;I[157]=q;I[158]=q;I[159]=kg;for(let e=160;e<=183;e++)I[e]=Eg;I[184]=Sg;I[185]=xg;I[186]=Ag;I[187]=Cg;I[188]=q;I[189]=q;I[190]=q;I[191]=Tg;for(let e=192;e<=215;e++)I[e]=Bg;I[216]=Fg;I[217]=_g;I[218]=Lg;I[219]=Ig;I[220]=q;I[221]=q;I[222]=q;I[223]=q;for(let e=224;e<=243;e++)I[e]=Ii("simple values are not supported");I[244]=q;I[245]=q;I[246]=q;I[247]=zg;I[248]=Ii("simple values are not supported");I[249]=Og;I[250]=$g;I[251]=Pg;I[252]=q;I[253]=q;I[254]=q;I[255]=Mg;var $e=[];for(let e=0;e<24;e++)$e[e]=new F(k.uint,e,1);for(let e=-1;e>=-24;e--)$e[31-e]=new F(k.negint,e,1);$e[64]=new F(k.bytes,new Uint8Array(0),1);$e[96]=new F(k.string,"",1);$e[128]=new F(k.array,0,1);$e[160]=new F(k.map,0,1);$e[244]=new F(k.false,!1,1);$e[245]=new F(k.true,!0,1);$e[246]=new F(k.null,null,1);function Hg(e){switch(e.type){case k.false:return Re([244]);case k.true:return Re([245]);case k.null:return Re([246]);case k.bytes:return e.value.length?void 0:Re([64]);case k.string:return e.value===""?Re([96]):void 0;case k.array:return e.value===0?Re([128]):void 0;case k.map:return e.value===0?Re([160]):void 0;case k.uint:return e.value<24?Re([Number(e.value)]):void 0;case k.negint:if(e.value>=-24)return Re([31-Number(e.value)])}}var Vg={float64:!1,mapSorter:Gg,quickEncodeToken:Hg};function qg(){let e=[];return e[k.uint.major]=Ut,e[k.negint.major]=ms,e[k.bytes.major]=Li,e[k.string.major]=yg,e[k.array.major]=vs,e[k.map.major]=ks,e[k.tag.major]=Es,e[k.float.major]=xs,e}var Tc=qg(),co=new kc,$l=class Bc{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${At} object contains circular references`);return new Bc(r,t)}},nt={null:new F(k.null,null),undefined:new F(k.undefined,void 0),true:new F(k.true,!0),false:new F(k.false,!1),emptyArray:new F(k.array,0),emptyMap:new F(k.map,0)},yt={number(e,t,r,n){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new F(k.float,e):e>=0?new F(k.uint,e):new F(k.negint,e)},bigint(e,t,r,n){return e>=BigInt(0)?new F(k.uint,e):new F(k.negint,e)},Uint8Array(e,t,r,n){return new F(k.bytes,e)},string(e,t,r,n){return new F(k.string,e)},boolean(e,t,r,n){return e?nt.true:nt.false},null(e,t,r,n){return nt.null},undefined(e,t,r,n){return nt.undefined},ArrayBuffer(e,t,r,n){return new F(k.bytes,new Uint8Array(e))},DataView(e,t,r,n){return new F(k.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[nt.emptyArray,new F(k.break)]:nt.emptyArray;n=$l.createCheck(n,e);let i=[],o=0;for(let s of e)i[o++]=Nn(s,r,n);return r.addBreakTokens?[new F(k.array,e.length),i,new F(k.break)]:[new F(k.array,e.length),i]},Object(e,t,r,n){let i=t!=="Object",o=i?e.keys():Object.keys(e),s=i?e.size:o.length;if(!s)return r.addBreakTokens===!0?[nt.emptyMap,new F(k.break)]:nt.emptyMap;n=$l.createCheck(n,e);let a=[],l=0;for(let u of o)a[l++]=[Nn(u,r,n),Nn(i?e.get(u):e[u],r,n)];return Wg(a,r),r.addBreakTokens?[new F(k.map,s),a,new F(k.break)]:[new F(k.map,s),a]}};yt.Map=yt.Object;yt.Buffer=yt.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))yt[`${e}Array`]=yt.DataView;function Nn(e,t={},r){let n=$w(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||yt[n];if(typeof i=="function"){let s=i(e,n,t,r);if(s!=null)return s}let o=yt[n];if(!o)throw new Error(`${At} unsupported type: ${n}`);return o(e,n,t,r)}function Wg(e,t){t.mapSorter&&e.sort(t.mapSorter)}function Gg(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=r.type.major,o=Tc[i].compareTokens(r,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function Fc(e,t,r,n){if(Array.isArray(t))for(let i of t)Fc(e,i,r,n);else r[t.type.major](e,t,n)}function _c(e,t,r){let n=Nn(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let i=r.quickEncodeToken(n);if(i)return i;let o=t[n.type.major];if(o.encodedSize){let s=o.encodedSize(n,r),a=new kc(s);if(o(a,n,r),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return ws(a.chunks[0])}}return co.reset(),Fc(co,n,t,r),co.toBytes(!0)}function Kg(e,t){return t=Object.assign({},Vg,t),_c(e,Tc,t)}var Jg={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Qg=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=$e[e];if(t===void 0){let r=I[e];if(!r)throw new Error(`${O} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let n=e&31;t=r(this.data,this.pos,n,this.options)}return this.pos+=t.encodedLength,t}},Vr=Symbol.for("DONE"),Ui=Symbol.for("BREAK");function Zg(e,t,r){let n=[];for(let i=0;i<e.value;i++){let o=qr(t,r);if(o===Ui){if(e.value===1/0)break;throw new Error(`${O} got unexpected break to lengthed array`)}if(o===Vr)throw new Error(`${O} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=o}return n}function Yg(e,t,r){let n=r.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<e.value;s++){let a=qr(t,r);if(a===Ui){if(e.value===1/0)break;throw new Error(`${O} got unexpected break to lengthed map`)}if(a===Vr)throw new Error(`${O} found map but not enough entries (got ${s} [no key], expected ${e.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${O} non-string keys not supported (got ${typeof a})`);if(r.rejectDuplicateMapKeys===!0&&(n&&o.has(a)||!n&&a in i))throw new Error(`${O} found repeat map key "${a}"`);let l=qr(t,r);if(l===Vr)throw new Error(`${O} found map but not enough entries (got ${s} [no value], expected ${e.value})`);n?o.set(a,l):i[a]=l}return n?o:i}function qr(e,t){if(e.done())return Vr;let r=e.next();if(r.type===k.break)return Ui;if(r.type.terminal)return r.value;if(r.type===k.array)return Zg(r,e,t);if(r.type===k.map)return Yg(r,e,t);if(r.type===k.tag){if(t.tags&&typeof t.tags[r.value]=="function"){let n=qr(e,t);return t.tags[r.value](n)}throw new Error(`${O} tag not supported (${r.value})`)}throw new Error("unsupported")}function Lc(e,t){if(!(e instanceof Uint8Array))throw new Error(`${O} data to decode must be a Uint8Array`);t=Object.assign({},Jg,t);let r=t.tokenizer||new Qg(e,t),n=qr(r,t);if(n===Vr)throw new Error(`${O} did not find any content to decode`);if(n===Ui)throw new Error(`${O} got unexpected break`);if(!r.done())throw new Error(`${O} too many terminals, data makes no sense`);return n}var Xg=Ic,Pl=128,eb=127,tb=~eb,rb=Math.pow(2,31);function Ic(e,t,r){t=t||[],r=r||0;for(var n=r;e>=rb;)t[r++]=e&255|Pl,e/=128;for(;e&tb;)t[r++]=e&255|Pl,e>>>=7;return t[r]=e|0,Ic.bytes=r-n+1,t}var nb=Io,ib=128,Rl=127;function Io(e,n){var r=0,n=n||0,i=0,o=n,s,a=e.length;do{if(o>=a)throw Io.bytes=0,new RangeError("Could not decode varint");s=e[o++],r+=i<28?(s&Rl)<<i:(s&Rl)*Math.pow(2,i),i+=7}while(s>=ib);return Io.bytes=o-n,r}var ob=Math.pow(2,7),sb=Math.pow(2,14),ab=Math.pow(2,21),lb=Math.pow(2,28),ub=Math.pow(2,35),cb=Math.pow(2,42),hb=Math.pow(2,49),fb=Math.pow(2,56),db=Math.pow(2,63),pb=function(e){return e<ob?1:e<sb?2:e<ab?3:e<lb?4:e<ub?5:e<cb?6:e<hb?7:e<fb?8:e<db?9:10},yb={encode:Xg,decode:nb,encodingLength:pb},wb=yb,Xn=wb,Uo=(e,t=0)=>[Xn.decode(e,t),Xn.decode.bytes],ei=(e,t,r=0)=>(Xn.encode(e,t,r),t),ti=e=>Xn.encodingLength(e),Di={};ie(Di,{coerce:()=>Dt,empty:()=>Uc,equals:()=>Dc,fromHex:()=>bb,fromString:()=>vb,isBinary:()=>mb,toHex:()=>gb,toString:()=>kb});var Uc=new Uint8Array(0),gb=e=>e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),""),bb=e=>{let t=e.match(/../g);return t?new Uint8Array(t.map(r=>parseInt(r,16))):Uc},Dc=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},Dt=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},mb=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),vb=e=>new TextEncoder().encode(e),kb=e=>new TextDecoder().decode(e),ri=(e,t)=>{let r=t.byteLength,n=ti(e),i=n+ti(r),o=new Uint8Array(i+r);return ei(e,o,0),ei(r,o,n),o.set(t,i),new Ts(e,r,t,o)},Nc=e=>{let t=Dt(e),[r,n]=Uo(t),[i,o]=Uo(t.subarray(n)),s=t.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Ts(r,i,s,t)},Eb=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Dc(e.bytes,r.bytes)}},Ts=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}};function Sb(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(r[s]!==255)throw new TypeError(o+" is ambiguous");r[s]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var h=0,y=0,g=0,m=d.length;g!==m&&d[g]===0;)g++,h++;for(var b=(m-g)*c+1>>>0,v=new Uint8Array(b);g!==m;){for(var S=d[g],T=0,B=b-1;(S!==0||T<y)&&B!==-1;B--,T++)S+=256*v[B]>>>0,v[B]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");y=T,g++}for(var N=b-y;N!==b&&v[N]===0;)N++;for(var L=l.repeat(h);N<b;++N)L+=e.charAt(v[N]);return L}function w(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var h=0;if(d[h]!==" "){for(var y=0,g=0;d[h]===l;)y++,h++;for(var m=(d.length-h)*u+1>>>0,b=new Uint8Array(m);d[h];){var v=r[d.charCodeAt(h)];if(v===255)return;for(var S=0,T=m-1;(v!==0||S<g)&&T!==-1;T--,S++)v+=a*b[T]>>>0,b[T]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=S,h++}if(d[h]!==" "){for(var B=m-g;B!==m&&b[B]===0;)B++;for(var N=new Uint8Array(y+(m-B)),L=y;B!==m;)N[L++]=b[B++];return N}}}function p(d){var h=w(d);if(h)return h;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:w,decode:p}}var xb=Sb,Ab=xb,Cb=Ab,Tb=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Bb=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return jc(this,e)}},Fb=class{constructor(e){this.decoders=e}or(e){return jc(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},jc=(e,t)=>new Fb({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),_b=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Tb(e,t,r),this.decoder=new Bb(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},zc=({name:e,prefix:t,encode:r,decode:n})=>new _b(e,t,r,n),Mc=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=Cb(r,t);return zc({prefix:e,name:t,encode:n,decode:o=>Dt(i(o))})},Lb=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),a=0,l=0,u=0;for(let c=0;c<o;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<r|f,a+=r,a>=8&&(a-=8,s[u++]=255&l>>a)}if(a>=r||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s},Ib=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>r;)s-=r,o+=t[i&a>>s];if(s&&(o+=t[i&a<<r-s]),n)for(;o.length*r&7;)o+="=";return o},xe=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>zc({prefix:t,name:e,encode(i){return Ib(i,n,r)},decode(i){return Lb(i,n,r,e)}}),lt=Mc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),b4=Mc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),jn=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),m4=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),v4=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),k4=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),E4=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),S4=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),x4=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),A4=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),C4=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Hl=(e,t)=>{let{bytes:r,version:n}=e;switch(n){case 0:return Db(r,Do(e),t||lt.encoder);default:return Nb(r,Do(e),t||jn.encoder)}},Vl=new WeakMap,Do=e=>{let t=Vl.get(e);if(t==null){let r=new Map;return Vl.set(e,r),r}return t},ne=class ye{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Lr)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==jb)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ye.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=ri(t,r);return ye.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return ye.equals(this,t)}static equals(t,r){let n=r;return n&&t.code===n.code&&t.version===n.version&&Eb(t.multihash,n.multihash)}toString(t){return Hl(this,t)}toJSON(){return{"/":Hl(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof ye)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:o,bytes:s}=r;return new ye(n,i,o,s||ql(n,i,o.bytes))}else if(r[zb]===!0){let{version:n,multihash:i,code:o}=r,s=Nc(i);return ye.create(n,o,s)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Lr)throw new Error(`Version 0 CID must use dag-pb (code: ${Lr}) block encoding`);return new ye(t,r,n,n.bytes)}case 1:{let i=ql(t,r,n.bytes);return new ye(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return ye.create(0,Lr,t)}static createV1(t,r){return ye.create(1,t,r)}static decode(t){let[r,n]=ye.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=ye.inspectBytes(t),n=r.size-r.multihashSize,i=Dt(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let o=i.subarray(r.multihashSize-r.digestSize),s=new Ts(r.multihashCode,r.digestSize,o,i);return[r.version===0?ye.createV0(s):ye.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,w]=Uo(t.subarray(r));return r+=w,f},i=n(),o=Lr;if(i===18?(i=0,r=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=r,a=n(),l=n(),u=r+l,c=u-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:u}}static parse(t,r){let[n,i]=Ub(t,r),o=ye.decode(i);if(o.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Do(o).set(n,t),o}},Ub=(e,t)=>{switch(e[0]){case"Q":{let r=t||lt;return[lt.prefix,r.decode(`${lt.prefix}${e}`)]}case lt.prefix:{let r=t||lt;return[lt.prefix,r.decode(e)]}case jn.prefix:{let r=t||jn;return[jn.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}},Db=(e,t,r)=>{let{prefix:n}=r;if(n!==lt.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let o=r.encode(e).slice(1);return t.set(n,o),o}else return i},Nb=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let o=r.encode(e);return t.set(n,o),o}else return i},Lr=112,jb=18,ql=(e,t,r)=>{let n=ti(e),i=n+ti(t),o=new Uint8Array(i+r.byteLength);return ei(e,o,0),ei(t,o,n),o.set(r,i),o},zb=Symbol.for("@ipld/js-cid/CID"),Oc=42;function Mb(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=ne.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new F(k.tag,Oc),new F(k.bytes,r)]}function Ob(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function $b(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var Pb={float64:!0,typeEncoders:{Object:Mb,undefined:Ob,number:$b}};function Rb(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return ne.decode(e.subarray(1))}var $c={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};$c.tags[Oc]=Rb;var Hb="dag-cbor",Pc=113,Rc=e=>Kg(e,Pb),Bs=e=>Lc(e,$c),dt={Null:e=>e===null,Int:e=>Number.isInteger(e),Float:e=>typeof e=="number"&&Number.isFinite(e),String:e=>typeof e=="string",Bool:e=>typeof e=="boolean",Bytes:e=>e instanceof Uint8Array,Link:e=>!dt.Null(e)&&typeof e=="object"&&e.asCID===e,List:e=>Array.isArray(e),Map:e=>!dt.Null(e)&&typeof e=="object"&&e.asCID!==e&&!dt.List(e)&&!dt.Bytes(e)},rr={Int:dt.Int,"CarHeader > version":e=>rr.Int(e),"CarHeader > roots (anon) > valueType (anon)":dt.Link,"CarHeader > roots (anon)":e=>dt.List(e)&&Array.prototype.every.call(e,rr["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":e=>rr["CarHeader > roots (anon)"](e),CarHeader:e=>{let t=e&&Object.keys(e);return dt.Map(e)&&["version"].every(r=>t.includes(r))&&Object.entries(e).every(([r,n])=>rr["CarHeader > "+r]&&rr["CarHeader > "+r](n))}},Vb=rr.CarHeader,xt=X(fs(),1),ho={SHA2_256:18,LENGTH:32,DAG_PB:112},qb=16+8+8+8;function ni(e,t){if(!e.length)throw new Error("Unexpected end of data");let r=xt.default.decode(e);return t.seek(xt.default.decode.bytes),r}function Wb(e){let t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=0;return{version:2,characteristics:[t.getBigUint64(r,!0),t.getBigUint64(r+=8,!0)],dataOffset:Number(t.getBigUint64(r+=8,!0)),dataSize:Number(t.getBigUint64(r+=8,!0)),indexOffset:Number(t.getBigUint64(r+=8,!0))}}function Gb(e){xt.default.decode(e);let t=xt.default.decode.bytes,r=xt.default.decode(e.subarray(xt.default.decode.bytes)),n=xt.default.decode.bytes;return t+n+r}async function Hc(e,t){let r=ni(await e.upTo(8),e);if(r===0)throw new Error("Invalid CAR header (zero length)");let n=await e.exactly(r,!0),i=Bs(n);if(!Vb(i))throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||t!==void 0&&i.version!==t)throw new Error(`Invalid CAR version: ${i.version}${t!==void 0?` (expected ${t})`:""}`);let o=Array.isArray(i.roots);if(i.version===1&&!o||i.version===2&&o)throw new Error("Invalid CAR header format");if(i.version===1)return i;let s=Wb(await e.exactly(qb,!0));e.seek(s.dataOffset-e.pos);let a=await Hc(e,1);return Object.assign(a,s)}async function Kb(e){let t=await e.exactly(2,!1);if(t[0]===ho.SHA2_256&&t[1]===ho.LENGTH){let s=await e.exactly(34,!0),a=_o(s);return ce.create(0,ho.DAG_PB,a)}let r=ni(await e.upTo(8),e);if(r!==1)throw new Error(`Unexpected CID version (${r})`);let n=ni(await e.upTo(8),e),i=await e.exactly(Gb(await e.upTo(8)),!0),o=_o(i);return ce.create(r,n,o)}async function Vc(e){let t=e.pos,r=ni(await e.upTo(8),e);if(r===0)throw new Error("Invalid CAR section (zero length)");r+=e.pos-t;let n=await Kb(e),i=r-Number(e.pos-t);return{cid:n,length:r,blockLength:i}}async function Jb(e){let{cid:t,blockLength:r}=await Vc(e);return{bytes:await e.exactly(r,!0),cid:t}}async function Qb(e){let t=e.pos,{cid:r,length:n,blockLength:i}=await Vc(e),o={cid:r,length:n,blockLength:i,offset:t,blockOffset:e.pos};return e.seek(o.blockLength),o}function Fs(e){let t=(async()=>{let r=await Hc(e);if(r.version===2){let n=e.pos-r.dataOffset;e=Yb(e,r.dataSize-n)}return r})();return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await Jb(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await Qb(e)}}}function _s(e){let t=0;return{async upTo(r){return e.subarray(t,t+Math.min(r,e.length-t))},async exactly(r,n=!1){if(r>e.length-t)throw new Error("Unexpected end of data");let i=e.subarray(t,t+r);return n&&(t+=r),i},seek(r){t+=r},get pos(){return t}}}function Zb(e){let t=0,r=0,n=0,i=new Uint8Array(0),o=async s=>{r=i.length-n;let a=[i.subarray(n)];for(;r<s;){let u=await e();if(u==null)break;r<0?u.length>r&&a.push(u.subarray(-r)):a.push(u),r+=u.length}i=new Uint8Array(a.reduce((u,c)=>u+c.length,0));let l=0;for(let u of a)i.set(u,l),l+=u.length;n=0};return{async upTo(s){return i.length-n<s&&await o(s),i.subarray(n,n+Math.min(i.length-n,s))},async exactly(s,a=!1){if(i.length-n<s&&await o(s),i.length-n<s)throw new Error("Unexpected end of data");let l=i.subarray(n,n+s);return a&&(t+=s,n+=s),l},seek(s){t+=s,n+=s},get pos(){return t}}}function Ls(e){let t=e[Symbol.asyncIterator]();async function r(){let n=await t.next();return n.done?null:n.value}return Zb(r)}function Yb(e,t){let r=0;return{async upTo(n){let i=await e.upTo(n);return i.length+r>t&&(i=i.subarray(0,t-r)),i},async exactly(n,i=!1){let o=await e.exactly(n,i);if(o.length+r>t)throw new Error("Unexpected end of data");return i&&(r+=n),o},seek(n){r+=n,e.seek(n)},get pos(){return e.pos}}}var qc=class{constructor(e,t){this._header=e,this._blocks=t,this._keys=t.map(r=>r.cid.toString())}get version(){return this._header.version}async getRoots(){return this._header.roots}async has(e){return this._keys.indexOf(e.toString())>-1}async get(e){let t=this._keys.indexOf(e.toString());return t>-1?this._blocks[t]:void 0}async*blocks(){for(let e of this._blocks)yield e}async*cids(){for(let e of this._blocks)yield e.cid}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Wl(_s(e))}static async fromIterable(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Wl(Ls(e))}};async function Wl(e){let t=Fs(e),r=await t.header(),n=[];for await(let i of t.blocks())n.push(i);return new qc(r,n)}var Xb=class{constructor(e,t,r){this._version=e,this._roots=t,this._iterator=r}get version(){return this._version}async getRoots(){return this._roots}[Symbol.asyncIterator](){return this._iterator}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Gl(_s(e))}static async fromIterable(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Gl(Ls(e))}};async function Gl(e){let t=Fs(e),{version:r,roots:n}=await t.header();return new Xb(r,n,t.blocksIndex())}var Wc=class{constructor(e,t,r){this._version=e,this._roots=t,this._iterable=r,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},T4=class No extends Wc{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(t){let{version:r,roots:n,iterator:i}=await Gc(t);return new No(r,n,i)}static async fromIterable(t){let{version:r,roots:n,iterator:i}=await Kc(t);return new No(r,n,i)}},B4=class jo extends Wc{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;let t=this._iterable[Symbol.asyncIterator]();return{async next(){let r=await t.next();return r.done?r:{done:!1,value:r.value.cid}}}}static async fromBytes(t){let{version:r,roots:n,iterator:i}=await Gc(t);return new jo(r,n,i)}static async fromIterable(t){let{version:r,roots:n,iterator:i}=await Kc(t);return new jo(r,n,i)}};async function Gc(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Jc(_s(e))}async function Kc(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Jc(Ls(e))}async function Jc(e){let t=Fs(e),{version:r,roots:n}=await t.header();return{version:r,roots:n,iterator:t.blocks()}}var F4=X(fs(),1),_4=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}},Ni=X(fs(),1),e1=["string","number","bigint","symbol"],t1=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function r1(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";let t=typeof e;return e1.includes(t)?t:t==="function"?"Function":Array.isArray(e)?"Array":n1(e)?"Buffer":i1(e)||"Object"}function n1(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function i1(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(t1.includes(t))return t}var A=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};A.uint=new A(0,"uint",!0);A.negint=new A(1,"negint",!0);A.bytes=new A(2,"bytes",!0);A.string=new A(3,"string",!0);A.array=new A(4,"array",!1);A.map=new A(5,"map",!1);A.tag=new A(6,"tag",!1);A.float=new A(7,"float",!0);A.false=new A(7,"false",!0);A.true=new A(7,"true",!0);A.null=new A(7,"null",!0);A.undefined=new A(7,"undefined",!0);A.break=new A(7,"break",!0);var z=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},gr=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",o1=new TextDecoder,s1=new TextEncoder;function ii(e){return gr&&globalThis.Buffer.isBuffer(e)}function a1(e){return e instanceof Uint8Array?ii(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var l1=gr?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):Jl(e,t,r):(e,t,r)=>r-t>64?o1.decode(e.subarray(t,r)):Jl(e,t,r),u1=gr?e=>e.length>64?globalThis.Buffer.from(e):Kl(e):e=>e.length>64?s1.encode(e):Kl(e),He=e=>Uint8Array.from(e),Is=gr?(e,t,r)=>ii(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),c1=gr?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),a1(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let i of e)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},h1=gr?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function f1(e,t){if(ii(e)&&ii(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function Kl(e,t=1/0){let r,n=e.length,i=null,o=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return o}function Jl(e,t,r){let n=[];for(;t<r;){let i=e[t],o=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=r){let a,l,u,c;switch(s){case 1:i<128&&(o=i);break;case 2:a=e[t+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(o=c));break;case 3:a=e[t+1],l=e[t+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:a=e[t+1],l=e[t+2],u=e[t+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),t+=s}return d1(n)}var Ql=4096;function d1(e){let t=e.length;if(t<=Ql)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Ql));return r}var p1=256,y1=class{constructor(e=p1){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let r=t.length-(this.maxCursor-this.cursor)-1;r<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,r),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=h1(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Is(r,0,this.cursor)}else t=c1(this.chunks,this.cursor);return e&&this.reset(),t}},Y="CBOR decode error:",Qc="CBOR encode error:",rn=[];rn[23]=1;rn[24]=2;rn[25]=3;rn[26]=5;rn[27]=9;function br(e,t,r){if(e.length-t<r)throw new Error(`${Y} not enough data for type`)}var le=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Nt(e,t,r){br(e,t,1);let n=e[t];if(r.strict===!0&&n<le[0])throw new Error(`${Y} integer encoded in more bytes than necessary (strict decode)`);return n}function jt(e,t,r){br(e,t,2);let n=e[t]<<8|e[t+1];if(r.strict===!0&&n<le[1])throw new Error(`${Y} integer encoded in more bytes than necessary (strict decode)`);return n}function zt(e,t,r){br(e,t,4);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<le[2])throw new Error(`${Y} integer encoded in more bytes than necessary (strict decode)`);return n}function Mt(e,t,r){br(e,t,8);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&o<le[3])throw new Error(`${Y} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(r.allowBigInt===!0)return o;throw new Error(`${Y} integers outside of the safe integer range are not supported`)}function w1(e,t,r,n){return new z(A.uint,Nt(e,t+1,n),2)}function g1(e,t,r,n){return new z(A.uint,jt(e,t+1,n),3)}function b1(e,t,r,n){return new z(A.uint,zt(e,t+1,n),5)}function m1(e,t,r,n){return new z(A.uint,Mt(e,t+1,n),9)}function Ot(e,t){return _e(e,0,t.value)}function _e(e,t,r){if(r<le[0]){let n=Number(r);e.push([t|n])}else if(r<le[1]){let n=Number(r);e.push([t|24,n])}else if(r<le[2]){let n=Number(r);e.push([t|25,n>>>8,n&255])}else if(r<le[3]){let n=Number(r);e.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<le[4]){let i=[t|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,e.push(i)}else throw new Error(`${Y} encountered BigInt larger than allowable range`)}}Ot.encodedSize=function e(t){return _e.encodedSize(t.value)};_e.encodedSize=function e(t){return t<le[0]?1:t<le[1]?2:t<le[2]?3:t<le[3]?5:9};Ot.compareTokens=function e(t,r){return t.value<r.value?-1:t.value>r.value?1:0};function v1(e,t,r,n){return new z(A.negint,-1-Nt(e,t+1,n),2)}function k1(e,t,r,n){return new z(A.negint,-1-jt(e,t+1,n),3)}function E1(e,t,r,n){return new z(A.negint,-1-zt(e,t+1,n),5)}var Us=BigInt(-1),Zc=BigInt(1);function S1(e,t,r,n){let i=Mt(e,t+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new z(A.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${Y} integers outside of the safe integer range are not supported`);return new z(A.negint,Us-BigInt(i),9)}function Ds(e,t){let r=t.value,n=typeof r=="bigint"?r*Us-Zc:r*-1-1;_e(e,t.type.majorEncoded,n)}Ds.encodedSize=function e(t){let r=t.value,n=typeof r=="bigint"?r*Us-Zc:r*-1-1;return n<le[0]?1:n<le[1]?2:n<le[2]?3:n<le[3]?5:9};Ds.compareTokens=function e(t,r){return t.value<r.value?1:t.value>r.value?-1:0};function nn(e,t,r,n){br(e,t,r+n);let i=Is(e,t+r,t+r+n);return new z(A.bytes,i,r+n)}function x1(e,t,r,n){return nn(e,t,1,r)}function A1(e,t,r,n){return nn(e,t,2,Nt(e,t+1,n))}function C1(e,t,r,n){return nn(e,t,3,jt(e,t+1,n))}function T1(e,t,r,n){return nn(e,t,5,zt(e,t+1,n))}function B1(e,t,r,n){let i=Mt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${Y} 64-bit integer bytes lengths not supported`);return nn(e,t,9,i)}function oi(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===A.string?u1(e.value):e.value),e.encodedBytes}function ji(e,t){let r=oi(t);_e(e,t.type.majorEncoded,r.length),e.push(r)}ji.encodedSize=function e(t){let r=oi(t);return _e.encodedSize(r.length)+r.length};ji.compareTokens=function e(t,r){return F1(oi(t),oi(r))};function F1(e,t){return e.length<t.length?-1:e.length>t.length?1:f1(e,t)}function on(e,t,r,n,i){let o=r+n;br(e,t,o);let s=new z(A.string,l1(e,t+r,t+o),o);return i.retainStringBytes===!0&&(s.byteValue=Is(e,t+r,t+o)),s}function _1(e,t,r,n){return on(e,t,1,r,n)}function L1(e,t,r,n){return on(e,t,2,Nt(e,t+1,n),n)}function I1(e,t,r,n){return on(e,t,3,jt(e,t+1,n),n)}function U1(e,t,r,n){return on(e,t,5,zt(e,t+1,n),n)}function D1(e,t,r,n){let i=Mt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${Y} 64-bit integer string lengths not supported`);return on(e,t,9,i,n)}var N1=ji;function mr(e,t,r,n){return new z(A.array,n,r)}function j1(e,t,r,n){return mr(e,t,1,r)}function z1(e,t,r,n){return mr(e,t,2,Nt(e,t+1,n))}function M1(e,t,r,n){return mr(e,t,3,jt(e,t+1,n))}function O1(e,t,r,n){return mr(e,t,5,zt(e,t+1,n))}function $1(e,t,r,n){let i=Mt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${Y} 64-bit integer array lengths not supported`);return mr(e,t,9,i)}function P1(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${Y} indefinite length items not allowed`);return mr(e,t,1,1/0)}function Ns(e,t){_e(e,A.array.majorEncoded,t.value)}Ns.compareTokens=Ot.compareTokens;Ns.encodedSize=function e(t){return _e.encodedSize(t.value)};function vr(e,t,r,n){return new z(A.map,n,r)}function R1(e,t,r,n){return vr(e,t,1,r)}function H1(e,t,r,n){return vr(e,t,2,Nt(e,t+1,n))}function V1(e,t,r,n){return vr(e,t,3,jt(e,t+1,n))}function q1(e,t,r,n){return vr(e,t,5,zt(e,t+1,n))}function W1(e,t,r,n){let i=Mt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${Y} 64-bit integer map lengths not supported`);return vr(e,t,9,i)}function G1(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${Y} indefinite length items not allowed`);return vr(e,t,1,1/0)}function js(e,t){_e(e,A.map.majorEncoded,t.value)}js.compareTokens=Ot.compareTokens;js.encodedSize=function e(t){return _e.encodedSize(t.value)};function K1(e,t,r,n){return new z(A.tag,r,1)}function J1(e,t,r,n){return new z(A.tag,Nt(e,t+1,n),2)}function Q1(e,t,r,n){return new z(A.tag,jt(e,t+1,n),3)}function Z1(e,t,r,n){return new z(A.tag,zt(e,t+1,n),5)}function Y1(e,t,r,n){return new z(A.tag,Mt(e,t+1,n),9)}function zs(e,t){_e(e,A.tag.majorEncoded,t.value)}zs.compareTokens=Ot.compareTokens;zs.encodedSize=function e(t){return _e.encodedSize(t.value)};var X1=20,e0=21,t0=22,r0=23;function n0(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${Y} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new z(A.null,null,1):new z(A.undefined,void 0,1)}function i0(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${Y} indefinite length items not allowed`);return new z(A.break,void 0,1)}function Ms(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${Y} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${Y} Infinity values are not supported`)}return new z(A.float,e,t)}function o0(e,t,r,n){return Ms($s(e,t+1),3,n)}function s0(e,t,r,n){return Ms(Ps(e,t+1),5,n)}function a0(e,t,r,n){return Ms(th(e,t+1),9,n)}function Os(e,t,r){let n=t.value;if(n===!1)e.push([A.float.majorEncoded|X1]);else if(n===!0)e.push([A.float.majorEncoded|e0]);else if(n===null)e.push([A.float.majorEncoded|t0]);else if(n===void 0)e.push([A.float.majorEncoded|r0]);else{let i,o=!1;(!r||r.float64!==!0)&&(Xc(n),i=$s(je,1),n===i||Number.isNaN(n)?(je[0]=249,e.push(je.slice(0,3)),o=!0):(eh(n),i=Ps(je,1),n===i&&(je[0]=250,e.push(je.slice(0,5)),o=!0))),o||(l0(n),i=th(je,1),je[0]=251,e.push(je.slice(0,9)))}}Os.encodedSize=function e(t,r){let n=t.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!r||r.float64!==!0){Xc(n);let i=$s(je,1);if(n===i||Number.isNaN(n))return 3;if(eh(n),i=Ps(je,1),n===i)return 5}return 9};var Yc=new ArrayBuffer(9),Te=new DataView(Yc,1),je=new Uint8Array(Yc,0);function Xc(e){if(e===1/0)Te.setUint16(0,31744,!1);else if(e===-1/0)Te.setUint16(0,64512,!1);else if(Number.isNaN(e))Te.setUint16(0,32256,!1);else{Te.setFloat32(0,e);let t=Te.getUint32(0),r=(t&2139095040)>>23,n=t&8388607;if(r===255)Te.setUint16(0,31744,!1);else if(r===0)Te.setUint16(0,(e&2147483648)>>16|n>>13,!1);else{let i=r-127;i<-24?Te.setUint16(0,0):i<-14?Te.setUint16(0,(t&2147483648)>>16|1<<24+i,!1):Te.setUint16(0,(t&2147483648)>>16|i+15<<10|n>>13,!1)}}}function $s(e,t){if(e.length-t<2)throw new Error(`${Y} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=r&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,r&32768?-o:o}function eh(e){Te.setFloat32(0,e,!1)}function Ps(e,t){if(e.length-t<4)throw new Error(`${Y} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function l0(e){Te.setFloat64(0,e,!1)}function th(e,t){if(e.length-t<8)throw new Error(`${Y} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}Os.compareTokens=Ot.compareTokens;function W(e,t,r){throw new Error(`${Y} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function zi(e){return()=>{throw new Error(`${Y} ${e}`)}}var D=[];for(let e=0;e<=23;e++)D[e]=W;D[24]=w1;D[25]=g1;D[26]=b1;D[27]=m1;D[28]=W;D[29]=W;D[30]=W;D[31]=W;for(let e=32;e<=55;e++)D[e]=W;D[56]=v1;D[57]=k1;D[58]=E1;D[59]=S1;D[60]=W;D[61]=W;D[62]=W;D[63]=W;for(let e=64;e<=87;e++)D[e]=x1;D[88]=A1;D[89]=C1;D[90]=T1;D[91]=B1;D[92]=W;D[93]=W;D[94]=W;D[95]=zi("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)D[e]=_1;D[120]=L1;D[121]=I1;D[122]=U1;D[123]=D1;D[124]=W;D[125]=W;D[126]=W;D[127]=zi("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)D[e]=j1;D[152]=z1;D[153]=M1;D[154]=O1;D[155]=$1;D[156]=W;D[157]=W;D[158]=W;D[159]=P1;for(let e=160;e<=183;e++)D[e]=R1;D[184]=H1;D[185]=V1;D[186]=q1;D[187]=W1;D[188]=W;D[189]=W;D[190]=W;D[191]=G1;for(let e=192;e<=215;e++)D[e]=K1;D[216]=J1;D[217]=Q1;D[218]=Z1;D[219]=Y1;D[220]=W;D[221]=W;D[222]=W;D[223]=W;for(let e=224;e<=243;e++)D[e]=zi("simple values are not supported");D[244]=W;D[245]=W;D[246]=W;D[247]=n0;D[248]=zi("simple values are not supported");D[249]=o0;D[250]=s0;D[251]=a0;D[252]=W;D[253]=W;D[254]=W;D[255]=i0;var et=[];for(let e=0;e<24;e++)et[e]=new z(A.uint,e,1);for(let e=-1;e>=-24;e--)et[31-e]=new z(A.negint,e,1);et[64]=new z(A.bytes,new Uint8Array(0),1);et[96]=new z(A.string,"",1);et[128]=new z(A.array,0,1);et[160]=new z(A.map,0,1);et[244]=new z(A.false,!1,1);et[245]=new z(A.true,!0,1);et[246]=new z(A.null,null,1);function u0(e){switch(e.type){case A.false:return He([244]);case A.true:return He([245]);case A.null:return He([246]);case A.bytes:return e.value.length?void 0:He([64]);case A.string:return e.value===""?He([96]):void 0;case A.array:return e.value===0?He([128]):void 0;case A.map:return e.value===0?He([160]):void 0;case A.uint:return e.value<24?He([Number(e.value)]):void 0;case A.negint:if(e.value>=-24)return He([31-Number(e.value)])}}function rh(){let e=[];return e[A.uint.major]=Ot,e[A.negint.major]=Ds,e[A.bytes.major]=ji,e[A.string.major]=N1,e[A.array.major]=Ns,e[A.map.major]=js,e[A.tag.major]=zs,e[A.float.major]=Os,e}var L4=rh(),I4=new y1,Zl=class nh{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${Qc} object contains circular references`);return new nh(r,t)}},it={null:new z(A.null,null),undefined:new z(A.undefined,void 0),true:new z(A.true,!0),false:new z(A.false,!1),emptyArray:new z(A.array,0),emptyMap:new z(A.map,0)},wt={number(e,t,r,n){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new z(A.float,e):e>=0?new z(A.uint,e):new z(A.negint,e)},bigint(e,t,r,n){return e>=BigInt(0)?new z(A.uint,e):new z(A.negint,e)},Uint8Array(e,t,r,n){return new z(A.bytes,e)},string(e,t,r,n){return new z(A.string,e)},boolean(e,t,r,n){return e?it.true:it.false},null(e,t,r,n){return it.null},undefined(e,t,r,n){return it.undefined},ArrayBuffer(e,t,r,n){return new z(A.bytes,new Uint8Array(e))},DataView(e,t,r,n){return new z(A.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[it.emptyArray,new z(A.break)]:it.emptyArray;n=Zl.createCheck(n,e);let i=[],o=0;for(let s of e)i[o++]=fo(s,r,n);return r.addBreakTokens?[new z(A.array,e.length),i,new z(A.break)]:[new z(A.array,e.length),i]},Object(e,t,r,n){let i=t!=="Object",o=i?e.keys():Object.keys(e),s=i?e.size:o.length;if(!s)return r.addBreakTokens===!0?[it.emptyMap,new z(A.break)]:it.emptyMap;n=Zl.createCheck(n,e);let a=[],l=0;for(let u of o)a[l++]=[fo(u,r,n),fo(i?e.get(u):e[u],r,n)];return c0(a,r),r.addBreakTokens?[new z(A.map,s),a,new z(A.break)]:[new z(A.map,s),a]}};wt.Map=wt.Object;wt.Buffer=wt.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))wt[`${e}Array`]=wt.DataView;function fo(e,t={},r){let n=r1(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||wt[n];if(typeof i=="function"){let s=i(e,n,t,r);if(s!=null)return s}let o=wt[n];if(!o)throw new Error(`${Qc} unsupported type: ${n}`);return o(e,n,t,r)}function c0(e,t){t.mapSorter&&e.sort(t.mapSorter)}var U4=Symbol.for("DONE"),D4=Symbol.for("BREAK"),h0=rh(),f0={float64:!1,quickEncodeToken:u0};function ih(e,t=h0,r=f0){if(Array.isArray(e)){let n=0;for(let i of e)n+=ih(i,t,r);return n}else{let n=t[e.type.major];if(n.encodedSize===void 0||typeof n.encodedSize!="function")throw new Error(`Encoder for ${e.type.name} does not have an encodedSize()`);return n.encodedSize(e,r)}}var d0=class{constructor(e,t){this.bytes=e,this.byteOffset=t,this.roots=[],this.headerSize=t}addRoot(e,t){return p0(this,e,t),this}write(e){return w0(this,e),this}close(e){return g0(this,e)}},p0=(e,t,r={})=>{let{resize:n=!1}=r,{bytes:i,headerSize:o,byteOffset:s,roots:a}=e;e.roots.push(t);let l=Rs(e);if(l>o)if(l-o+s<i.byteLength)if(n)oh(e,l);else throw a.pop(),new RangeError(`Header of size ${o} has no capacity for new root ${t}.
  However there is a space in the buffer and you could call addRoot(root, { resize: root }) to resize header to make a space for this root.`);else throw a.pop(),new RangeError(`Buffer has no capacity for a new root ${t}`)},y0=({cid:e,bytes:t})=>{let r=e.bytes.byteLength+t.byteLength;return Ni.default.encodingLength(r)+r},w0=(e,{cid:t,bytes:r})=>{let n=t.bytes.byteLength+r.byteLength,i=Ni.default.encode(n);if(e.byteOffset+i.length+n>e.bytes.byteLength)throw new RangeError("Buffer has no capacity for this block");po(e,i),po(e,t.bytes),po(e,r)},g0=(e,t={})=>{let{resize:r=!1}=t,{roots:n,bytes:i,byteOffset:o,headerSize:s}=e,a=Rc({version:1,roots:n}),l=Ni.default.encode(a.length),u=l.length+a.byteLength;if(s-u===0)return Yl(e,l,a),i.subarray(0,o);if(r)return oh(e,u),Yl(e,l,a),i.subarray(0,e.byteOffset);throw new RangeError(`Header size was overestimated.
You can use close({ resize: true }) to resize header`)},oh=(e,t)=>{let{bytes:r,headerSize:n}=e;r.set(r.subarray(n,e.byteOffset),t),e.byteOffset+=t-n,e.headerSize=t},po=(e,t)=>{e.bytes.set(t,e.byteOffset),e.byteOffset+=t.length},Yl=({bytes:e},t,r)=>{e.set(t),e.set(r,t.length)},b0=[new z(A.map,2),new z(A.string,"version"),new z(A.uint,1),new z(A.string,"roots")],m0=new z(A.tag,42),v0=e=>{let t=[...b0];t.push(new z(A.array,e.length));for(let n of e)t.push(m0),t.push(new z(A.bytes,{length:n+1}));let r=ih(t);return Ni.default.encodingLength(r)+r},Rs=({roots:e})=>v0(e.map(t=>t.bytes.byteLength)),k0=(e,t={})=>{let{roots:r=[],byteOffset:n=0,byteLength:i=e.byteLength,headerSize:o=Rs({roots:r})}=t,s=new Uint8Array(e,n,i),a=new d0(s,o);for(let l of r)a.addRoot(l);return a},sn=({name:e,code:t,encode:r})=>new E0(e,t,r),E0=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?ri(this.code,t):t.then(r=>ri(this.code,r))}else throw Error("Unknown type, must be binary type")}};function An({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*S0(e,t){if(t!=null&&typeof t=="object")if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r],o=ne.asCID(n);o?yield[i.join("/"),o]:typeof n=="object"&&(yield*zo(n,i))}else{let r=ne.asCID(t);r?yield[e.join("/"),r]:yield*zo(t,e)}}function*zo(e,t){if(e==null||e instanceof Uint8Array)return;let r=ne.asCID(e);r&&(yield[t.join("/"),r]);for(let[n,i]of Object.entries(e)){let o=[...t,n];yield*S0(o,i)}}function*x0(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r];yield i.join("/"),typeof n=="object"&&!ne.asCID(n)&&(yield*Mo(n,i))}else yield*Mo(t,e)}function*Mo(e,t){if(!(e==null||typeof e!="object"))for(let[r,n]of Object.entries(e)){let i=[...t,r];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ne.asCID(n)&&(yield*x0(i,n))}}function A0(e,t){let r=e;for(let[n,i]of t.entries()){if(r=r[i],r==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let o=ne.asCID(r);if(o)return{value:o,remaining:t.slice(n+1).join("/")}}return{value:r}}var an=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||typeof r>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:An(),bytes:An(),value:An(),asBlock:An()})}links(){return zo(this.value,[])}tree(){return Mo(this.value,[])}get(e="/"){return A0(this.value,e.split("/").filter(Boolean))}};async function cr({value:e,codec:t,hasher:r}){if(typeof e>"u")throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n),o=ne.create(1,t.code,i);return new an({value:e,bytes:n,cid:o})}async function Ct({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e),o=ne.create(1,t.code,i);return new an({value:n,bytes:e,cid:o})}function C0({bytes:e,cid:t,value:r,codec:n}){let i=r!==void 0?r:n&&n.decode(e);if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new an({cid:t,bytes:e,value:i})}async function sh({bytes:e,cid:t,hasher:r,codec:n}){if(!e)throw new Error('Missing required argument "bytes"');if(!r)throw new Error('Missing required argument "hasher"');let i=n.decode(e),o=await r.digest(e);if(!Di.equals(t.multihash.bytes,o.bytes))throw new Error("CID hash does not match bytes");return C0({bytes:e,cid:t,value:i,codec:n})}var ah=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Le=sn({name:"sha2-256",code:18,encode:ah("SHA-256")}),N4=sn({name:"sha2-512",code:19,encode:ah("SHA-512")}),si={};ie(si,{code:()=>Hs,decode:()=>F0,encode:()=>B0,name:()=>T0});var T0="raw",Hs=85,B0=e=>Dt(e),F0=e=>Dt(e);async function lh(e,t){let r=0,n=Rs({roots:e});r+=n;for(let{cid:s,bytes:a}of t.entries())r+=y0({cid:s,bytes:a});let i=new Uint8Array(r),o=k0(i,{headerSize:n});for(let s of e)o.addRoot(s);for(let{cid:s,bytes:a}of t.entries())o.write({cid:s,bytes:a});return o.close(),await cr({value:o.bytes,hasher:Le,codec:si})}async function _0(e){return await cr({value:{fp:e},hasher:Le,codec:he})}async function L0(e){let t=await e.getRoots(),r=await e.get(t[0]);if(!r)throw new Error("missing header block");let{value:n}=await Ct({bytes:r.bytes,hasher:Le,codec:he});if(n&&n.fp===void 0)throw new Error("missing fp");let{fp:i}=n;return i}var ir={};ie(ir,{code:()=>j0,crypto:()=>z0,decode:()=>N0,decrypt:()=>qs,encode:()=>D0,encrypt:()=>Ws,name:()=>M0});function Oo(){try{return crypto&&crypto.subtle?crypto:new Crypto}catch{return null}}var Vs=Oo();function uh(e){let t=new Uint8Array(e);return e>0&&crypto.getRandomValues(t),t}var I0=e=>{e=+e;let t=new Uint8Array(4);return t[3]=e>>>24,t[2]=e>>>16,t[1]=e>>>8,t[0]=e&255,t},U0=e=>{let t=e.byteLength-4;return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216},ch=e=>{let t=e.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=t.reduce((o,s)=>o+s.length,0),n=new Uint8Array(r),i=0;for(let o of t)n.set(o,i),i+=o.length;return n},D0=({iv:e,bytes:t})=>ch([e,t]),N0=e=>{let t=e.subarray(0,12);return e=e.slice(12),{iv:t,bytes:e}},j0=3145728+1337;async function hh(e){return await Vs.subtle.importKey("raw",e,"AES-GCM",!1,["encrypt","decrypt"])}var qs=async({key:e,value:t})=>{let{bytes:r,iv:n}=t,i=await hh(e),o=await Vs.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:128},i,r);r=new Uint8Array(o);let s=U0(r.subarray(0,4)),a=ne.decode(r.subarray(4,4+s));return r=r.subarray(4+s),{cid:a,bytes:r}},Ws=async({key:e,cid:t,bytes:r})=>{let n=I0(t.bytes.byteLength),i=uh(12),o=ch([n,t.bytes,r]);try{let s=await hh(e),a=await Vs.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:128},s,o);r=new Uint8Array(a)}catch(s){throw console.log("ee",s),s}return{value:{bytes:r,iv:i}}},z0=e=>({encrypt:t=>Ws({key:e,...t}),decrypt:t=>qs({key:e,...t})}),M0="jchris@encrypted-block:aes-gcm",Gs=e=>{let t=e.byteLength-4;return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216},O0=4294967295,Ks=e=>{let t=Math.floor(O0/e);return async r=>{let n=await r.identity();if(typeof n!="number")throw new Error("Identity must be a number");return n<=t}},ln=(e,t)=>e===t?0:e>t?1:-1,$0=(e,t)=>{for(let r=0;r<e.byteLength;r++){if(t.byteLength===r)return 1;let n=e[r],i=t[r];if(n!==i)return n>i?1:-1}return t.byteLength>e.byteLength?-1:0},Cn=class{constructor(){this._cids=new Set}add(e){if(!e.address)throw new Error("Cannot add node without address");if(e.address.then){let t=e.address.then(r=>this._cids.add(r.toString()));this._cids.add(t),t.then(()=>this._cids.delete(t))}else this._cids.add(e.address.toString())}async all(){return await Promise.all([...this._cids]),this._cids}},Js=class{constructor({key:e,address:t},r={}){this.key=e,this.address=t,this.codec=r.codec,this.hasher=r.hasher}get isEntry(){return!0}},ai=class{constructor({entries:e,closed:t}){if(typeof t!="boolean")throw new Error('Missing required argument "closed"');this.entries=e,this.closed=t,this.startKey=e[0].key}find(e,t){let{entries:r}=this;for(let n=r.length-1;n>-1;n--){let i=r[n];if(t(e,i.key)>-1)return[n,i]}return null}findMany(e,t,r=!1,n=!1){let{entries:i}=this,o=new Map;r?e=[...e]:e=e.sort(t);for(let s=i.length-1;s>-1&&e.length;s--){let a=i[s],l=[];for(;e.length;){let u=e[e.length-1];u=u.key?u.key:u;let c=t(u,a.key);if(n)if(c===0)l.push(e.pop());else if(c>0)e.pop();else break;else if(c>-1)l.push(e.pop());else break}l.length&&o.set(s,[a,l])}return o}findRange(e,t,r){let{entries:n}=this,i,o=0;for(let s=n.length-1;s>-1;s--){let a=n[s];if(r(t,a.key)>0){i=s;break}}for(let s=0;s<n.length;s++){let a=n[s],l=r(e,a.key);if(l===0){o=s;break}else if(l<0)break;o=s}return{first:o,last:i,entries:n.slice(o,i+1)}}},Xl=e=>typeof e=="string"?e:JSON.stringify(e);function P0(e,t){return e.sort(({key:r},{key:n})=>t.compare(r,n))}async function R0(e,t,r){let n=[];for(let i of t){let{key:o,del:s}=i;if(r(o,e)<0)s||n.push(i);else break}return n}async function H0(e,t,{chunker:r,compare:n}){return await hr.from({entries:e.map(i=>new t.LeafEntryClass(i,t)).sort((i,o)=>n(i.key,o.key)),chunker:r,NodeClass:t.LeafClass,distance:0,opts:t})}async function V0(e,t,r,n){return await Promise.all(t.map(async i=>{let o=await i.encode();return r.blocks.push({block:o,node:i}),e.cache.set(i),new n.BranchEntryClass({key:i.key,address:await i.address},n)}))}async function q0(e,t,r,n){let i=t.root;t.blocks.push({block:await i.encode(),node:i}),e.cache.set(i);let o=n.opts,s=i.distance,a=i.entryList.startKey,l=await R0(a,r,e.compare);if(l.length){let u=await H0(l,o,e),c=await V0(e,u,t,o),f=[new o.BranchEntryClass({key:i.entryList.startKey,address:await i.address},o),...c].sort(({key:d},{key:h})=>o.compare(d,h)),w=await hr.from({...n,entries:f,chunker:e.chunker,NodeClass:o.BranchClass,distance:s+1}),p=[...w];for(;w.length>1;){let d=await Promise.all(w.map(async h=>new o.BranchEntryClass({key:h.key,address:await h.address},o)));w=await hr.from({...n,entries:d.sort(({key:h},{key:y})=>o.compare(h,y)),chunker:e.chunker,NodeClass:o.BranchClass,distance:s+1}),p=[...p,...w]}await Promise.all(p.map(async d=>{let h=await d.encode();e.cache.set(d),t.blocks.push({block:h,node:d})})),t.root=w[0],t.nodes=[...t.nodes,...p]}}var hr=class st{constructor({entryList:t,chunker:r,distance:n,getNode:i,compare:o,cache:s}){this.entryList=t,this.chunker=r,this.distance=n,this.getNode=i,this.compare=o,this.cache=s}get closed(){return this.entryList.closed}get key(){return this.entryList.startKey}async getEntry(t,r=new Cn){return{result:await this._getEntry(t,r),cids:r}}async _getEntry(t,r){r.add(this);let n=this;for(;!n.isLeaf;){let s=n.entryList.find(t,this.compare);if(s===null)throw new Error("Not found");let[,a]=s;n=await this.getNode(await a.address),r.add(n)}let i=n.entryList.find(t,this.compare);if(i===null||i[1].key.toString()!==t.toString())throw new Error("Not found");let[,o]=i;return o}async getAllEntries(t=new Cn){return{result:await this._getAllEntries(t),cids:t}}_getAllEntries(t){if(t.add(this),this.isLeaf)return this.entryList.entries;{let{entries:r}=this.entryList,n=async i=>this.getNode(await i.address).then(o=>o._getAllEntries(t)).catch(async o=>{throw o});return Promise.all(r.map(n)).then(i=>i.flat())}}async*vis(t=new Set){let r=async o=>o.isLeaf?`Leaf [${o.entryList.entries.map(s=>`[${s.key},${JSON.stringify(s.value).replace(/"/g,"'")}]`).join(", ")}]`:`Branch [${o.entryList.entries.map(s=>`[${s.key}]`).join(", ")}]`,n=o=>o.toString().slice(0,4)+o.toString().slice(-4),i=async function*(o,s,a){let l=await o.address;if(!a.has(l)){a.add(l);let u=await r(o);yield`  node [shape=ellipse fontname="Courier"]; ${n(l)} [label="${u}"];`,yield`  ${n(s)} -> ${n(l)};`;for(let c of o.entryList.entries)if(c.address){let f=await c.address;try{let w=await o.getNode(f);yield*await i(w,l,a)}catch(w){yield`  ${n(l)} -> ${n(f)};`,yield`  node [shape=ellipse fontname="Courier"]; ${n(f)} [label="Error: ${w.message}"];`}}}};yield"digraph tree {",yield'  node [shape=ellipse fontname="Courier"]; rootnode;';for await(let o of i(this,"rootnode",t))yield o;yield"}"}async getEntries(t,r=!1,n=new Cn){return{result:await this._getEntries(t,r,n),cids:n}}async _getEntries(t,r,n){n.add(this),r||(t=t.sort(this.compare));let i=this.entryList.findMany(t,this.compare,!0,this.isLeaf);if(this.isLeaf)return[...i.values()].map(([s])=>s);let o=[];for(let[s,a]of[...i.values()].reverse()){let l=this.getNode(await s.address);o.push(l.then(u=>u._getEntries(a.reverse(),!0,n)))}return o=await Promise.all(o),o.flat()}async getRangeEntries(t,r,n=new Cn){return{result:await this._getRangeEntries(t,r,n),cids:n}}_getRangeEntries(t,r,n){n.add(this);let{entries:i}=this.entryList.findRange(t,r,this.compare);if(this.isLeaf)return i.filter(l=>{let u=this.compare(t,l.key),c=this.compare(r,l.key);return u<=0&&c>=0});if(!i.length)return[];let o=async l=>this.getNode(await l.address).then(u=>u._getRangeEntries(t,r,n)),s=[o(i.shift())];if(!i.length)return s[0];let a=o(i.pop());for(;i.length;){let l=async u=>this.getNode(await u.address).then(async c=>c._getAllEntries(n));s.push(l(i.shift()))}return s.push(a),Promise.all(s).then(l=>l.flat())}async transaction(t,r={}){r={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...r};let n={chunker:this.chunker,opts:r},i=this.entryList.findMany(t,r.compare,!0,this.isLeaf);return this.isLeaf?await this.transactionLeaf(t,r,n,i):await this.transactionBranch(t,r,n,i)}async transactionLeaf(t,r,n,i){let{LeafClass:o,LeafEntryClass:s}=r,{entries:a,previous:l}=this.processLeafEntries(t,i,s,r),u={...n,entries:a,NodeClass:o,distance:0},c=await st.from(u);return{nodes:c,previous:l,blocks:await Promise.all(c.map(async f=>{let w=await f.encode();return this.cache.set(f),{block:w,node:f}})),distance:0}}processLeafEntries(t,r,n,i){let o=[],s=[],a={},l=new Map;for(let{key:f,del:w,value:p}of t){let d=Xl(f);w?typeof a[d]>"u"&&l.set(d,null):(a[d]={key:f,value:p},l.delete(d))}s=[...this.entryList.entries];for(let[f,[w]]of r){o.push(w);let p=Xl(w.key);l.has(p)?l.set(p,f):(s[f]=new n(a[p],i),delete a[p])}let u=0;for(let[,f]of l)f!==null&&s.splice(f-u++,1);let c=Object.values(a).map(f=>new n(f,i));return s=s.concat(c).sort(({key:f},{key:w})=>i.compare(f,w)),{entries:s,previous:o}}async transactionBranch(t,r,n,i){let{BranchClass:o,BranchEntryClass:s}=r,a=0;for(let[d,[h,y]]of i){let g=this.getNode(await h.address).then(m=>m.transaction(y.reverse(),{...r,sorted:!0})).then(m=>({entry:h,keys:y,distance:a,...m}));i.set(d,g)}let l=[...this.entryList.entries],u={previous:[],blocks:[],nodes:[]};for(let[d,h]of i){let{nodes:y,previous:g,blocks:m,distance:b}=await h;a=b,l[d]=y,g.length&&(u.previous=u.previous.concat(g)),m.length&&(u.blocks=u.blocks.concat(m)),y.length&&(u.nodes=u.nodes.concat(y))}l=l.flat();let c=await this.handlePrepend(l,r,n,u,a);a++;let f=async d=>{if(d.isEntry)return d;let h=await d.encode();return u.blocks.push({block:h,node:d}),this.cache.set(d),new s(d,r)};l=await Promise.all(c.map(f));let w={...n,entries:l,NodeClass:o,distance:a},p=await st.from(w);return await Promise.all(p.map(async d=>{let h=await d.encode();u.blocks.push({block:h,node:d}),this.cache.set(d)})),u.nodes=p,{...u,distance:a}}async handlePrepend(t,r,n,i,o){let{BranchClass:s,LeafClass:a}=r,l=[],u=null;for(let c of t)if(u){let f=await this.mergeFirstLeftEntries(c,u,n,i,o);u=null;let w=f[0].address?s:a,p={...n,entries:f.sort(({key:h},{key:y})=>r.compare(h,y)),NodeClass:w,distance:o},d=await st.from(p);d[d.length-1].closed||(u=d.pop()),d.length&&(l=l.concat(d))}else!c.isEntry&&!c.closed?u=c:l.push(c);return u&&l.push(u),l}async getNodeFirstFromBlocks(t,r){for(let{block:n,node:i}of t)if(await n.cid===r)return i;return await this.getNode(r)}async mergeFirstLeftEntries(t,r,n,i,o){let s=n.opts,{LeafClass:a,BranchClass:l,BranchEntryClass:u}=s;if(t.isEntry){let p=await t.address;t=await this.getNodeFirstFromBlocks(i.blocks,p)}let c=t.entryList.entries;if(!c.length)throw new Error("unreachable no entries");let f=(p,d)=>p.concat(d),w=async(p,d,h)=>await Promise.all(p.map(async y=>(d.blocks.push({block:await y.encode(),node:y}),this.cache.set(y),new u({key:y.key,address:await y.address},h))));if(c[0].constructor.name===r.entryList.entries[0].constructor.name)return await f(r.entryList.entries,c);{let p=c.shift();if(!p)throw new Error("unreachable no left entry");if(!p.address)throw new Error("unreachable existing leaf, no leftEntry.address");let d=await this.mergeFirstLeftEntries(p,r,n,i,o-1),h=c.shift();if(!h)return d;if(!h.address)throw new Error("unreachable existing leaf, no esf.address");let y=await this.getNodeFirstFromBlocks(i.blocks,await h.address);if(y.entryList.entries[0].address){if(d[0].address)return d.concat(y.entryList.entries);{let g=await st.from({...n,entries:d.sort(({key:v},{key:S})=>s.compare(v,S)),NodeClass:a,distance:o}),m=await w(g,i,s),b=await st.from({...n,entries:[...y.entryList.entries,...m,...c].sort(({key:v},{key:S})=>s.compare(v,S)),NodeClass:l,distance:o});return await w(b,i,s)}}else{let g=await f(d,y.entryList.entries),m=await st.from({...n,entries:g.sort(({key:v},{key:S})=>s.compare(v,S)),NodeClass:a,distance:o}),b=await w(m,i,s);return await f(b,c)}}}async bulk(t,r={},n=!0){let{BranchClass:i}=r;r={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...r},r.sorted||(t=P0(t,r),r.sorted=!0);let o={chunker:this.chunker,opts:r},s=await this.transaction(t,r);for(;s.nodes.length>1;){let a=s.nodes[0].distance+1,l=await Promise.all(s.nodes.map(async c=>{let f=await c.encode();return s.blocks.push({block:f,node:c}),this.cache.set(c),new r.BranchEntryClass(c,r)})),u=await st.from({...o,entries:l,NodeClass:i,distance:a});await Promise.all(u.map(async c=>{let f=await c.encode();this.cache.set(c),s.blocks.push({block:f,node:c})})),s.nodes=u}return s.root=s.nodes[0],n&&s.root&&await q0(this,s,t,o),s.blocks=s.blocks.map(({block:a})=>a),s}static async from({entries:t,chunker:r,NodeClass:n,distance:i,opts:o}){if(!t.every(l=>l.constructor.name===t[0].constructor.name))throw new Error("all entries must be of the same type");let s=[],a=[];for(let l of t)a.push(l),await r(l,i)&&(s.push(new ai({entries:a,closed:!0})),a=[]);return a.length&&s.push(new ai({entries:a,closed:!1})),s.map(l=>new n({entryList:l,chunker:r,distance:i,...o}))}},fh=class extends hr{constructor({codec:e,hasher:t,block:r,...n}){super(n),this.codec=e,this.hasher=t,r?(this.block=r,this.address=r.cid):(this.block=this.encode(),this.address=this.block.then(i=>i.cid))}async get(e){let{result:t,cids:r}=await this.getEntry(e);return{result:t.key,cids:r}}async encode(){if(this.block)return this.block;let e=await this.encodeNode(),t={codec:this.codec,hasher:this.hasher,value:e};return this.block=await cr(t),this.block}},dh=class extends fh{async encodeNode(){let{entries:e}=this.entryList,t=async n=>{if(!n.address)throw new Error("entry.address required");return[n.key,await n.address]},r=await Promise.all(e.map(t));return{branch:[this.distance,r],closed:this.closed}}get isBranch(){return!0}},ph=class extends fh{async encodeNode(){return{leaf:await Promise.all(this.entryList.entries.map(async e=>await e.encodeNode())),closed:this.closed}}get isLeaf(){return!0}},yh=async function*(e){let{LeafClass:t,LeafEntryClass:r,BranchClass:n,BranchEntryClass:i,list:o,chunker:s,compare:a,...l}=e;o=o.map(f=>new r(f,l)),l.compare=a;let u=await hr.from({entries:o,chunker:s,NodeClass:t,distance:0,opts:l});yield*u;let c=1;for(;u.length>1;){let f=async p=>new i({key:p.key,address:await p.address},l),w=await Promise.all(u.map(f));u=await hr.from({entries:w,chunker:s,NodeClass:n,distance:c,opts:l}),yield*u,c++}},$o=({bytes:e},{bytes:t})=>$0(e,t),wh=class extends Js{constructor(e){super({address:e,key:e}),this.cid=e}encodeNode(){return this.cid}identity(){let e=this.cid.multihash.bytes;return Gs(e)}},gh=class extends Js{async identity(){let{multihash:{bytes:e}}=await this.address;return Gs(e)}},bh=class extends dh{},mh=class extends ph{},vh=(e,t,r,n,i)=>{let o=a=>{let{value:l}=a,u={chunker:r,cache:t,block:a,getNode:s,codec:n,hasher:i,compare:$o},c,f;if(l.leaf)c=l.leaf.map(d=>new wh(d)),f=mh;else if(l.branch){let[d,h]=l.branch;u.distance=d,c=h.map(([y,g])=>new gh({key:y,address:g})),f=bh}else throw new Error("Unknown block data, does not match schema");let w=new ai({entries:c,closed:l.closed}),p=new f({entryList:w,...u});return t.set(p),p},s=a=>t.has(a)?t.get(a):e(a).then(l=>o(l));return s},W0=({get:e,cache:t,chunker:r,list:n,codec:i,hasher:o,sorted:s})=>{s||(n=n.sort($o));let a=vh(e,t,r,i,o);return yh({list:n,codec:i,hasher:o,chunker:r,getNode:a,sorted:s,compare:$o,cache:t,LeafClass:mh,LeafEntryClass:wh,BranchClass:bh,BranchEntryClass:gh})},G0=({cid:e,get:t,cache:r,chunker:n,codec:i,hasher:o,...s})=>vh(t,r,n,i,o,s)(e),K0=async function*({get:e,cids:t,hasher:r,key:n,cache:i,chunker:o,root:s}){let a=new Set,l;for(let w of t){let p=await e(w);if(!p)throw new Error("missing cid: "+w.toString());let d=await Ws({...p,key:n}),h=await cr({...d,codec:ir,hasher:r});yield h,a.add(h.cid.toString()),p.cid.equals(s)&&(l=h.cid)}if(!l)throw new Error("cids does not include root");let u=[...a].map(w=>ne.parse(w)),c;for await(let w of W0({list:u,get:e,cache:i,chunker:o,hasher:r,codec:he})){let p=await w.block;yield p,c=p}if(!c)throw new Error("missing last block");let f=[l,c.cid];yield await cr({value:f,codec:he,hasher:r})},J0=async function*({root:e,get:t,key:r,cache:n,chunker:i,hasher:o}){let s=async y=>t(y).then(async g=>g?await Ct({...g,codec:he,hasher:o}):void 0),a=async y=>t(y).then(async g=>g?await Ct({...g,codec:ir,hasher:o}):void 0),l=await s(e);if(!l)throw new Error("missing root");if(!l.bytes)throw new Error("missing bytes");let{value:[u,c]}=l,f=await t(u);if(!f)throw new Error("missing root block");let w=await G0({cid:c,get:s,cache:n,chunker:i,codec:ir,hasher:o}),{result:p}=await w.getAllEntries(),d=async y=>{if(!y)throw new Error("missing block");y.value||(y=await Ct({...y,codec:ir,hasher:o}));let{bytes:g,cid:m}=await qs({...y,key:r}).catch(b=>{throw b});return await sh({cid:m,bytes:g,hasher:o,codec:ir})},h=[];for(let{cid:y}of p)f.cid.equals(y)||h.push(a(y).then(d));yield*h,yield d(f)},Mi={has:()=>!1,get:()=>{throw new Error("Cannot ask for entries from nocache")},set:()=>{}},kh=Ks(30);function Eh(e){let t=e.length,r=new Uint8Array(t/2);for(let n=0;n<t;n+=2)r[n/2]=parseInt(e.substring(n,n+2),16);return r}async function Q0(e,t,r){let n=Eh(e),i=n.buffer.slice(0,n.byteLength),o=new Bt,s=[];for(let{cid:l}of r.entries())if(s.push(l),!await r.get(l))throw new Error("missing cid block");let a=null;for await(let l of K0({cids:s,get:r.get.bind(r),key:i,hasher:Le,chunker:kh,cache:Mi,root:t}))await o.put(l.cid,l.bytes),a=l;if(!a)throw new Error("no blocks encrypted");return await lh([a.cid],o)}async function Z0(e,t){let r=(await t.getRoots())[0];return await Y0(r,t.get.bind(t),e)}async function Y0(e,t,r){let n=Eh(r),i=n.buffer.slice(0,n.byteLength),o=new Bt,s=null;for await(let a of J0({root:e,get:t,key:i,hasher:Le,chunker:kh,cache:Mi}))await o.put(a.cid,a.bytes),s=a;if(!s)throw new Error("no blocks decrypted");return{blocks:o,root:s.cid}}var X0=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===k.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===k.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[k.uint.major](e,t){this.prefix(e);let r=String(t.value),n=[];for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);e.push(n)}[k.negint.major](e,t){this[k.uint.major](e,t)}[k.bytes.major](e,t){throw new Error(`${At} unsupported type: Uint8Array`)}[k.string.major](e,t){this.prefix(e);let r=mc(JSON.stringify(t.value));e.push(r.length>32?ws(r):r)}[k.array.major](e,t){this.prefix(e),this.inRecursive.push({type:k.array,elements:0}),e.push([91])}[k.map.major](e,t){this.prefix(e),this.inRecursive.push({type:k.map,elements:0}),e.push([123])}[k.tag.major](e,t){}[k.float.major](e,t){if(t.type.name==="break"){let o=this.inRecursive.pop();if(o){if(o.type===k.array)e.push([93]);else if(o.type===k.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${At} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let r=String(t.value),n=[],i=!1;for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o),!i&&(n[o]===46||n[o]===101||n[o]===69)&&(i=!0);i||(n.push(46),n.push(48)),e.push(n)}};function em(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${At} complex map keys are not supported`);let r=e[0],n=t[0];if(r.type!==k.string||n.type!==k.string)throw new Error(`${At} non-string map keys are not supported`);if(r<n)return-1;if(r>n)return 1;throw new Error(`${At} unexpected duplicate map keys, this is not supported`)}var tm={addBreakTokens:!0,mapSorter:em};function rm(e,t){return t=Object.assign({},tm,t),_c(e,new X0,t)}var Sh=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${O} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${O} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this.pos,t=!1,r=!1,n=s=>{for(;!this.done();){let a=this.ch();if(s.includes(a))this.pos++;else break}};if(this.ch()===45&&(t=!0,this.pos++),this.ch()===48)if(this.pos++,this.ch()===46)this.pos++,r=!0;else return new F(k.uint,0,this.pos-e);if(n([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${O} unexpected token at position ${this.pos}`);if(!this.done()&&this.ch()===46){if(r)throw new Error(`${O} unexpected token at position ${this.pos}`);r=!0,this.pos++,n([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(r=!0,this.pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this.pos++,n([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),o=parseFloat(i);return r?new F(k.float,o,this.pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new F(o>=0?k.uint:k.negint,o,this.pos-e):new F(o>=0?k.uint:k.negint,BigInt(i),this.pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${O} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let i=this.pos,o=0;i<this.data.length&&o<65536;i++,o++){let s=this.data[i];if(s===92||s<32||s>=128)break;if(s===34){let a=String.fromCharCode.apply(null,this.data.subarray(this.pos,i));return this.pos=i+1,new F(k.string,a,o)}}let e=this.pos,t=[],r=()=>{if(this.pos+4>=this.data.length)throw new Error(`${O} unexpected end of unicode escape sequence at position ${this.pos}`);let i=0;for(let o=0;o<4;o++){let s=this.ch();if(s>=48&&s<=57)s-=48;else if(s>=97&&s<=102)s=s-97+10;else if(s>=65&&s<=70)s=s-65+10;else throw new Error(`${O} unexpected unicode escape character at position ${this.pos}`);i=i*16+s,this.pos++}return i},n=()=>{let i=this.ch(),o=null,s=i>239?4:i>223?3:i>191?2:1;if(this.pos+s>this.data.length)throw new Error(`${O} unexpected unicode sequence at position ${this.pos}`);let a,l,u,c;switch(s){case 1:i<128&&(o=i);break;case 2:a=this.data[this.pos+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(o=c));break;case 3:a=this.data[this.pos+1],l=this.data[this.pos+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:a=this.data[this.pos+1],l=this.data[this.pos+2],u=this.data[this.pos+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(o=c))}o===null?(o=65533,s=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this.pos+=s};for(;!this.done();){let i=this.ch(),o;switch(i){case 92:if(this.pos++,this.done())throw new Error(`${O} unexpected string termination at position ${this.pos}`);switch(o=this.ch(),this.pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${O} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new F(k.string,vc(t),this.pos-e);default:if(i<32)throw new Error(`${O} invalid control character at position ${this.pos}`);i<128?(t.push(i),this.pos++):n()}}throw new Error(`${O} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new F(k.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new F(k.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new F(k.null,null,4);case 102:return this.expect([102,97,108,115,101]),new F(k.false,!1,5);case 116:return this.expect([116,114,117,101]),new F(k.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${O} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this.pos++,this.skipWhitespace(),new F(k.break,void 0,1);if(this.ch()!==44)throw new Error(`${O} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this.pos++,this.skipWhitespace(),new F(k.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new F(k.break,void 0,1);if(this.ch()!==44)throw new Error(`${O} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this.pos++,this.skipWhitespace(),new F(k.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${O} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${O} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}};function nm(e,t){return t=Object.assign({tokenizer:new Sh(e,t)},t),Lc(e,t)}var xh=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),j4=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),z4=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),M4=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function im(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=ne.asCID(e);if(!t)return null;let r=t.toString();return[new F(k.map,1/0,1),new F(k.string,"/",1),new F(k.string,r,r.length),new F(k.break,void 0,1)]}function li(e){let t=xh.encode(e).slice(1);return[new F(k.map,1/0,1),new F(k.string,"/",1),new F(k.map,1/0,1),new F(k.string,"bytes",5),new F(k.string,t,t.length),new F(k.break,void 0,1),new F(k.break,void 0,1)]}function Ue(e){return li(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function om(e){return li(new Uint8Array(e))}function sm(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function am(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var lm={typeEncoders:{Object:im,Buffer:li,Uint8Array:li,Int8Array:Ue,Uint16Array:Ue,Int16Array:Ue,Uint32Array:Ue,Int32Array:Ue,Float32Array:Ue,Float64Array:Ue,Uint8ClampedArray:Ue,BigInt64Array:Ue,BigUint64Array:Ue,DataView:Ue,ArrayBuffer:om,undefined:sm,number:am}},um=class extends Sh{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===k.map){let t=this._next();if(t.type===k.string&&t.value==="/"){let r=this._next();if(r.type===k.string){if(this._next().type!==k.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(r),new F(k.tag,42,0)}if(r.type===k.map){let n=this._next();if(n.type===k.string&&n.value==="bytes"){let i=this._next();if(i.type===k.string){for(let s=0;s<2;s++)if(this._next().type!==k.break)throw new Error("Invalid encoded Bytes form");let o=xh.decode(`m${i.value}`);return new F(k.bytes,o,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(n)}this.tokenBuffer.push(r)}this.tokenBuffer.push(t)}return e}},Po={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Po.tags[42]=ne.parse;var cm=e=>rm(e,lm),hm=e=>{let t=Object.assign(Po,{tokenizer:new um(e,Po)});return nm(e,t)},Ah=e=>fm.decode(cm(e)),fm=new TextDecoder,Ch=e=>hm(dm.encode(e)),dm=new TextEncoder,pm=(e,t)=>t.some(r=>e instanceof r),eu,tu;function ym(){return eu||(eu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wm(){return tu||(tu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Th=new WeakMap,Ro=new WeakMap,Bh=new WeakMap,yo=new WeakMap,Qs=new WeakMap;function gm(e){let t=new Promise((r,n)=>{let i=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{r(pt(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(r=>{r instanceof IDBCursor&&Th.set(r,e)}).catch(()=>{}),Qs.set(t,e),t}function bm(e){if(Ro.has(e))return;let t=new Promise((r,n)=>{let i=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{r(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});Ro.set(e,t)}var Ho={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return Ro.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Bh.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return pt(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function mm(e){Ho=e(Ho)}function vm(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){let n=e.call(wo(this),t,...r);return Bh.set(n,t.sort?t.sort():[t]),pt(n)}:wm().includes(e)?function(...t){return e.apply(wo(this),t),pt(Th.get(this))}:function(...t){return pt(e.apply(wo(this),t))}}function km(e){return typeof e=="function"?vm(e):(e instanceof IDBTransaction&&bm(e),pm(e,ym())?new Proxy(e,Ho):e)}function pt(e){if(e instanceof IDBRequest)return gm(e);if(yo.has(e))return yo.get(e);let t=km(e);return t!==e&&(yo.set(e,t),Qs.set(t,e)),t}var wo=e=>Qs.get(e);function Em(e,t,{blocked:r,upgrade:n,blocking:i,terminated:o}={}){let s=indexedDB.open(e,t),a=pt(s);return n&&s.addEventListener("upgradeneeded",l=>{n(pt(s.result),l.oldVersion,l.newVersion,pt(s.transaction),l)}),r&&s.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Sm=["get","getKey","getAll","getAllKeys","count"],xm=["put","add","delete","clear"],go=new Map;function ru(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(go.get(t))return go.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=xm.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Sm.includes(r)))return;let o=async function(s,...a){let l=this.transaction(s,i?"readwrite":"readonly"),u=l.store;return n&&(u=u.index(a.shift())),(await Promise.all([u[r](...a),i&&l.done]))[0]};return go.set(t,o),o}mm(e=>({...e,get:(t,r,n)=>ru(t,r)||e.get(t,r,n),has:(t,r)=>!!ru(t,r)||e.has(t,r)}));var Fh="0.15.1",_h=Fh.match(/^([^.]*\.[^.]*)/);if(!_h)throw new Error("invalid version: "+Fh);var Zs=_h[0],Am=class{constructor(e){x(this,"STORAGE_VERSION",Zs),x(this,"name"),this.name=e}},Lh=class extends Am{constructor(){super(...arguments),x(this,"tag","header-base")}makeHeader({car:e,key:t}){return Ah({car:e,key:t})}parseHeader(e){return Ch(e)}},Ih=class{constructor(e){x(this,"tag","car-base"),x(this,"STORAGE_VERSION",Zs),x(this,"name"),this.name=e}},Uh=class{constructor(){x(this,"queue",[]),x(this,"processing",!1)}async enqueue(e){return new Promise((t,r)=>{let n=async()=>{try{t(await e())}catch(i){r(i)}finally{this.processing=!1,this.processNext()}};this.queue.push(n),this.processing||this.processNext()})}processNext(){if(this.queue.length>0&&!this.processing){this.processing=!0;let e=this.queue.shift();e&&e()}}},Cm=class{constructor(e){x(this,"tag","rwal-base"),x(this,"STORAGE_VERSION",Zs),x(this,"loader"),x(this,"ready"),x(this,"walState",{operations:[],noLoaderOps:[],fileOperations:[]}),x(this,"processing"),x(this,"processQueue",new Uh),this.loader=e,this.ready=(async()=>{let t=await this.load().catch(r=>(console.error("error loading wal",r),null));this.walState.operations=t?.operations||[],this.walState.fileOperations=t?.fileOperations||[]})()}async enqueue(e,t){await this.ready,t.noLoader?this.walState.noLoaderOps.push(e):this.walState.operations.push(e),await this.save(this.walState),this._process()}async enqueueFile(e,t=!1){await this.ready,this.walState.fileOperations.push({cid:e,public:t})}async _process(){await this.ready,this.loader.remoteCarStore&&await this.processQueue.enqueue(async()=>{await this._doProcess(),(this.walState.operations.length||this.walState.fileOperations.length||this.walState.noLoaderOps.length)&&setTimeout(()=>void this._process(),0)})}async _doProcess(){if(!this.loader.remoteCarStore)return;let e=(async()=>{let t=[...this.walState.operations],r=[...this.walState.fileOperations],n=[],i=[...this.walState.noLoaderOps],o=bc(5);if(t.length+r.length+i.length!==0){for(let s of i){let a=o(async()=>{let l=await this.loader.carStore.load(s.car).catch(()=>null);if(l)await this.loader.remoteCarStore.save(l);else if(Vo(this.loader.carLog,s.car))throw new Error(`missing car ${s.car.toString()}`);this.walState.noLoaderOps=this.walState.noLoaderOps.filter(u=>u!==s)});n.push(a)}for(let s of t){let a=o(async()=>{let l=await this.loader.carStore.load(s.car).catch(()=>null);if(l)await this.loader.remoteCarStore.save(l);else if(Vo(this.loader.carLog,s.car))throw new Error(`missing car ${s.car.toString()}`);this.walState.operations=this.walState.operations.filter(u=>u!==s)});n.push(a)}if(r.length){let s=this.loader;for(let{cid:a,public:l}of r){let u=o(async()=>{let c=await s.fileStore.load(a);await s.remoteFileStore?.save(c,{public:l}),this.walState.fileOperations=this.walState.fileOperations.filter(f=>f.cid!==a)});n.push(u)}}try{let s=(await Promise.allSettled(n)).filter(a=>a.status==="rejected");if(s.length)throw console.error("error uploading",JSON.stringify(s)),s[0].reason;if(t.length){let a=t[t.length-1];await this.loader.remoteMetaStore?.save(a).catch(l=>{throw console.error("error saving remote meta",l),this.walState.operations.push(a),l})}}finally{await this.save(this.walState)}}})();this.loader.remoteMetaLoading=e,await e}},Dh=class extends Ih{constructor(){super(...arguments),x(this,"tag","car-browser-idb"),x(this,"idb",null)}async _withDB(e){if(!this.idb){let t=`fp.${this.STORAGE_VERSION}.${this.name}`;this.idb=await Em(t,1,{upgrade(r){r.createObjectStore("cars")}})}return await e(this.idb)}async load(e){return await this._withDB(async t=>{let r=await t.transaction(["cars"],"readonly").objectStore("cars").get(e.toString());if(!r)throw new Error(`missing idb block ${e.toString()}`);return{cid:e,bytes:r}})}async save(e){return await this._withDB(async t=>{let r=t.transaction(["cars"],"readwrite");return await r.objectStore("cars").put(e.bytes,e.cid.toString()),await r.done})}async remove(e){return await this._withDB(async t=>{let r=t.transaction(["cars"],"readwrite");return await r.objectStore("cars").delete(e.toString()),await r.done})}},Tm=class extends Cm{constructor(){super(...arguments),x(this,"tag","wal-browser-ls")}headerKey(e){return`fp.${this.STORAGE_VERSION}.wal.${this.loader.name}.${e}`}async load(e="main"){try{let t=localStorage.getItem(this.headerKey(e));return t?Ch(t):null}catch{return null}}async save(e,t="main"){try{let r=Ah(e);localStorage.setItem(this.headerKey(t),r)}catch(r){throw console.error("error saving wal",r),r}}},Bm=class extends Lh{constructor(){super(...arguments),x(this,"tag","header-browser-ls")}headerKey(e){return`fp.${this.STORAGE_VERSION}.meta.${this.name}.${e}`}async load(e="main"){try{let t=localStorage.getItem(this.headerKey(e));return t?[this.parseHeader(t)]:null}catch{return null}}async save(e,t="main"){try{let r=this.headerKey(t),n=this.makeHeader(e);return localStorage.setItem(r,n),null}catch{return null}}};function Vo(e,t){return e.some(r=>r.equals(t))}function nu(e,t=new Set){let r=new Map;for(let n of e)t.has(n.toString())||r.set(n.toString(),n);return[...r.values()]}function Fm(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}var Ys=class{constructor(e,t){x(this,"name"),x(this,"opts",{}),x(this,"commitQueue",new Uh),x(this,"isCompacting",!1),x(this,"isWriting",!1),x(this,"remoteMetaLoading"),x(this,"remoteMetaStore"),x(this,"remoteCarStore"),x(this,"remoteWAL"),x(this,"metaStore"),x(this,"carStore"),x(this,"carLog",[]),x(this,"carReaders",new Map),x(this,"ready"),x(this,"key"),x(this,"keyId"),x(this,"seenCompacted",new Set),x(this,"getBlockCache",new Map),x(this,"seenMeta",new Set),this.name=e,this.opts=t||this.opts,this.metaStore=new Bm(this.name),this.carStore=new Dh(this.name),this.remoteWAL=new Tm(this),this.ready=Promise.resolve().then(async()=>{if(!this.metaStore||!this.carStore||!this.remoteWAL)throw new Error("stores not initialized");let r=this.opts.meta?[this.opts.meta]:await this.metaStore.load("main");r&&await this.handleDbMetasFromStore(r)})}async snapToCar(e){await this.ready,typeof e=="string"&&(e=ne.parse(e));let t=await this.loadCarHeaderFromMeta({car:e,key:this.key||null});this.carLog=[e,...t.cars],await this.getMoreReaders(t.cars),await this._applyCarHeader(t,!0)}async _readyForMerge(){}async _setWaitForWrite(e){}async handleDbMetasFromStore(e){for(let t of e){let r=async()=>{this.isWriting=!0,await this.mergeDbMetaIntoClock(t),this.isWriting=!1};this._setWaitForWrite(r),await r()}}async mergeDbMetaIntoClock(e){if(await this.compacting,this.isCompacting)throw new Error("cannot merge while compacting");if(this.seenMeta.has(e.car.toString())||(this.seenMeta.add(e.car.toString()),e.key&&await this.setKey(e.key),Vo(this.carLog,e.car)))return;let t=await this.loadCarHeaderFromMeta(e);t.compact.map(r=>r.toString()).forEach(this.seenCompacted.add,this.seenCompacted),await this.getMoreReaders(t.cars),this.carLog=[...nu([e.car,...this.carLog,...t.cars],this.seenCompacted)],await this._applyCarHeader(t)}async ingestKeyFromMeta(e){let{key:t}=e;t&&await this.setKey(t)}async loadCarHeaderFromMeta({car:e}){let t=await this.loadCar(e);return await L0(t)}async _getKey(){return this.key?this.key:(this.opts.public||(Oo()?await this.setKey(Fm(uh(32))):console.warn("missing crypto module, using public mode")),this.key)}async commit(e,t,r={noLoader:!1,compact:!1}){return this.commitQueue.enqueue(()=>this._commitInternal(e,t,r))}async _commitInternal(e,t,r={noLoader:!1,compact:!1}){await this.ready;let n=this.makeCarHeader(t,this.carLog,!!r.compact),i=[];if(n.files)i=n.files;else{let u=await _0(n);await e.put(u.cid,u.bytes),i=[u.cid]}let o=r.public?null:await this._getKey(),{cid:s,bytes:a}=o?await Q0(o,i[0],e):await lh(i,e);if(np(t))return await this.fileStore.save({cid:s,bytes:a}),await this.remoteWAL.enqueueFile(s,r.public),s;await this.carStore.save({cid:s,bytes:a});let l={car:s,key:o||null};if(await this.remoteWAL.enqueue(l,r),await this.metaStore.save(l),r.compact){let u=n;u.compact.map(c=>c.toString()).forEach(this.seenCompacted.add,this.seenCompacted),this.carLog=[...nu([s,...this.carLog],this.seenCompacted)],setTimeout(async()=>{this.remoteMetaLoading&&await this.remoteMetaLoading;for(let c of u.compact)await this.carStore.remove(c)},5e3)}else this.carLog.unshift(s);return s}async flushCars(){await this.ready;for(let e of this.carLog){let t={car:e,key:this.key||null};await this.remoteWAL.enqueue(t,{public:!1})}}async*entries(){await this.ready;for(let e of this.carLog){let t=await this.loadCar(e);if(!t)throw new Error(`missing car reader ${e.toString()}`);for await(let r of t.blocks())yield r}}async getBlock(e){await this.ready;let t=e.toString();if(this.getBlockCache.has(t))return this.getBlockCache.get(t);let r=await Promise.any(this.carLog.map(async n=>{let i=await this.loadCar(n);if(!i)throw new Error(`missing car reader ${n.toString()}`);let o=await i.get(e);if(o)return o;throw new Error(`block not in reader: ${e.toString()}`)})).catch(()=>{});return r&&this.getBlockCache.set(t,r),r}async loadCar(e){if(!this.carStore)throw new Error("car store not initialized");return await this.storesLoadCar(e,this.carStore,this.remoteCarStore)}async storesLoadCar(e,t,r,n){let i=e.toString();return this.carReaders.has(i)||this.carReaders.set(i,(async()=>{let o=null;try{o=await t.load(e)}catch{if(r){let l=await r.load(e);l&&(await t.save(l),o=l)}}if(!o)throw new Error(`missing car file ${i}`);let s=await qc.fromBytes(o.bytes),a=n?Promise.resolve(s):this.ensureDecryptedReader(s);return this.carReaders.set(i,a),a})().catch(o=>{throw this.carReaders.delete(i),o})),this.carReaders.get(i)}async ensureDecryptedReader(e){let t=await this._getKey();if(!t)return e;let{blocks:r,root:n}=await Z0(t,e);return{getRoots:()=>[n],get:r.get.bind(r),blocks:r.entries.bind(r)}}async setKey(e){if(this.key&&this.key!==e)throw new Error("key mismatch");this.key=e;let t=Oo();if(!t)throw new Error("missing crypto module");let r=t.subtle,n=new TextEncoder().encode(e),i=await r.digest("SHA-256",n),o=Array.from(new Uint8Array(i));this.keyId=o.map(s=>s.toString(16).padStart(2,"0")).join("")}async getMoreReaders(e){let t=bc(5),r=e.filter(n=>!this.carReaders.has(n.toString()));await Promise.all(r.map(n=>t(()=>this.loadCar(n))))}};x(Ys,"defaultHeader");var Wr=X(vy(),1),Nh=class extends Js{async identity(){let e=await this.codec.encode(await this.encodeNode()),t=await this.hasher.encode(e);return Gs(t)}},Oi=class extends Nh{constructor(e,t){super(e,t),this.value=e.value}encodeNode(){return[this.key,this.value]}},$i=class extends Nh{constructor(e,t){if(!e.address)throw new Error("Cannot create MapBranchEntry without address");super(e,t)}async encodeNode(){return[this.key,await this.address]}},jh=async(e,t)=>{let{result:r,cids:n}=await e.getEntry(t);return{result:r.value,cids:n}},zh=async(e,t)=>{let{result:r,cids:n}=await e.getEntries(t);return{result:r.map(i=>i.value),cids:n}},Pi=class extends ph{get(e){return jh(this,e)}getMany(e){return zh(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...Mh,...t},r)}},Ri=class extends dh{get(e){return jh(this,e)}getMany(e){return zh(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...Mh,...t},r)}},Mh={LeafClass:Pi,LeafEntryClass:Oi,BranchClass:Ri,BranchEntryClass:$i},Oh=(e,t,r,n,i,o,s)=>{let a=s.LeafClass||Pi,l=s.LeafEntryClass||Oi,u=s.BranchClass||Ri,c=s.BranchEntryClass||$i,f=async p=>t.has(p)?t.get(p):e(p).then(d=>w(d)),w=Im({chunker:r,cache:t,getNode:f,codec:n,hasher:i,compare:o,LeafEntryClass:l,LeafClass:a,BranchEntryClass:c,BranchClass:u});return f},_m=({get:e,cache:t,chunker:r,list:n,codec:i,hasher:o,sorted:s,compare:a,...l})=>{s||(n=n.sort(({key:f},{key:w})=>a(f,w)));let u=Oh(e,t,r,i,o,a,l),c={list:n,codec:i,hasher:o,chunker:r,getNode:u,sorted:s,compare:a,cache:t,LeafClass:l.LeafClass||Pi,LeafEntryClass:l.LeafEntryClass||Oi,BranchClass:l.BranchClass||Ri,BranchEntryClass:l.BranchEntryClass||$i};return yh(c)},Lm=({cid:e,get:t,cache:r,chunker:n,codec:i,hasher:o,compare:s,...a})=>Oh(t,r,n,i,o,s,a)(e);function Im({chunker:e,cache:t,getNode:r,codec:n,hasher:i,compare:o,LeafEntryClass:s,LeafClass:a,BranchEntryClass:l,BranchClass:u}){let c={codec:n,hasher:i};return f=>{let{value:w}=f,p={chunker:e,cache:t,block:f,getNode:r,codec:n,hasher:i,compare:o},d,h;if(w.leaf)d=w.leaf.map(([m,b])=>new s({key:m,value:b},c)),h=a;else if(w.branch){let[m,b]=w.branch;p.distance=m,d=b.map(([v,S])=>new l({key:v,address:S},c)),h=u}else throw new Error("Unknown block data, does not match schema");let y=new ai({entries:d,closed:w.closed}),g=new h({entryList:y,...p});return t.set(g),g}}var Um=(e,t)=>{let[r,n]=e,[i,o]=t,s=ln(r,i);return s!==0?s:Dm(n,o)},Dm=(e,t)=>{if(Number.isNaN(e))return-1;if(Number.isNaN(t))throw new Error("ref may not be Infinity or NaN");return Number.isFinite(e)?ln(e,t):1},$h=async(e,t)=>{let r=[t,NaN],n=[t,1/0],{result:i,cids:o}=await e.getRangeEntries(r,n);return{result:i.map(s=>{let[a,l]=s.key;return{id:l,key:a,row:s.value}}),cids:o}},Ph=async(e,t,r)=>{t=[t,NaN],r=[r,1/0];let{result:n,cids:i}=await e.getRangeEntries(t,r);return{result:n.map(o=>{let[s,a]=o.key;return{id:a,key:s,row:o.value}}),cids:i}},Nm=class extends Pi{get(e){return $h(this,e)}range(e,t){return Ph(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...Xs,...t},r)}},jm=class extends Ri{get(e){return $h(this,e)}range(e,t){return Ph(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...Xs,...t},r)}},zm=Nm,Mm=jm,Xs={LeafClass:zm,BranchClass:Mm,LeafEntryClass:Oi,BranchEntryClass:$i},Rh={...Xs,compare:Um},Om=e=>(e={...Rh,...e},_m(e)),Hh=e=>(e={...Rh,...e},Lm(e)),Tn=class{constructor(){x(this,"cid",null),x(this,"root",null)}},$m=(e,t)=>{if(Number.isNaN(e))return-1;if(Number.isNaN(t))throw new Error("ref may not be Infinity or NaN");return e===1/0?1:ln(e,t)},Pm=(e,t)=>{let[r,n]=e,[i,o]=t,s=ln(r,i);return s!==0?s:$m(n,o)},iu={cache:Mi,chunker:Ks(30),codec:he,hasher:Le,compare:Pm},ou={cache:Mi,chunker:Ks(30),codec:he,hasher:Le,compare:ln};function Rm(e,t){let r=[];return e.forEach(({key:n,value:i,del:o})=>{if(o||!i)return;let s=!1,a=t({_id:n,...i},(l,u)=>{s=!0,!(typeof l>"u")&&r.push({key:[Wr.default.encode(l),n],value:u||null})});!s&&a&&r.push({key:[Wr.default.encode(a),n],value:null})}),r}function qo(e){return async t=>{let r=await e.get(t);if(!r)throw new Error(`Missing block ${t.toString()}`);let{cid:n,bytes:i}=r;return sh({cid:n,bytes:i,hasher:Le,codec:he})}}async function su(e,t,r,n){if(!r.length)return t;if(!t.root)if(t.cid)t.root=await Hh({cid:t.cid,get:qo(e),...n});else{let s=null,a=null;for await(let l of await Om({get:qo(e),list:r,...n})){let u=await l.block;await e.put(u.cid,u.bytes),s=u,a=l}if(!a||!s)throw new Error("failed to create index");return{root:a,cid:s.cid}}let{root:i,blocks:o}=await t.root.bulk(r);if(i){for await(let s of o)await e.put(s.cid,s.bytes);return{root:i,cid:(await i.block).cid}}else return{root:null,cid:null}}async function au(e,t,r){return await Hh({cid:t,get:qo(e),...r})}async function Yt(e,t,r){return r.descending&&(t.result=t.result.reverse()),r.limit&&(t.result=t.result.slice(0,r.limit)),r.includeDocs&&(t.result=await Promise.all(t.result.map(async n=>{let i=await e.get(n.id),o=i?{_id:n.id,...i.doc}:null;return{...n,doc:o}}))),{rows:t.result.map(n=>(n.key=Wr.default.decode(n.key),n.row&&!n.value&&(n.value=n.row,delete n.row),n))}}function lu(e){return e.map(t=>Wr.default.encode(t))}function uu(e){return Wr.default.encode(e)}function Wo({_crdt:e},t,r,n){if(r&&n)throw new Error("cannot provide both mapFn and meta");if(r&&r.constructor.name!=="Function")throw new Error("mapFn must be a function");if(e.indexers.has(t))e.indexers.get(t).applyMapFn(t,r,n);else{let i=new Hm(e,t,r,n);e.indexers.set(t,i)}return e.indexers.get(t)}var Hm=class{constructor(e,t,r,n){if(x(this,"blocks"),x(this,"crdt"),x(this,"name",null),x(this,"mapFn",null),x(this,"mapFnString",""),x(this,"byKey",new Tn),x(this,"byId",new Tn),x(this,"indexHead"),x(this,"includeDocsDefault",!1),x(this,"initError",null),x(this,"ready"),this.blocks=e.indexBlocks,this.crdt=e,this.applyMapFn(t,r,n),!(this.mapFnString||this.initError))throw new Error("missing mapFnString");this.ready=this.blocks.ready.then(()=>{})}applyMapFn(e,t,r){if(t&&r)throw new Error("cannot provide both mapFn and meta");if(this.name&&this.name!==e)throw new Error("cannot change name");this.name=e;try{if(r){if(this.indexHead&&this.indexHead.map(i=>i.toString()).join()!==r.head.map(i=>i.toString()).join())throw new Error("cannot apply meta to existing index");this.mapFnString?this.mapFnString!==r.map?console.log("cannot apply different mapFn meta: old mapFnString",this.mapFnString,"new mapFnString",r.map):(this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head):(this.mapFnString=r.map,this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head)}else if(this.mapFn){if(t&&this.mapFn.toString()!==t.toString())throw new Error("cannot apply different mapFn app2")}else{if(t||(t=Vm(e)),this.mapFnString){if(this.mapFnString!==t.toString())throw new Error("cannot apply different mapFn app")}else this.mapFnString=t.toString();this.mapFn=t}let n=/=>\s*(.*)/.test(this.mapFnString);this.includeDocsDefault=n}catch(n){this.initError=n}}async query(e={}){if(await this._updateIndex(),await this._hydrateIndex(),!this.byKey.root)return await Yt(this.crdt,{result:[]},e);if(this.includeDocsDefault&&e.includeDocs===void 0&&(e.includeDocs=!0),e.range){let{result:n,...i}=await this.byKey.root.range(...lu(e.range));return await Yt(this.crdt,{result:n,...i},e)}if(e.key){let n=uu(e.key);return await Yt(this.crdt,await this.byKey.root.get(n),e)}if(Array.isArray(e.keys))return{rows:(await Promise.all(e.keys.map(async n=>{let i=uu(n);return(await Yt(this.crdt,await this.byKey.root.get(i),e)).rows}))).flat()};if(e.prefix){Array.isArray(e.prefix)||(e.prefix=[e.prefix]);let n=[...e.prefix,NaN],i=[...e.prefix,1/0],o=lu([n,i]);return await Yt(this.crdt,await this.byKey.root.range(...o),e)}let{result:t,...r}=await this.byKey.root.getAllEntries();return await Yt(this.crdt,{result:t.map(({key:[n,i],value:o})=>({key:n,id:i,value:o})),...r},e)}_resetIndex(){this.byId=new Tn,this.byKey=new Tn,this.indexHead=void 0}async _hydrateIndex(){this.byId.root&&this.byKey.root||!this.byId.cid||!this.byKey.cid||(this.byId.root=await au(this.blocks,this.byId.cid,ou),this.byKey.root=await au(this.blocks,this.byKey.cid,iu))}async _updateIndex(){if(await this.ready,this.initError)throw this.initError;if(!this.mapFn)throw new Error("No map function defined");let e,t;if(!this.indexHead||this.indexHead.length===0?{result:e,head:t}=await this.crdt.allDocs():{result:e,head:t}=await this.crdt.changes(this.indexHead),e.length===0)return this.indexHead=t,{byId:this.byId,byKey:this.byKey};let r=[],n=[];if(this.byId.root){let a=e.map(({key:u})=>u),{result:l}=await this.byId.root.getMany(a);r=l.map(u=>({key:u,del:!0})),n=l.map(u=>({key:u[1],del:!0}))}let i=Rm(e,this.mapFn),o=i.map(({key:a})=>({key:a[1],value:a})),s=new Map;for(let[a,l]of this.crdt.indexers)l.indexHead&&s.set(a,{byId:l.byId.cid,byKey:l.byKey.cid,head:l.indexHead,map:l.mapFnString,name:l.name});return await this.blocks.transaction(async a=>(this.byId=await su(a,this.byId,n.concat(o),ou),this.byKey=await su(a,this.byKey,r.concat(i),iu),this.indexHead=t,{byId:this.byId.cid,byKey:this.byKey.cid,head:t,map:this.mapFnString,name:this.name}),s)}};function Vm(e){return t=>{if(t[e])return t[e]}}var qm=(e,t)=>ne.parse(e,t),Vh=({name:e,code:t,encode:r})=>new Wm(e,t,r),Wm=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Qn(this.code,t):t.then(r=>Qn(this.code,r))}else throw Error("Unknown type, must be binary type")}};function Bn({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*Gm(e,t){if(t!=null&&typeof t=="object")if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r],o=ce.asCID(n);o?yield[i.join("/"),o]:typeof n=="object"&&(yield*Go(n,i))}else{let r=ce.asCID(t);r?yield[e.join("/"),r]:yield*Go(t,e)}}function*Go(e,t){if(e==null||e instanceof Uint8Array)return;let r=ce.asCID(e);r&&(yield[t.join("/"),r]);for(let[n,i]of Object.entries(e)){let o=[...t,n];yield*Gm(o,i)}}function*Km(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r];yield i.join("/"),typeof n=="object"&&!ce.asCID(n)&&(yield*Ko(n,i))}else yield*Ko(t,e)}function*Ko(e,t){if(!(e==null||typeof e!="object"))for(let[r,n]of Object.entries(e)){let i=[...t,r];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ce.asCID(n)&&(yield*Km(i,n))}}function Jm(e,t){let r=e;for(let[n,i]of t.entries()){if(r=r[i],r==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let o=ce.asCID(r);if(o)return{value:o,remaining:t.slice(n+1).join("/")}}return{value:r}}var kr=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||typeof r>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:Bn(),bytes:Bn(),value:Bn(),asBlock:Bn()})}links(){return Go(this.value,[])}tree(){return Ko(this.value,[])}get(e="/"){return Jm(this.value,e.split("/").filter(Boolean))}};async function qh({value:e,codec:t,hasher:r}){if(typeof e>"u")throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n),o=ce.create(1,t.code,i);return new kr({value:e,bytes:n,cid:o})}async function Wh({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e),o=ce.create(1,t.code,i);return new kr({value:n,bytes:e,cid:o})}var Gh={};ie(Gh,{sha256:()=>Er,sha512:()=>Qm});var Kh=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Er=Vh({name:"sha2-256",code:18,encode:Kh("SHA-256")}),Qm=Vh({name:"sha2-512",code:19,encode:Kh("SHA-512")});async function Jo(e,t,r){let n=new Sr(e),i=new Map(t.map(s=>[s.toString(),s]));if(i.has(r.toString()))return t;let o=!1;for(let s of t)await hu(n,r,s)&&(i.delete(s.toString()),i.set(r.toString(),r),o=!0);if(o)return[...i.values()];for(let s of t)if(await hu(n,s,r))return t;return t.concat(r)}var cu=class extends kr{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(e,t){return Zm({data:e,parents:t??[]})}},Sr=class{constructor(e){this._blocks=e}async get(e){let t=await this._blocks.get(e);if(!t)throw new Error(`missing block: ${e}`);return Ym(t.bytes)}};async function Zm(e){let{cid:t,bytes:r}=await qh({value:e,codec:he,hasher:Er});return new kr({cid:t,value:e,bytes:r})}async function Ym(e){let{cid:t,value:r}=await Wh({bytes:e,codec:he,hasher:Er});return new kr({cid:t,value:r,bytes:e})}async function hu(e,t,r){if(t.toString()===r.toString())return!0;let[{value:n},{value:i}]=await Promise.all([e.get(t),e.get(r)]),o=[...n.parents],s=new Set;for(;o.length;){let a=o.shift();if(!a)break;if(a.toString()===r.toString())return!0;if(i.parents.some(u=>a.toString()===u.toString())||s.has(a.toString()))continue;s.add(a.toString());let{value:l}=await e.get(a);o.push(...l.parents)}return!1}async function*Jh(e,t,r={}){let n=r.renderNodeLabel??(l=>Xm(l.cid)),i=new Sr(e);yield"digraph clock {",yield'  node [shape=point fontname="Courier"]; head;';let o=await Promise.all(t.map(l=>i.get(l))),s=[],a=new Set;for(let l of o){a.add(l.cid.toString()),yield`  node [shape=oval fontname="Courier"]; ${l.cid} [label="${n(l)}"];`,yield`  head -> ${l.cid};`;for(let u of l.value.parents)yield`  ${l.cid} -> ${u};`;s.push(...l.value.parents)}for(;s.length;){let l=s.shift();if(!l)break;if(a.has(l.toString()))continue;a.add(l.toString());let u=await i.get(l);yield`  node [shape=oval]; ${l} [label="${n(u)}" fontname="Courier"];`;for(let c of u.value.parents)yield`  ${l} -> ${c};`;s.push(...u.value.parents)}yield"}"}var Xm=e=>`${String(e).slice(0,4)}..${String(e).slice(-4)}`,ea=class extends kr{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(){return Qe([])}},Qh=new WeakMap;async function Qe(e,t){let{cid:r,bytes:n}=await qh({value:e,codec:he,hasher:Er}),i=new ea({cid:r,value:e,bytes:n,prefix:t??""});return Qh.set(i.bytes,i),i}async function e2(e,t){let r=Qh.get(e);if(r)return r;let{cid:n,value:i}=await Wh({bytes:e,codec:he,hasher:Er});if(!Array.isArray(i))throw new Error(`invalid shard: ${n}`);return new ea({cid:n,value:i,bytes:e,prefix:t??""})}var Hi=class{constructor(e){this._blocks=e}async get(e,t=""){let r=await this._blocks.get(e);if(!r)throw new Error(`missing block: ${e}`);return e2(r.bytes,t)}};function fu(e,t){if(!e.length)return[t];let r=[];for(let[n,[i,o]]of e.entries()){if(t[0]===i){if(Array.isArray(t[1]))Array.isArray(o)&&o[1]!=null&&t[1][1]==null?r.push([i,[t[1][0],o[1]]]):r.push(t);else{let s=Array.isArray(o)?[i,[o[0],t[1]]]:t;r.push(s)}for(let s=n+1;s<e.length;s++)r.push(e[s]);return r}if(n===0&&t[0]<i){r.push(t);for(let s=n;s<e.length;s++)r.push(e[s]);return r}if(n>0&&t[0]>e[n-1][0]&&t[0]<i){r.push(t);for(let s=n;s<e.length;s++)r.push(e[s]);return r}r.push([i,o])}return r.push(t),r}function t2(e,t){let r=e.findIndex(([o])=>t===o);if(r===-1)throw new Error(`key not found in shard: ${t}`);let n=r,i;for(;;){if(i=e[n][0].slice(0,-1),i.length)for(;;){let o=e.filter(s=>s[0].startsWith(i));if(o.length>1)return{prefix:i,matches:o};if(i=i.slice(0,-1),!i.length)break}if(n++,n>=e.length&&(n=0),n===r)return}}var Fn=64,r2=512*1024;async function zn(e,t,r,n,i={}){let o=new Hi(e),s=await o.get(t),a=await Vi(o,s,r),l=a[a.length-1],u=r.slice(l.prefix.length),c=[u,n],f=[];if(u.length>Fn){let d=Array.from(Array(Math.ceil(u.length/Fn)),(y,g)=>{let m=g*Fn;return{prefix:l.prefix+u.slice(0,m),skey:u.slice(m,m+Fn)}}),h=await Qe([[d[d.length-1].skey,n]],d[d.length-1].prefix);f.push(h);for(let y=d.length-2;y>0;y--)h=await Qe([[d[y].skey,[h.cid]]],d[y].prefix),f.push(h);c=[d[0].skey,[h.cid]]}let w=fu(l.value,c),p=await Qe(w,l.prefix);if(p.bytes.length>(i.maxShardSize??r2)){let d=t2(w,c[0]);if(!d)throw new Error("shard limit reached");let{prefix:h,matches:y}=d,g=await Qe(y.filter(([v])=>v!==h).map(([v,S])=>[v.slice(h.length),S]),l.prefix+h);f.push(g);let m,b=y.find(([v])=>v===h);if(b){if(Array.isArray(b[1]))throw new Error(`expected "${h}" to be a shard value but found a shard link`);m=[g.cid,b[1]]}else m=[g.cid];w=w.filter(v=>y.every(S=>v[0]!==S[0])),w=fu(w,[h,m]),p=await Qe(w,l.prefix)}f.push(p);for(let d=a.length-2;d>=0;d--){let h=a[d],y=p.prefix.slice(h.prefix.length),g=h.value.map(m=>{let[b,v]=m;if(b!==y)return m;if(!Array.isArray(v))throw new Error(`"${y}" is not a shard link in: ${h.cid}`);return v[1]==null?[b,[p.cid]]:[b,[p.cid,v[1]]]});p=await Qe(g,h.prefix),f.push(p)}return{root:f[f.length-1].cid,additions:f,removals:a}}async function n2(e,t,r){let n=new Hi(e),i=await n.get(t),o=await Vi(n,i,r),s=o[o.length-1],a=r.slice(s.prefix.length),l=s.value.find(([u])=>u===a);if(l)return Array.isArray(l[1])?l[1][1]:l[1]}async function Zh(e,t,r){let n=new Hi(e),i=await n.get(t),o=await Vi(n,i,r),s=o[o.length-1],a=r.slice(s.prefix.length),l=s.value.findIndex(([d])=>d===a);if(l===-1)return{root:t,additions:[],removals:[]};let u=s.value[l];if(Array.isArray(u[1])&&u[1][1]==null)return{root:t,additions:[],removals:[]};let c=[],f=[...o],w=[...s.value];if(Array.isArray(u[1]))w[l]=[u[0],[u[1][0]]];else for(w.splice(l,1);!w.length;){let d=o[o.length-1],h=o[o.length-2];if(!h)break;o.pop(),w=h.value.filter(y=>Array.isArray(y[1])?y[1][0].toString()!==d.cid.toString():!0)}let p=await Qe(w,o[o.length-1].prefix);c.push(p);for(let d=o.length-2;d>=0;d--){let h=o[d],y=p.prefix.slice(h.prefix.length),g=h.value.map(m=>{let[b,v]=m;if(b!==y)return m;if(!Array.isArray(v))throw new Error(`"${y}" is not a shard link in: ${h.cid}`);return v[1]==null?[b,[p.cid]]:[b,[p.cid,v[1]]]});p=await Qe(g,h.prefix),c.push(p)}return{root:c[c.length-1].cid,additions:c,removals:f}}async function*i2(e,t,r={}){let{prefix:n}=r,i=new Hi(e),o=await i.get(t);yield*async function*s(a){for(let l of a.value){let u=a.prefix+l[0];if(Array.isArray(l[1])){if(l[1][1]&&(!n||n&&u.startsWith(n))&&(yield[u,l[1][1]]),n&&(n.length<=u.length&&!u.startsWith(n)||n.length>u.length&&!n.startsWith(u)))continue;yield*s(await i.get(l[1][0],u))}else{if(n&&!u.startsWith(n))continue;yield[u,l[1]]}}}(o)}async function Vi(e,t,r){for(let[n,i]of t.value){if(r===n)return[t];if(r.startsWith(n)&&Array.isArray(i)){let o=await Vi(e,await e.get(i[0],t.prefix+n),r.slice(n.length));return[t,...o]}}return[t]}async function o2(e,t,r,n,i){let o=new Bt;if(e=new _i(o,e),!t.length){let g=await ea.create();o.putSync(g.cid,g.bytes);let m=await zn(e,g.cid,r,n,i),b={type:"put",root:m.root,key:r,value:n},v=await cu.create(b,t);return t=await Jo(e,t,v.cid),{root:m.root,additions:[g,...m.additions],removals:m.removals,head:t,event:v}}let s=new Sr(e),a=await ta(s,t);if(!a)throw new Error("failed to find common ancestor event");let l=await s.get(a),{root:u}=l.value.data,c=await Xh(s,t,a),f=new Map,w=new Map;for(let{value:g}of c){if(!["put","del"].includes(g.data.type))throw new Error(`unknown event type: ${g.data.type}`);let m=g.data.type==="put"?await zn(e,u,g.data.key,g.data.value):await Zh(e,u,g.data.key);u=m.root;for(let b of m.additions)o.putSync(b.cid,b.bytes),f.set(b.cid.toString(),b);for(let b of m.removals)w.set(b.cid.toString(),b)}let p=await zn(e,u,r,n,i);for(let g of p.additions)o.putSync(g.cid,g.bytes),f.set(g.cid.toString(),g);for(let g of p.removals)w.set(g.cid.toString(),g);let d={type:"put",root:p.root,key:r,value:n},h=await cu.create(d,t);o.putSync(h.cid,h.bytes),t=await Jo(e,t,h.cid);let y=p.root.toString();for(let g of w.keys())f.has(g)&&g!==y&&(f.delete(g),w.delete(g));return{root:p.root,additions:[...f.values()],removals:[...w.values()],head:t,event:h}}async function qi(e,t){if(!t.length)throw new Error("cannot determine root of headless clock");let r=new Bt;e=new _i(r,e);let n=new Sr(e);if(t.length===1){let f=await n.get(t[0]),{root:w}=f.value.data;return{root:w,additions:[],removals:[]}}let i=await ta(n,t);if(!i)throw new Error("failed to find common ancestor event");let o=await n.get(i),{root:s}=o.value.data,a=await Xh(n,t,i),l=new Map,u=new Map;for(let{value:f}of a){if(!["put","del"].includes(f.data.type))throw new Error(`unknown event type: ${f.data.type}`);let w=f.data.type==="put"?await zn(e,s,f.data.key,f.data.value):await Zh(e,s,f.data.key);s=w.root;for(let p of w.additions)r.putSync(p.cid,p.bytes),l.set(p.cid.toString(),p);for(let p of w.removals)u.set(p.cid.toString(),p)}let c=s.toString();for(let f of u.keys())l.has(f)&&f!==c&&(l.delete(f),u.delete(f));return{root:s,additions:[...l.values()],removals:[...u.values()]}}async function s2(e,t,r){if(!t.length)return;let n=await qi(e,t);return n.additions.length&&(e=new _i(new Bt(n.additions),e)),n2(e,n.root,r)}async function*Yh(e,t,r){if(!t.length)return;let n=await qi(e,t);n.additions.length&&(e=new _i(new Bt(n.additions),e)),yield*i2(e,n.root,r)}async function ta(e,t){if(!t.length)return;let r=t.map(n=>[n]);for(;;){let n=!1;for(let i of r){let o=await a2(e,i[i.length-1]);if(!o)continue;n=!0,i.push(o);let s=l2(r);if(s)return s}if(!n)return}}async function a2(e,t){let{value:r}=await e.get(t);return r.parents.length?r.parents.length===1?r.parents[0]:ta(e,r.parents):t}function l2(e){e=e.map(t=>[...t]);for(let t of e)for(let r of t){let n=!0;for(let i of e)if(t!==i&&(n=i.some(o=>String(o)===String(r)),!n))break;if(n)return r}}async function Xh(e,t,r){if(t.length===1&&String(t[0])===String(r))return[];let n=new Map,i=await Promise.all(t.map(s=>ef(e,s,r)));for(let s of i)for(let{event:a,depth:l}of s){let u=n.get(a.cid.toString());u?u.weight+=l:n.set(a.cid.toString(),{event:a,weight:l})}let o=new Map;for(let{event:s,weight:a}of n.values()){let l=o.get(a);l?l.push(s):o.set(a,[s])}return Array.from(o).sort((s,a)=>a[0]-s[0]).flatMap(([,s])=>s.sort((a,l)=>String(a.cid)<String(l.cid)?-1:1))}async function ef(e,t,r,n=0){let i=await e.get(t),o=[{event:i,depth:n}],{parents:s}=i.value;if(s.length===1&&String(s[0])===String(r))return o;let a=await Promise.all(s.map(l=>ef(e,l,r,n+1)));return o.concat(...a)}var tf={};ie(tf,{DEFAULT_DIRECTORY_MODE:()=>lf,DEFAULT_FILE_MODE:()=>af,NodeType:()=>V,code:()=>sa,createAdvancedFile:()=>T2,createComplexFile:()=>F2,createDirectoryShard:()=>_2,createEmptyFile:()=>A2,createFileChunk:()=>C2,createFileShard:()=>B2,createFlatDirectory:()=>aa,createRaw:()=>cf,createShardedDirectory:()=>ff,createSimpleFile:()=>hf,createSymlink:()=>gf,cumulativeContentByteLength:()=>Ze,cumulativeDagByteLength:()=>da,decode:()=>U2,decodeMetadata:()=>$t,encode:()=>I2,encodeAdvancedFile:()=>la,encodeComplexFile:()=>ua,encodeDirectory:()=>ca,encodeDirectoryMetadata:()=>pa,encodeFile:()=>pf,encodeFileChunk:()=>yf,encodeFileShard:()=>L2,encodeHAMTShard:()=>wf,encodeLink:()=>Wi,encodeMetadata:()=>hn,encodeMode:()=>vf,encodeRaw:()=>df,encodeSimpleFile:()=>Gi,encodeSymlink:()=>bf,filesize:()=>z2,matchFile:()=>j2,name:()=>uf});var u2=new TextDecoder;function ra(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");let i=e[t++];if(r+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[r,t]}function ui(e,t){let r;[r,t]=ra(e,t);let n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function rf(e,t){let r;return[r,t]=ra(e,t),[r&7,r>>3,t]}function c2(e){let t={},r=e.length,n=0;for(;n<r;){let i,o;if([i,o,n]=rf(e,n),o===1){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(t.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=ui(e,n)}else if(o===2){if(t.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,n]=ui(e,n),t.Name=u2.decode(s)}else if(o===3){if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[t.Tsize,n]=ra(e,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`)}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function h2(e){let t=e.length,r=0,n,i=!1,o;for(;r<t;){let a,l;if([a,l,r]=rf(e,r),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(l===1){if(o)throw new Error("protobuf: (PBNode) duplicate Data section");[o,r]=ui(e,r),n&&(i=!0)}else if(l===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,r]=ui(e,r),n.push(c2(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${l}`)}if(r>t)throw new Error("protobuf: (PBNode) unexpected end of data");let s={};return o&&(s.Data=o),s.Links=n||[],s}var nf=new TextEncoder,du=2**32,f2=2**31;function d2(e,t){let r=t.length;if(typeof e.Tsize=="number"){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=Or(t,r,e.Tsize)-1,t[r]=24}if(typeof e.Name=="string"){let n=nf.encode(e.Name);r-=n.length,t.set(n,r),r=Or(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=Or(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function p2(e){let t=w2(e),r=new Uint8Array(t),n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=Or(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let i=e.Links.length-1;i>=0;i--){let o=d2(e.Links[i],r.subarray(0,n));n-=o,n=Or(r,n,o)-1,r[n]=18}return r}function y2(e){let t=0;if(e.Hash){let r=e.Hash.length;t+=1+r+lr(r)}if(typeof e.Name=="string"){let r=nf.encode(e.Name).length;t+=1+r+lr(r)}return typeof e.Tsize=="number"&&(t+=1+lr(e.Tsize)),t}function w2(e){let t=0;if(e.Data){let r=e.Data.length;t+=1+r+lr(r)}if(e.Links)for(let r of e.Links){let n=y2(r);t+=1+n+lr(n)}return t}function Or(e,t,r){t-=lr(r);let n=t;for(;r>=f2;)e[t++]=r&127|128,r/=128;for(;r>=128;)e[t++]=r&127|128,r>>>=7;return e[t]=r,n}function lr(e){return e%2===0&&e++,Math.floor((g2(e)+6)/7)}function g2(e){let t=0;return e>=du&&(e=Math.floor(e/du),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+b2[e]}var b2=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],m2=["Data","Links"],v2=["Hash","Name","Tsize"],Qo=new TextEncoder;function of(e,t){if(e===t)return 0;let r=e.Name?Qo.encode(e.Name):[],n=t.Name?Qo.encode(t.Name):[],i=r.length,o=n.length;for(let s=0,a=Math.min(i,o);s<a;++s)if(r[s]!==n[s]){i=r[s],o=n[s];break}return i<o?-1:o<i?1:0}function pu(e,t){return!Object.keys(e).some(r=>!t.includes(r))}function k2(e){if(typeof e.asCID=="object"){let r=ce.asCID(e);if(!r)throw new TypeError("Invalid DAG-PB form");return{Hash:r}}if(typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let r=ce.asCID(e.Hash);try{r||(typeof e.Hash=="string"?r=ce.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=ce.decode(e.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return typeof e.Name=="string"&&(t.Name=e.Name),typeof e.Tsize=="number"&&(t.Tsize=e.Tsize),t}function E2(e){if((e instanceof Uint8Array||typeof e=="string")&&(e={Data:e}),typeof e!="object"||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Data!==void 0)if(typeof e.Data=="string")t.Data=Qo.encode(e.Data);else if(e.Data instanceof Uint8Array)t.Data=e.Data;else throw new TypeError("Invalid DAG-PB form");if(e.Links!==void 0)if(Array.isArray(e.Links))t.Links=e.Links.map(k2),t.Links.sort(of);else throw new TypeError("Invalid DAG-PB form");else t.Links=[];return t}function S2(e){if(!e||typeof e!="object"||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!pu(e,m2))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(e.Data!==void 0&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){let r=e.Links[t];if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!pu(r,v2))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(r.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash==null||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(r.Name!==void 0&&typeof r.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(r.Tsize!==void 0){if(typeof r.Tsize!="number"||r.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&of(r,e.Links[t-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var na=112;function x2(e){S2(e);let t={};return e.Links&&(t.Links=e.Links.map(r=>{let n={};return r.Hash&&(n.Hash=r.Hash.bytes),r.Name!==void 0&&(n.Name=r.Name),r.Tsize!==void 0&&(n.Tsize=r.Tsize),n})),e.Data&&(t.Data=e.Data),p2(t)}function un(e){let t=h2(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map(n=>{let i={};try{i.Hash=ce.decode(n.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(i.Name=n.Name),n.Tsize!==void 0&&(i.Tsize=n.Tsize),i})),r}var gt=X(Uy(),1),fr=gt.default.Reader,ia=gt.default.Writer,$=gt.default.util,se=gt.default.roots.unixfs||(gt.default.roots.unixfs={}),ci=se.Data=(()=>{function e(t){if(this.blocksizes=[],t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.Type=0,e.prototype.Data=$.newBuffer([]),e.prototype.filesize=$.Long?$.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=$.emptyArray,e.prototype.hashType=$.Long?$.Long.fromBits(0,0,!0):0,e.prototype.fanout=$.Long?$.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(t,r){if(r||(r=ia.create()),r.uint32(8).int32(t.Type),t.Data!=null&&Object.hasOwnProperty.call(t,"Data")&&r.uint32(18).bytes(t.Data),t.filesize!=null&&Object.hasOwnProperty.call(t,"filesize")&&r.uint32(24).uint64(t.filesize),t.blocksizes!=null&&t.blocksizes.length)for(var n=0;n<t.blocksizes.length;++n)r.uint32(32).uint64(t.blocksizes[n]);return t.hashType!=null&&Object.hasOwnProperty.call(t,"hashType")&&r.uint32(40).uint64(t.hashType),t.fanout!=null&&Object.hasOwnProperty.call(t,"fanout")&&r.uint32(48).uint64(t.fanout),t.mode!=null&&Object.hasOwnProperty.call(t,"mode")&&r.uint32(56).uint32(t.mode),t.mtime!=null&&Object.hasOwnProperty.call(t,"mtime")&&se.UnixTime.encode(t.mtime,r.uint32(66).fork()).ldelim(),r},e.decode=function(t,r){t instanceof fr||(t=fr.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new se.Data;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.Type=t.int32();break;case 2:i.Data=t.bytes();break;case 3:i.filesize=t.uint64();break;case 4:if(i.blocksizes&&i.blocksizes.length||(i.blocksizes=[]),(o&7)===2)for(var s=t.uint32()+t.pos;t.pos<s;)i.blocksizes.push(t.uint64());else i.blocksizes.push(t.uint64());break;case 5:i.hashType=t.uint64();break;case 6:i.fanout=t.uint64();break;case 7:i.mode=t.uint32();break;case 8:i.mtime=se.UnixTime.decode(t,t.uint32());break;default:t.skipType(o&7);break}}if(!i.hasOwnProperty("Type"))throw $.ProtocolError("missing required 'Type'",{instance:i});return i},e.fromObject=function(t){if(t instanceof se.Data)return t;var r=new se.Data;switch(t.Type){case"Raw":case 0:r.Type=0;break;case"Directory":case 1:r.Type=1;break;case"File":case 2:r.Type=2;break;case"Metadata":case 3:r.Type=3;break;case"Symlink":case 4:r.Type=4;break;case"HAMTShard":case 5:r.Type=5;break}if(t.Data!=null&&(typeof t.Data=="string"?$.base64.decode(t.Data,r.Data=$.newBuffer($.base64.length(t.Data)),0):t.Data.length&&(r.Data=t.Data)),t.filesize!=null&&($.Long?(r.filesize=$.Long.fromValue(t.filesize)).unsigned=!0:typeof t.filesize=="string"?r.filesize=parseInt(t.filesize,10):typeof t.filesize=="number"?r.filesize=t.filesize:typeof t.filesize=="object"&&(r.filesize=new $.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");r.blocksizes=[];for(var n=0;n<t.blocksizes.length;++n)$.Long?(r.blocksizes[n]=$.Long.fromValue(t.blocksizes[n])).unsigned=!0:typeof t.blocksizes[n]=="string"?r.blocksizes[n]=parseInt(t.blocksizes[n],10):typeof t.blocksizes[n]=="number"?r.blocksizes[n]=t.blocksizes[n]:typeof t.blocksizes[n]=="object"&&(r.blocksizes[n]=new $.LongBits(t.blocksizes[n].low>>>0,t.blocksizes[n].high>>>0).toNumber(!0))}if(t.hashType!=null&&($.Long?(r.hashType=$.Long.fromValue(t.hashType)).unsigned=!0:typeof t.hashType=="string"?r.hashType=parseInt(t.hashType,10):typeof t.hashType=="number"?r.hashType=t.hashType:typeof t.hashType=="object"&&(r.hashType=new $.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),t.fanout!=null&&($.Long?(r.fanout=$.Long.fromValue(t.fanout)).unsigned=!0:typeof t.fanout=="string"?r.fanout=parseInt(t.fanout,10):typeof t.fanout=="number"?r.fanout=t.fanout:typeof t.fanout=="object"&&(r.fanout=new $.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),t.mode!=null&&(r.mode=t.mode>>>0),t.mtime!=null){if(typeof t.mtime!="object")throw TypeError(".Data.mtime: object expected");r.mtime=se.UnixTime.fromObject(t.mtime)}return r},e.toObject=function(t,r){r||(r={});var n={};if((r.arrays||r.defaults)&&(n.blocksizes=[]),r.defaults){if(n.Type=r.enums===String?"Raw":0,r.bytes===String?n.Data="":(n.Data=[],r.bytes!==Array&&(n.Data=$.newBuffer(n.Data))),$.Long){var i=new $.Long(0,0,!0);n.filesize=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.filesize=r.longs===String?"0":0;if($.Long){var i=new $.Long(0,0,!0);n.hashType=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.hashType=r.longs===String?"0":0;if($.Long){var i=new $.Long(0,0,!0);n.fanout=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.fanout=r.longs===String?"0":0;n.mode=0,n.mtime=null}if(t.Type!=null&&t.hasOwnProperty("Type")&&(n.Type=r.enums===String?se.Data.DataType[t.Type]:t.Type),t.Data!=null&&t.hasOwnProperty("Data")&&(n.Data=r.bytes===String?$.base64.encode(t.Data,0,t.Data.length):r.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),t.filesize!=null&&t.hasOwnProperty("filesize")&&(typeof t.filesize=="number"?n.filesize=r.longs===String?String(t.filesize):t.filesize:n.filesize=r.longs===String?$.Long.prototype.toString.call(t.filesize):r.longs===Number?new $.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){n.blocksizes=[];for(var o=0;o<t.blocksizes.length;++o)typeof t.blocksizes[o]=="number"?n.blocksizes[o]=r.longs===String?String(t.blocksizes[o]):t.blocksizes[o]:n.blocksizes[o]=r.longs===String?$.Long.prototype.toString.call(t.blocksizes[o]):r.longs===Number?new $.LongBits(t.blocksizes[o].low>>>0,t.blocksizes[o].high>>>0).toNumber(!0):t.blocksizes[o]}return t.hashType!=null&&t.hasOwnProperty("hashType")&&(typeof t.hashType=="number"?n.hashType=r.longs===String?String(t.hashType):t.hashType:n.hashType=r.longs===String?$.Long.prototype.toString.call(t.hashType):r.longs===Number?new $.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),t.fanout!=null&&t.hasOwnProperty("fanout")&&(typeof t.fanout=="number"?n.fanout=r.longs===String?String(t.fanout):t.fanout:n.fanout=r.longs===String?$.Long.prototype.toString.call(t.fanout):r.longs===Number?new $.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),t.mode!=null&&t.hasOwnProperty("mode")&&(n.mode=t.mode),t.mtime!=null&&t.hasOwnProperty("mtime")&&(n.mtime=se.UnixTime.toObject(t.mtime,r)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,gt.default.util.toJSONOptions)},e.DataType=function(){let t={},r=Object.create(t);return r[t[0]="Raw"]=0,r[t[1]="Directory"]=1,r[t[2]="File"]=2,r[t[3]="Metadata"]=3,r[t[4]="Symlink"]=4,r[t[5]="HAMTShard"]=5,r}(),e})(),O4=se.UnixTime=(()=>{function e(t){if(t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.Seconds=$.Long?$.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(t,r){return r||(r=ia.create()),r.uint32(8).int64(t.Seconds),t.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&r.uint32(21).fixed32(t.FractionalNanoseconds),r},e.decode=function(t,r){t instanceof fr||(t=fr.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new se.UnixTime;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.Seconds=t.int64();break;case 2:i.FractionalNanoseconds=t.fixed32();break;default:t.skipType(o&7);break}}if(!i.hasOwnProperty("Seconds"))throw $.ProtocolError("missing required 'Seconds'",{instance:i});return i},e.fromObject=function(t){if(t instanceof se.UnixTime)return t;var r=new se.UnixTime;return t.Seconds!=null&&($.Long?(r.Seconds=$.Long.fromValue(t.Seconds)).unsigned=!1:typeof t.Seconds=="string"?r.Seconds=parseInt(t.Seconds,10):typeof t.Seconds=="number"?r.Seconds=t.Seconds:typeof t.Seconds=="object"&&(r.Seconds=new $.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),t.FractionalNanoseconds!=null&&(r.FractionalNanoseconds=t.FractionalNanoseconds>>>0),r},e.toObject=function(t,r){r||(r={});var n={};if(r.defaults){if($.Long){var i=new $.Long(0,0,!1);n.Seconds=r.longs===String?i.toString():r.longs===Number?i.toNumber():i}else n.Seconds=r.longs===String?"0":0;n.FractionalNanoseconds=0}return t.Seconds!=null&&t.hasOwnProperty("Seconds")&&(typeof t.Seconds=="number"?n.Seconds=r.longs===String?String(t.Seconds):t.Seconds:n.Seconds=r.longs===String?$.Long.prototype.toString.call(t.Seconds):r.longs===Number?new $.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),t.FractionalNanoseconds!=null&&t.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=t.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,gt.default.util.toJSONOptions)},e})(),$4=se.Metadata=(()=>{function e(t){if(t)for(var r=Object.keys(t),n=0;n<r.length;++n)t[r[n]]!=null&&(this[r[n]]=t[r[n]])}return e.prototype.MimeType="",e.encode=function(t,r){return r||(r=ia.create()),t.MimeType!=null&&Object.hasOwnProperty.call(t,"MimeType")&&r.uint32(10).string(t.MimeType),r},e.decode=function(t,r){t instanceof fr||(t=fr.create(t));for(var n=r===void 0?t.len:t.pos+r,i=new se.Metadata;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.MimeType=t.string();break;default:t.skipType(o&7);break}}return i},e.fromObject=function(t){if(t instanceof se.Metadata)return t;var r=new se.Metadata;return t.MimeType!=null&&(r.MimeType=String(t.MimeType)),r},e.toObject=function(t,r){r||(r={});var n={};return r.defaults&&(n.MimeType=""),t.MimeType!=null&&t.hasOwnProperty("MimeType")&&(n.MimeType=t.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,gt.default.util.toJSONOptions)},e})(),V=ci.DataType,sf=Object.freeze([]),oa=new Uint8Array(0),Se=Object.freeze({}),af=parseInt("0644",8),lf=parseInt("0755",8),sa=na,uf="UnixFS",Et=(e,t)=>(Object(globalThis).debug&&console.log({data:e,links:t}),x2(E2({Data:ci.encode(e).finish(),Links:t}))),cf=e=>({type:V.Raw,content:e}),A2=e=>hf(oa,e),hf=(e,t)=>({type:V.File,layout:"simple",content:e,metadata:$t(t)}),C2=e=>({type:V.File,layout:"simple",content:e}),T2=(e,t)=>({type:V.File,layout:"advanced",parts:e,metadata:$t(t)}),B2=e=>({type:V.File,layout:"advanced",parts:e}),F2=(e,t,r)=>({type:V.File,layout:"complex",content:e,parts:t,metadata:$t(r)}),aa=(e,t)=>({type:V.Directory,metadata:$t(t),entries:e}),ff=(e,t,r,n,i=Se)=>({type:V.HAMTShard,bitfield:t,fanout:ha(r),hashType:fa(n),entries:e,metadata:$t(i)}),_2=(e,t,r,n)=>({type:V.HAMTShard,bitfield:t,fanout:ha(r),hashType:fa(n),entries:e}),df=e=>Et({Type:V.Raw,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:sf},[]),pf=(e,t=!1)=>{let r=t?Se:Object(e).metadata;switch(e.layout){case"simple":return Gi(e.content,r);case"advanced":return la(e.parts,r);case"complex":return ua(e.content,e.parts,r);default:throw new TypeError(`File with unknown layout "${Object(e).layout}" was passed`)}},yf=e=>Gi(e,Se),L2=e=>Et({Type:V.File,blocksizes:e.map(cn),filesize:Ze(e)},e.map(Wi)),la=(e,t=Se)=>Et({Type:V.File,blocksizes:e.map(cn),filesize:Ze(e),...hn(t)},e.map(Wi)),Wi=e=>({Name:"",Tsize:e.dagByteLength,Hash:e.cid}),Gi=(e,t=Se)=>Et({Type:V.File,Data:e.byteLength>0?e:void 0,filesize:e.byteLength,blocksizes:[],...hn(t)},[]),ua=(e,t,r=Se)=>Et({Type:V.File,Data:e,filesize:e.byteLength+Ze(t),blocksizes:t.map(cn)},t.map(Wi)),ca=e=>Et({Type:e.type,...pa(e.metadata||Se)},e.entries.map(mf)),wf=({bitfield:e,fanout:t,hashType:r,entries:n,metadata:i=Se})=>Et({Type:V.HAMTShard,Data:e.byteLength>0?e:void 0,fanout:ha(t),hashType:fa(r),...pa(i)},n.map(mf)),ha=e=>{if(Math.log2(e)%1===0)return e;throw new TypeError(`Expected hamt size to be a power of two instead got ${e}`)},fa=e=>{if(Number.isInteger(e))return e;throw new TypeError(`Expected an integer value instead got ${e}`)},gf=(e,t=Se)=>({type:V.Symlink,content:e,metadata:$t(t)}),bf=(e,t=!1)=>{let r=t?Se:Object(e).metadata;return Et({Type:V.Symlink,Data:e.content,...hn(r||Se)},[])},I2=(e,t=!0)=>{switch(e.type){case V.Raw:return df(e.content);case V.File:return pf(e);case V.Directory:return ca(e);case V.HAMTShard:return wf(e);case V.Symlink:return bf(e);default:throw new Error(`Unknown node type ${Object(e).type}`)}},U2=e=>{let t=un(e),r=ci.decode(t.Data),{Type:n,Data:i,mtime:o,mode:s,blocksizes:a,...l}=ci.toObject(r,{defaults:!1,arrays:!0,longs:Number,objects:!1}),u={...s&&{mode:s},...D2(o)},c=t.Links;switch(r.Type){case V.Raw:return cf(i);case V.File:return c.length===0?new Ef(i,u):i.byteLength===0?new Sf(yu(l.blocksizes,c),u):new xf(i,yu(l.blocksizes,c),u);case V.Directory:return aa(wu(c),u);case V.HAMTShard:return ff(wu(c),i||oa,l.fanout,l.hashType,u);case V.Symlink:return gf(i,u);default:throw new TypeError(`Unsupported node type ${r.Type}`)}},D2=e=>e==null?void 0:{mtime:{secs:e.Seconds,nsecs:e.FractionalNanoseconds||0}},yu=(e,t)=>{let r=[],n=e.length,i=0;for(;i<n;)r.push({cid:t[i].Hash,dagByteLength:t[i].Tsize||0,contentByteLength:e[i]});return r},wu=e=>e.map(t=>({cid:t.Hash,name:t.Name||"",dagByteLength:t.Tsize||0})),Ze=e=>e.reduce((t,r)=>t+r.contentByteLength,0),da=(e,t)=>t.reduce((r,n)=>r+n.dagByteLength,e.byteLength),cn=e=>e.contentByteLength,mf=({name:e,dagByteLength:t,cid:r})=>({Name:e,Tsize:t,Hash:r}),pa=e=>hn(e,lf),hn=({mode:e,mtime:t},r=af)=>({mode:e!=null?vf(e,r):void 0,mtime:t!=null?N2(t):void 0}),$t=e=>e==null?Se:{...e.mode==null?void 0:{mode:kf(e.mode)},...e.mtime==null?void 0:{mtime:e.mtime}},N2=e=>e==null?void 0:e.nsecs!==0?{Seconds:e.secs,FractionalNanoseconds:e.nsecs}:{Seconds:e.secs},vf=(e,t)=>{let r=e==null?void 0:kf(e);return r===t||r==null?void 0:r},kf=e=>e&4095|e&4294963200,j2=({content:e=oa,parts:t=sf,metadata:r=Se,...n})=>t.length===0?new Ef(e,r):e.byteLength===0?new Sf(t,r):new xf(e,t,r),Ef=class{constructor(e,t){this.content=e,this.metadata=t,this.layout="simple",this.type=V.File}get filesize(){return this.content.byteLength}encode(){return Gi(this.content,this.metadata)}},Sf=class{constructor(e,t){this.parts=e,this.metadata=t}get layout(){return"advanced"}get type(){return V.File}get fileSize(){return Ze(this.parts)}get blockSizes(){return this.parts.map(cn)}encode(){return la(this.parts,this.metadata)}},xf=class{constructor(e,t,r){this.content=e,this.parts=t,this.metadata=r}get layout(){return"complex"}get type(){return V.File}get fileSize(){return this.content.byteLength+Ze(this.parts)}get blockSizes(){return this.parts.map(cn)}encode(){return ua(this.content,this.parts,this.metadata)}},z2=e=>{switch(e.type){case V.Raw:case V.Symlink:return e.content.byteLength;case V.File:switch(e.layout){case"simple":return e.content.byteLength;case"advanced":return Ze(e.parts);case"complex":return e.content.byteLength+Ze(e.parts)}default:return 0}},M2=function*(e){let t=yield*e;yield*ga(t)};function*ya(){return yield Ki}var Gr=function*(){yield Ji},wa=function*(e){let t=yield*ya();if($2(e)){let r=!1,n;if(e.then(i=>{r=!1,n=i,bt(t)},i=>{r=!0,n=i,bt(t)}),yield*Gr(),r)throw n;return n}else return q2(O2(t)),yield*Gr(),e};function*O2(e){bt(e)}var $2=e=>e!=null&&typeof e.then=="function",ga=function*(e){yield e},ba=function*(e){let t=[];for(let r of Object.entries(e)){let[n,i]=r;i!==Jr&&t.push(yield*Zi(R2(i,n)))}yield*ka(t)},ma=e=>e.length>0?P2(e.map(M2)):Jr;function*P2(e){let t=[];for(let r of e)t.push(yield*Zi(r));yield*ka(t)}var R2=(e,t)=>e===Jr?Jr:e instanceof bo?new bo([...e.tags,t],e.source):new bo([t],e),bo=class{constructor(e,t){this.tags=e,this.source=t,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(e){if(e.done)return e;switch(e.value){case Ji:case Ki:return e;default:{let t=e,{value:r}=t;for(let n of this.tags)r=H2(n,r);return t.value=r,t}}}next(e){return this.box(this.controller.next(e))}throw(e){return this.box(this.controller.throw(e))}return(e){return this.box(this.controller.return(e))}get[Symbol.toStringTag](){return"TaggedEffect"}},hi=()=>Jr,H2=(e,t)=>({type:e,[e]:t}),Ki=Symbol("current"),Ji=Symbol("suspend"),Tt=class Af{static of(t){return t.group||nr}static enqueue(t,r){t.group=r,r.stack.active.push(t)}constructor(t,r=[],n=new Set,i=new Qi(r,n)){this.driver=t,this.parent=Af.of(t),this.stack=i,this.id=++Bf}},V2=class{constructor(){this.status=Kr,this.stack=new Qi,this.id=0}},Qi=class{constructor(e=[],t=new Set){this.active=e,this.idle=t}static size({active:e,idle:t}){return e.length+t.size}},q2=e=>bt(e[Symbol.iterator]()),bt=e=>{let t=Tt.of(e);for(t.stack.active.push(e),t.stack.idle.delete(e);t.parent;){let{idle:r,active:n}=t.parent.stack;if(r.has(t.driver))r.delete(t.driver),n.push(t.driver);else break;t=t.parent}if(nr.status===Kr)for(nr.status=Ff;;)try{for(let r of va(nr));nr.status=Kr;break}catch{nr.stack.active.shift()}},W2=e=>bt(e),va=function*(e){let{active:t}=e.stack,r=t[0];for(e.stack.idle.delete(r);r;){let n=_f;e:for(;!n.done&&r===t[0];){let i=n.value;switch(i){case Ji:e.stack.idle.add(r);break e;case Ki:n=r.next(r);break;default:n=r.next(yield i);break}}t.shift(),r=t[0],e.stack.idle.delete(r)}},Zi=(e,t)=>new Q2(e,t),G2=(e,t)=>Cf(e,{ok:!0,value:t}),Zo=(e,t)=>Cf(e,{ok:!1,error:t});function*Cf(e,t){try{let r=e,n=t.ok?r.return(t.value):r.throw(t.error);if(!n.done)if(n.value===Ji){let{idle:i}=Tt.of(r).stack;i.add(r)}else bt(r)}catch{}}function*ka(e){if(e.length===0)return;let t=yield*ya(),r=new Tt(t),n=null;for(let i of e){let{result:o}=i;if(o){!o.ok&&!n&&(n=o);continue}K2(i,r)}try{if(n)throw n.error;for(;yield*va(r),Qi.size(r.stack)>0;)yield*Gr()}catch(i){for(let o of r.stack.active)yield*Zo(o,i);for(let o of r.stack.idle)yield*Zo(o,i),bt(o);throw i}}var K2=(e,t)=>{let r=Tt.of(e);if(r!==t){let{active:n,idle:i}=r.stack,o=t.stack;if(e.group=t,i.has(e))i.delete(e),o.idle.add(e);else{let s=n.indexOf(e);s>=0&&(n.splice(s,1),o.active.push(e))}}};function*Tf(e){e.status===Kr&&(yield*e),e.result||(yield*ka([e]));let t=e.result;if(t.ok)return t.value;throw t.error}var J2=class{constructor(e){this.handler=e,this.result}get promise(){let{result:e}=this,t=e==null?new Promise((r,n)=>{this.handler.onsuccess=r,this.handler.onfailure=n}):e.ok?Promise.resolve(e.value):Promise.reject(e.error);return Object.defineProperty(this,"promise",{value:t}),t}then(e,t){return this.activate().promise.then(e,t)}catch(e){return this.activate().promise.catch(e)}finally(e){return this.activate().promise.finally(e)}activate(){return this}},Q2=class extends J2{constructor(e,t=Y2,r={},n=_f){super(r),this.id=++Bf,this.name=t.name||"",this.task=e,this.state=n,this.status=Kr,this.result,this.handler=r,this.controller}*resume(){W2(this)}join(){return Tf(this)}abort(e){return Zo(this,e)}exit(e){return G2(this,e)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=Ff,bt(this),this}panic(e){this.result={ok:!1,error:e},this.status=gu;let{handler:t}=this;throw t.onfailure&&t.onfailure(e),e}step(e){if(this.state=e,e.done){this.result={ok:!0,value:e.value},this.status=gu;let{handler:t}=this;t.onsuccess&&t.onsuccess(e.value)}return e}next(e){try{return this.step(this.controller.next(e))}catch(t){return this.panic(t)}}return(e){try{return this.step(this.controller.return(e))}catch(t){return this.panic(t)}}throw(e){try{return this.step(this.controller.throw(e))}catch(t){return this.panic(t)}}},Z2=function*(e,t){let r=yield*ya(),n=new Tt(r);for(Tt.enqueue(e[Symbol.iterator](),n);;){for(let i of va(n))Tt.enqueue(t(i)[Symbol.iterator](),n);if(Qi.size(n.stack)>0)yield*Gr();else break}},Bf=0,Kr="idle",Ff="active",gu="finished",_f={done:!1,value:Ki},Y2={},Jr=function*e(){}(),nr=new V2;function Lf(){}Object.defineProperties(Lf,{prototype:{value:new Proxy(Object.prototype,{get(e,t,r){return typeof t=="symbol"?Reflect.get(e,t,r):r.get(t)}})}});var If=()=>new Ea,bu=(e,t=0,r=e.byteLength)=>{let n=[],i=t<0?e.byteLength-t:t,o=r<0?e.byteLength-r:r;if(i===0&&o>=e.byteLength)return e;if(i>o||i>e.byteLength||o<=0)return If();let s=0,a=0;for(let l of e.segments){let u=a+l.byteLength;if(s===0){if(o<=u){let c=l.subarray(i-a,o-a);n.push(c),s=c.byteLength;break}else if(i<u){let c=i===a?l:l.subarray(i-a);n.push(c),s=c.byteLength}}else if(o<=u){let c=o===u?l:l.subarray(0,o-a);n.push(c),s+=c.byteLength;break}else n.push(l),s+=l.byteLength;a=u}return new Ea(n,e.byteOffset+i,s)},X2=(e,t)=>t.byteLength>0?(e.segments.push(t),new Ea(e.segments,e.byteOffset,e.byteLength+t.byteLength)):e,ev=(e,t)=>{if(t<e.byteLength){let r=0;for(let n of e.segments){if(t<r+n.byteLength)return n[t-r];r+=n.byteLength}}},tv=(e,t,r)=>{let n=r;for(let i of e.segments)t.set(i,n),n+=i.byteLength;return t};function*rv(e){for(let t of e.segments)yield*t}var Ea=class extends Lf{constructor(e=[],t=0,r=0){super(),this.segments=e,this.byteLength=r,this.length=r,this.byteOffset=t}[Symbol.iterator](){return rv(this)}slice(e,t){return bu(this,e,t)}subarray(e,t){return bu(this,e,t)}push(e){return X2(this,e)}get(e){return ev(this,e)}copyTo(e,t){return tv(this,e,t)}},Sa=e=>{throw new Error(e)},nv=(e,t,...r)=>Sa(String.raw(e,JSON.stringify(t),...r)),iv=new Uint8Array(0),ov=[],sv=e=>({config:e,buffer:If()}),av=(e,t)=>t.byteLength>0?Uf(e.config,e.buffer.push(t),!1):{...e,chunks:ov},lv=e=>Uf(e.config,e.buffer,!0),Uf=(e,t,r)=>{let n=e.chunker,i=[],o=0;for(let s of n.cut(n.context,t,r))if(s>0){let a=t.subarray(o,o+s);i.push(a),o+=s}return{config:e,chunks:i,buffer:t.subarray(o)}},uv=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:Xo}),Df=(e,t)=>{let r=ur(t,{});for(let n of e){let{ready:i,has:o,wants:s}=Nf(n.children,r.links);s.length===0?r=ur(r,{links:Yo(void 0,o),linked:[{id:n.id,links:i}]}):r=ur(r,{needs:Yo(n.id,s),nodes:{[n.id]:{children:n.children,count:s.length}}})}return r},cv=(e,t,r)=>{let n=r.needs[e],i=r.nodes[n];if(i!=null)if(i.count===1){let{ready:o,has:s}=Nf(i.children,{...r.links,[e]:t});return ur(r,{needs:{[e]:void 0},links:Yo(void 0,s),nodes:{[n]:void 0},linked:[{id:n,links:o}]})}else return ur(r,{needs:{[e]:void 0},links:{[e]:t},nodes:{[n]:{...i,count:i.count-1}}});else return ur(r,{links:{[e]:t}})},ur=(e,{needs:t,nodes:r,links:n,linked:i})=>{let o=e.mutable?e:{...e},s=e.mutable?fv:void 0;return t&&(o.needs=mo(e.needs,t,s)),r&&(o.nodes=mo(e.nodes,r,s)),n&&(o.links=mo(e.links,n,s)),o.linked=i?hv(e.linked||Xo,i,Xo):e.linked||[],o},Yo=(e,t)=>{let r={};for(let n of t)r[n]=e;return r},mo=(e,t,r=e)=>{let n=e===r?{...e}:e;for(let i of Object.entries(t)){let[o,s]=i;s==null?delete n[o]:n[o]=s}return n},hv=(e,t,r=e)=>{if(e===r)return[...e,...t];for(let n of t)e.push(n);return e},Nf=(e,t)=>{let r=[],n=[],i=[];for(let o of e){let s=t[o];s?(r.push(o),i.push(s)):n.push(o)}return{has:r,wants:n,ready:i}},Xo=Object.freeze([]),fv=Object.freeze({}),dv=(e,t)=>{switch(e.type){case"write":return yv(t,e.bytes);case"link":return wv(t,e.link);case"block":return{state:t,effect:hi()};case"close":return gv(t);case"end":return{state:t,effect:hi()};default:return nv`File Writer got unknown message ${e}`}},pv=(e,t,r)=>({status:"open",metadata:t,config:r,writer:e,chunker:sv({chunker:r.chunker}),layout:r.fileLayout.open(),nodeQueue:uv()}),yv=(e,t)=>{if(e.status==="open"){let{chunks:r,...n}=av(e.chunker,t),{nodes:i,leaves:o,layout:s}=e.config.fileLayout.write(e.layout,r),{linked:a,...l}=Df(i,e.nodeQueue),u=[...jf(o,e.config),...xa(a,e.config)];return{state:{...e,chunker:n,layout:s,nodeQueue:l},effect:ba({link:ma(u)})}}else return Sa("Unable to perform write on closed file")},wv=(e,{id:t,link:r,block:n})=>{let{linked:i,...o}=cv(t,r,e.nodeQueue),s=xa(i,e.config),a=e.status==="closed"&&t===e.rootID?{...e,status:"linked",link:r,nodeQueue:o}:{...e,nodeQueue:o},l=e.status==="closed"&&t===e.rootID&&e.end?e.end.resume():hi();return{state:a,effect:ba({link:ma(s),block:vv(e.writer,n),end:l})}},gv=e=>{if(e.status==="open"){let{chunks:t}=lv(e.chunker),{layout:r,...n}=e.config.fileLayout.write(e.layout,t),{root:i,...o}=e.config.fileLayout.close(r,e.metadata),[s,a]=Ev(i)?[[...n.nodes,...o.nodes],[...n.leaves,...o.leaves,i]]:[[...n.nodes,...o.nodes,i],[...n.leaves,...o.leaves]],{linked:l,...u}=Df(s,e.nodeQueue),c=[...jf(a,e.config),...xa(l,e.config)],f=Zi(Gr());return{state:{...e,chunker:null,layout:null,rootID:i.id,status:"closed",end:f,nodeQueue:u},effect:ba({link:ma(c),end:Tf(f)})}}else return{state:e,effect:hi()}},jf=(e,t)=>e.map(r=>bv(t,r,t.fileChunkEncoder)),bv=function*({hasher:e,linker:t},{id:r,content:n},i){let o=i.encode(n?kv(n):iv),s=yield*wa(e.digest(o)),a=t.createLink(i.code,s),l={cid:a,bytes:o},u={cid:a,contentByteLength:n?n.byteLength:0,dagByteLength:o.byteLength};return{id:r,block:l,link:u}},xa=(e,t)=>e.map(r=>mv(t,r)),mv=function*(e,{id:t,links:r},n){let i=e.fileEncoder.encode({type:V.File,layout:"advanced",parts:r,metadata:n}),o=yield*wa(Promise.resolve(e.hasher.digest(i))),s=e.linker.createLink(e.fileEncoder.code,o),a={bytes:i,cid:s},l={cid:s,contentByteLength:Ze(r),dagByteLength:da(i,r)};return{id:t,block:a,link:l}},vv=function*(e,t){(e.desiredSize||0)<=0&&(yield*wa(e.ready)),e.write(t)},kv=e=>e instanceof Uint8Array?e:e.copyTo(new Uint8Array(e.byteLength),0),Ev=e=>e.children==null,zf={};ie(zf,{context:()=>Sv,cut:()=>$f,name:()=>Mf,type:()=>xv,withMaxChunkSize:()=>Of});var Mf="fixed",Sv={maxChunkSize:262144},xv="Stateless",Of=e=>({type:"Stateless",context:{maxChunkSize:e},name:Mf,cut:$f}),$f=({maxChunkSize:e},{byteLength:t},r)=>{let n=t/e|0,i=new Array(n).fill(e),o=r?t-n*e:0;return o>0&&i.push(o),i},es=class{constructor(e,t,r){this.id=e,this.children=t,this.metadata=r}},Pf=e=>({open:()=>Cv({width:e}),write:Tv,close:Bv}),Av={width:174},Cv=({width:e}=Av)=>({width:e,head:null,leafIndex:[],nodeIndex:[],lastID:0}),Tv=(e,t)=>{if(t.length===0)return{layout:e,nodes:me,leaves:me};{let{lastID:r}=e,[n,i]=e.head?[null,(t.unshift(e.head),t)]:t.length===1&&e.leafIndex.length===0?[t[0],me]:[null,t];if(i.length===0)return{layout:{...e,head:n},nodes:me,leaves:me};{let o=[...e.leafIndex],s=[];for(let a of i){let l={id:++r,content:a};s.push(l),o.push(l.id)}return o.length>=e.width?Rf({...e,leafIndex:o,head:n,lastID:r},s):{layout:{...e,head:n,leafIndex:o,lastID:r},leaves:s,nodes:me}}}},Rf=(e,t=me,r=[],n=!1)=>{let{lastID:i}=e,o=e.nodeIndex.map(u=>[...u]),s=[...e.leafIndex],{width:a}=e;for(;s.length>=a||s.length>0&&n;){mu(o,1);let u=new es(++i,s.splice(0,a));o[0].push(u.id),r.push(u)}let l=0;for(;l<o.length;){let u=o[l];for(l++;u.length>=a||u.length>0&&n&&l<o.length;){let c=new es(++i,u.splice(0,a));mu(o,l+1),o[l].push(c.id),r.push(c)}}return{layout:{...e,lastID:i,leafIndex:s,nodeIndex:o},leaves:t,nodes:r}},Bv=(e,t)=>{let r=e;if(e.head)return{root:{id:1,content:e.head,metadata:t},leaves:me,nodes:me};if(e.leafIndex.length===0)return{root:{id:1,metadata:t},leaves:me,nodes:me};{let{nodes:n,layout:i}=Rf(r,me,[],!0),{nodeIndex:o}=i,s=o.length-1,a=o[s];if(a.length===1){let l=n[n.length-1];return n.length=n.length-1,{root:l,nodes:n,leaves:me}}else return{root:new es(i.lastID+1,a,t),nodes:n,leaves:me}}},mu=(e,t)=>{for(;e.length<t;)e.push([]);return e},me=[],Yi=()=>({chunker:zf,fileChunkEncoder:vu,smallFileEncoder:vu,fileEncoder:tf,fileLayout:Pf(174),hasher:Er,linker:{createLink:ce.createV1}}),Aa=e=>({...Yi(),...e}),vu={code:sa,name:uf,encode:yf},Hf=({writer:e,metadata:t={},settings:r=Yi()})=>new Lv(pv(e,t,Aa(r))),Fv=async(e,t)=>(await Vf(e,ga({type:"write",bytes:t})),e),_v=async(e,{releaseLock:t=!1,closeWriter:r=!1}={})=>{await Vf(e,ga({type:"close"}));let{state:n}=e;if(n.status==="linked")return r?await e.state.writer.close():t&&e.state.writer.releaseLock(),n.link;Sa(`Expected writer to be in 'linked' state after close, but it is in "${n.status}" instead`)},Vf=(e,t)=>Zi(Z2(t,r=>{let{state:n,effect:i}=dv(r,e.state);return e.state=n,i})),Lv=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.config}write(e){return Fv(this,e)}close(e){return _v(this,e)}},Iv=Yi,Uv=({writer:e,settings:t=Iv(),metadata:r={}})=>new Wf({writer:e,metadata:r,settings:t,entries:new Map,closed:!1}),Dv=(e,t,r,{overwrite:n=!1}={})=>{let i=Ca(e.state);if(t.includes("/"))throw new Error(`Directory entry name "${t}" contains forbidden "/" character`);if(!n&&i.entries.has(t))throw new Error(`Directory already contains entry with name "${t}"`);return i.entries.set(t,r),e},Nv=(e,t)=>(Ca(e.state).entries.delete(t),e),Ca=e=>{if(e.closed)throw new Error("Can not change written directory, but you can .fork() and make changes to it");return e},jv=async(e,{closeWriter:t=!1,releaseLock:r=!1}={})=>{let{writer:n,settings:i,metadata:o}=Ca(e.state);e.state.closed=!0;let s=[...qf(e)],a=aa(s,o),l=ca(a),u=await i.hasher.digest(l),c=i.linker.createLink(sa,u);return(n.desiredSize||0)<=0&&await n.ready,n.write({cid:c,bytes:l}),t?await n.close():r&&n.releaseLock(),{cid:c,dagByteLength:da(l,s)}},qf=function*({state:e}){for(let[t,{dagByteLength:r,cid:n}]of e.entries)yield{name:t,dagByteLength:r,cid:n}},zv=({state:e},{writer:t=e.writer,metadata:r=e.metadata,settings:n=e.settings}={})=>new Wf({writer:t,metadata:r,settings:n,entries:new Map(e.entries.entries()),closed:!1}),Wf=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}links(){return qf(this)}set(e,t,r){return Dv(this,e,t,r)}remove(e){return Nv(this,e)}fork(e){return zv(this,e)}close(e){return jv(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}},Gf={};ie(Gf,{API:()=>Kf,and:()=>Vv,bitCount:()=>Ta,empty:()=>Jf,from:()=>Mv,fromBytes:()=>Gv,get:()=>Hv,or:()=>qv,popcount:()=>Qf,set:()=>Zf,size:()=>Ov,toBytes:()=>Wv,unset:()=>Rv});var Kf={},Jf=(e=32)=>{if(e!==32)throw new Error(`Uint32 BitField does not support size: ${e}`);return 0},Mv=(e,t)=>{let r=Jf(t);for(let n of e)r=Zf(r,n);return r},Ov=e=>32,$v=(e,t)=>e>>>t&31,Pv=(e,t)=>1<<$v(e,t),Qf=(e,t=31)=>Ta(e&Pv(t,0)-1),Zf=(e,t)=>e|1<<t,Rv=(e,t)=>e&(255^1<<t),Hv=(e,t)=>(e>>t&1)!==0,Ta=e=>{let t=e-(e>>1&1431655765),r=(t&858993459)+(t>>2&858993459);return(r+(r>>4)&252645135)*16843009>>24},Vv=(e,t)=>e&t,qv=(e,t)=>e|t,Wv=e=>Uint8Array.of(e>>24&255,e>>16&255,e>>8&255,e&255),Gv=e=>{if(e.length!==4)throw new Error(`Expected 4 bytes instead got ${e.length}`);return(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3]},Kv=X(dc(),1),Jv=new TextEncoder,Qv=Kv.default.x64.hash126,Zv=({bitWidth:e=5,hash:t=Qv})=>{if(e>4*8)throw new RangeError(`Can not use bitWidth ${e} which exceeds the hashSize 4`);if(4*8>32)throw new RangeError("Can not use hashSize 4 as it can not be encoded in Uint32");let r=4294967295>>>32-e;return{at:(n,i)=>n>>>i*e&r,from:n=>t(Jv.encode(n)),size:Math.ceil(4*8/e)}},fi=class{constructor(e,t,r,n,i){this.edit=e,this.config=i,this.datamap=t,this.nodemap=r,this.children=n}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return Xi(this.config)}lookup(e,t,r,n){return Xf(this,e,t,r,n)}associate(e,t,r,n,i,o){return _a(this,e,t,r,n,i,o)}dissociate(e,t,r,n,i){return rd(this,e,t,r,n,i)}fork(e=null){return fn(this,e)}entries(){return nd(this)}keys(){return id(this)}values(){return od(this)}},Yf=class{constructor(e,t,r,n){this.edit=e,this.count=t,this.children=r,this.config=n}get nodeArity(){return 0}get dataArity(){return this.count}lookup(e,t,r,n){return Yv(this,r,n)}associate(e,t,r,n,i,o){return Xv(this,e,r,n,i,o)}dissociate(e,t,r,n,i){return ek(this,e,r,n,i)}fork(e=null){return tk(this,e)}entries(){return nd(this)}keys(){return id(this)}values(){return od(this)}},Yv=(e,t,r)=>{let{children:n,count:i}=e,o=Ba(n,i,t);return n[o]===t?n[o+1]:r},Xv=(e,t,r,n,i,o)=>{let{children:s,count:a}=e,l=Ba(s,a,n);if(s[l]!==n){let u=e.fork(t);return o.value=!0,u.count+=1,u.children.splice(l,r,i),u}else if(s[l+1]!==i){let u=e.fork(t);return u.children[l+1]=i,u}else return e},ek=(e,t,r,n,i)=>{let{children:o,count:s,config:a}=e,l=Ba(o,s,n);if(o[l]!==n)return e;if(i.value=!0,s===2){let u=l===0?2:0;return _a(Xi(a),t,0,r,o[u],o[u+1],i)}else{let u=e.fork(t);return u.children.splice(l,2),u.count-=1,u}},tk=(e,t=null)=>ud(e.edit,t)?e:new Yf(t,e.count,e.children.slice(),e.config),Ba=(e,t,r)=>{let n=0;for(;n<t&&e[n]>r;)n+=2;return n},Xi=(e,t=null)=>new fi(t,e.BitField.empty(Math.pow(2,e.bitWidth)),e.BitField.empty(Math.pow(2,e.bitWidth)),[],e),Fa=(e,t,r)=>Xf(e,0,e.config.Path.from(t),t,r),Xf=(e,t,r,n,i)=>{let{datamap:o,nodemap:s,config:a}=e,{Path:l,BitField:u}=a,c=l.at(r,t);if(u.get(o,c)){let f=u.popcount(o,c);return La(e,f)===n?ts(e,f):i}else return u.get(s,c)?Ia(e,c).lookup(t+1,r,n,i):i},ed=(e,t,r,n,i)=>_a(e,t,0,e.config.Path.from(r),r,n,i),_a=(e,t,r,n,i,o,s)=>{let{datamap:a,nodemap:l,config:u}=e,{Path:c,BitField:f}=u,w=c.at(n,r);if(f.get(a,w)){let p=f.popcount(a,w),d=La(e,p);if(i===d)return ts(e,p)===o?e:rk(e,t,p,o);{let h=ad(u,t,r+1,c.from(d),d,ts(e,p),n,i,o);return s.value=!0,ik(e,t,w,h)}}else if(f.get(l,w)){let p=Ia(e,w),d=p.associate(t,r+1,n,i,o,s);return p===d?e:sd(e,t,w,d)}else{let p=f.popcount(a,w);s.value=!0;let d=e.fork(t);return d.datamap=f.set(a,w),d.children.splice(dn(p),0,i,o),d}},td=(e,t,r,n)=>rd(e,t,0,e.config.Path.from(r),r,n),rd=(e,t,r,n,i,o)=>{let{datamap:s,nodemap:a,config:l}=e,{BitField:u,Path:c}=l,f=c.at(n,r);if(u.get(s,f)){let w=u.popcount(s,f);if(i===La(e,w)){o.value=!0;let p=fn(e,t);return p.datamap=u.unset(e.datamap,f),p.children.splice(dn(w),2),p}else return e}else if(u.get(a,f)){let w=Ia(e,f),p=w.dissociate(t,r+1,n,i,o);return ok(p)?sk(e)?p:nk(e,t,f,p):w===p?e:sd(e,t,f,p)}else return e},nd=function*({children:e}){let t=0,r=e.length;for(;t<r;){let n=e[t];if(typeof n=="string"){t+=1;let i=e[t];yield[n,i],t+=1}else break}for(;t<r;)yield*e[t].entries(),t+=1},fn=(e,t)=>ud(e.edit,t)?e:new fi(t,e.datamap,e.nodemap,e.children.slice(),e.config),id=function*({children:e}){let t=0,r=e.length;for(;t<r;){let n=e[t];if(typeof n=="string")yield n,t+=2;else break}for(;t<r;)yield*e[t].keys(),t+=1},od=function*({children:e}){let t=0,r=e.length;for(;t<r&&typeof e[t]=="string";)t+=1,yield e[t],t+=1;for(;t<r;)yield*e[t].values(),t+=1},rk=(e,t,r,n)=>{let i=e.fork(t);return i.children[ld(r)]=n,i},nk=(e,t,r,n)=>{let{datamap:i,nodemap:o,config:s}=e,{BitField:a}=s,l=fn(e,t);return l.children.splice(eo(e,r),1),l.children.splice(dn(a.popcount(i,r)),0,n.children[0],n.children[1]),l.datamap=a.set(i,r),l.nodemap=a.unset(o,r),l},sd=(e,t,r,n)=>{let i=fn(e,t);return i.children[eo(e,r)]=n,i},ik=(e,t,r,n)=>{let{nodemap:i,datamap:o,config:s}=e,{BitField:a}=s,l=a.popcount(o,r),u=dn(l),c=eo(e,r),f=fn(e,t);return f.datamap=a.unset(o,r),f.children.splice(u,2),f.nodemap=a.set(i,r),f.children.splice(c-1,0,n),f},ad=(e,t,r,n,i,o,s,a,l)=>{let{BitField:u,Path:c}=e;if(c.size<r)return new Yf(t,2,[i,o,a,l],e);{let f=c.at(n,r),w=c.at(s,r);return f===w?new fi(t,u.empty(Math.pow(2,e.bitWidth)),u.from([f],Math.pow(2,e.bitWidth)),[ad(e,t,r+1,n,i,o,s,a,l)],e):new fi(t,u.from([f,w],Math.pow(2,e.bitWidth)),u.empty(Math.pow(2,e.bitWidth)),f<w?[i,o,a,l]:[a,l,i,o],e)}},La=({children:e},t)=>e[dn(t)],dn=e=>e*2,ts=({children:e},t)=>e[ld(t)],ld=e=>e*2+1,Ia=(e,t)=>e.children[eo(e,t)],eo=({children:e,nodemap:t,config:r},n)=>e.length-1-r.BitField.popcount(t,n),ud=(e,t)=>e!=null&&e===t,ok=e=>e.nodeArity===0&&e.dataArity===1,sk=({config:{BitField:e},datamap:t,nodemap:r})=>e.popcount(t)===0&&e.popcount(r)===1,Ua=X(dc(),1);function ak(e){let t=new Array(4);for(let r=0;r<4;r++)t[r]=e&255,e=e>>8;return new Uint8Array(t)}var P4=sn({name:"murmur3-32",code:35,encode:e=>ak(Ua.default.x86.hash32(e))}),lk=sn({name:"murmur3-128",code:34,encode:e=>Di.fromHex(Ua.default.x64.hash128(e))}),cd=sn({name:"murmur3-x64-64",code:34,encode:e=>Di.fromHex(Ua.default.x64.hash128(e)).subarray(0,8)}),uk=new TextEncoder,ck=e=>cd.encode(e),hk=({bitWidth:e=8,hash:t=ck}={})=>{let r=t(new Uint8Array).byteLength;return{from:n=>t(uk.encode(n)),at:(n,i)=>{let o=i*e;if(o>r)throw new RangeError("Out of bounds");return hd(n,o,e)},size:Math.ceil(r*8/e)}},hd=(e,t,r)=>{let n=t/8|0,i=t%8,o=r,s=0;for(;o>0&&n<e.byteLength;){let a=e[n],l=8-i,u=l<o?l:o,c=8-i-u,f=(255>>i&a)>>c;s=(s<<u)+f,o-=u,n++,i=0}return s},fd={};ie(fd,{API:()=>Kf,and:()=>kk,empty:()=>dd,from:()=>fk,fromBytes:()=>bk,get:()=>wk,or:()=>vk,popcount:()=>mk,set:()=>pk,size:()=>dk,toBytes:()=>gk,unset:()=>yk});var dd=(e=256)=>{if(e%8!==0)throw new Error("Must be multiple of 8");return new Uint8Array(e/8)},fk=(e,t)=>{let r=dd(t);for(let n of e){let{byte:i,byteOffset:o,bitOffset:s}=pn(r,n);r[o]=i|1<<s}return r},dk=e=>e.byteLength*8,pn=(e,t)=>{let r=e.byteLength-1-(t/8|0),n=t%8;return{byte:e[r],byteOffset:r,bitOffset:n}},pd=(e,t,r)=>{if(e[t]!==r){let n=e.slice(0);return n[t]=r,n}return e},pk=(e,t)=>{let{byte:r,byteOffset:n,bitOffset:i}=pn(e,t);return pd(e,n,r|1<<i)},yk=(e,t)=>{let{byte:r,byteOffset:n,bitOffset:i}=pn(e,t);return pd(e,n,r&(255^1<<i))},wk=(e,t)=>{var{byte:r,bitOffset:n}=pn(e,t);return(r>>n&1)!==0},gk=e=>e,bk=e=>e,mk=(e,t=e.byteLength*8)=>{let{byteOffset:r,bitOffset:n,byte:i}=pn(e,t),o=Qf(i,n),s=e.byteLength-1;for(;s>r;){let a=e[s];o+=Ta(a),s--}return o},vk=(e,t)=>{let r=e.slice(),n=0;for(;n<e.length;)r[n]|=t[n],n++;return r},kk=(e,t)=>{let r=e.slice(),n=0;for(;n<e.length;)r[n]&=t[n],n++;return r},ku=new RangeError("Not Found"),Ek=({bitWidth:e=5,BitField:t=e===5?Gf:fd,Path:r=e===5?Zv({bitWidth:e}):hk({bitWidth:e})}={})=>({bitWidth:e,BitField:t,Path:r}),yd=(e,t)=>Fa(e.root,t,ku)!==ku,Sk=(e,t,r=void 0)=>Fa(e.root,t,r),xk=e=>{let t={},r=Ek(e);return new wd(t,0,Xi(r,t),r)},Ak=class Nr{constructor(t=0,r,n){this.count=t,this.root=r,this.config=n}get size(){return this.count}clone(){return new Nr(this.count,this.root,this.config)}empty(){return new Nr(0,Xi(this.config,null),this.config)}has(t){return yd(this,t)}get(t){return Fa(this.root,t,void 0)}set(t,r){let n={value:!1},i=ed(this.root,null,t,r,n);return i===this.root?this:new Nr(n.value?this.count+1:this.count,i,this.config)}delete(t){let r=td(this.root,null,t,{value:!1});return r===this.root?this:new Nr(this.count-1,r,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new wd({},this.count,this.root,this.config)}},wd=class{constructor(e,t,r,n){this.edit=e,this.count=t,this.root=r,this.config=n}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(e,t){if(this.edit){let r={value:!1},n=ed(this.root,this.edit,e,t,r);return this.root!==n&&(this.root=n),r.value&&(this.count+=1),this}else throw new Error(".set was called on the finalized builder")}delete(e){if(this.edit){if(this.count===0)return this;let t={value:!1},r=td(this.root,this.edit,e,t);return r!==this.root&&(this.root=r),t.value&&(this.count-=1),this}else throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new Ak(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}},Ck=new TextEncoder,Tk=e=>cd.encode(e),Bk=({bitWidth:e=8,hash:t=Tk})=>{let r=t(new Uint8Array).byteLength,n={bitWidth:e,hash:t,hashSize:r};return{at:(i,o)=>Fk(i,o,n),from:i=>Ck.encode(i),size:1/0}},Fk=(e,t=0,{bitWidth:r=8,hash:n,hashSize:i})=>{let o=i*8,s=0,a=r,l=r*t;for(;a>0;){let u=l/o>>0,c=n(u===0?e:_k(e,u)),f=o<=l?l%o:l,w=o-f,p=w<a?w:a;s=(s<<p)+hd(c,f,p),a-=p,l+=p}return s},_k=(e,t)=>{let r=new Uint8Array(e.byteLength+1).fill(t,e.byteLength);return r.set(e),r},Eu=8,Lk={bitWidth:Eu,Path:Bk({bitWidth:Eu})},Su=(e=Lk)=>xk(e),R4=class extends Map{constructor(e=Su()){super(),this.builder=e}clear(){this.builder=Su()}delete(e){let{root:t}=this.builder;return this.builder.delete(e),this.builder.root!==t}forEach(e,t=this){for(let[r,n]of this.builder.root.entries())e.call(t,n,r,this)}get(e){return Sk(this.builder,e)}has(e){return yd(this.builder,e)}set(e,t){return this.builder.set(e,t),this}get size(){return this.builder.size}[Symbol.iterator](){return this.builder.root.entries()}entries(){return this.builder.root.entries()}keys(){return this.builder.root.keys()}values(){return this.builder.root.values()}},Ik=({writable:e,settings:t=Yi()})=>new Dk({writer:e.getWriter(),settings:t}),Uk=async(e,{releaseLock:t=!0,closeWriter:r=!0}={})=>(r?await e.writer.close():t&&e.writer.releaseLock(),e),Dk=class{constructor({writer:e,settings:t}){this.writer=e,this.settings=Aa(t)}createFileWriter({settings:e=this.settings,metadata:t}={}){return Hf({writer:this.writer,settings:e,metadata:t})}createDirectoryWriter({settings:e=this.settings,metadata:t}={}){return Uv({writer:this.writer,settings:e,metadata:t})}close(e){return Uk(this,e)}},Nk=1048576,jk=Nk*100,zk=(e=jk)=>({highWaterMark:e,size:t=>t.bytes.length}),Da=X(Xe(),1);function Mk(e){return e[Symbol.asyncIterator]!=null}function Ok(e){if(Mk(e))return(async()=>{let r;for await(let n of e)r=n;return r})();let t;for(let r of e)t=r;return t}var $k=Ok,Pk=X(Xe(),1),gd=0,Rk="identity",bd=Dt,Hk=e=>ri(gd,bd(e)),Vk={code:gd,name:Rk,encode:bd,digest:Hk},qk=X(Xe(),1),Wk=async(e,t,r,n,i,o,s,a)=>{let l=await s.get(e,a),u=Bs(l),c=u,f=r;for(;n.length>0;){let w=n[0];if(w in c){n.shift(),f=`${f}/${w}`;let p=ne.asCID(c[w]);if(p!=null)return{entry:{type:"object",name:t,path:r,cid:e,node:l,depth:o,size:BigInt(l.length),content:async function*(){yield u}},next:{cid:p,name:w,path:f,toResolve:n}};c=c[w]}else throw(0,qk.default)(new Error(`No property named ${w} found in cbor node ${e}`),"ERR_NO_PROP")}return{entry:{type:"object",name:t,path:r,cid:e,node:l,depth:o,size:BigInt(l.length),content:async function*(){yield u}}}},Gk=Wk,Kk=X(Xe(),1),mt=class extends Event{constructor(e,t){super(e),this.detail=t}};function Jk(e,t,r,n){let i=BigInt(e.length),o=BigInt(t+i);return r>=o||n<t?new Uint8Array(0):(n>=t&&n<o&&(e=e.subarray(0,Number(n-t))),r>=t&&r<o&&(e=e.subarray(Number(r-t))),e)}var di=Jk,_n=X(Xe(),1),Qk=(e,t=0,r=e)=>{let n=BigInt(e),i=BigInt(t??0),o=BigInt(r);if(o!==n&&(o=i+o),o>n&&(o=n),i<0n)throw(0,_n.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>n)throw(0,_n.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(o<0n)throw(0,_n.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>n)throw(0,_n.default)(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:i,end:o}},Na=Qk,Zk=e=>{async function*t(r={}){let{start:n,end:i}=Na(e.length,r.offset,r.length),o=di(e,0n,n,i);r.onProgress?.(new mt("unixfs:exporter:progress:identity",{bytesRead:BigInt(o.byteLength),totalBytes:i-n,fileSize:BigInt(e.byteLength)})),yield o}return t},Yk=async(e,t,r,n,i,o,s,a)=>{if(n.length>0)throw(0,Kk.default)(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");let l=Nc(e.multihash.bytes);return{entry:{type:"identity",name:t,path:r,cid:e,content:Zk(l.digest),depth:o,size:BigInt(l.digest.length),node:l.digest}}},Xk=Yk,e6=X(Xe(),1),t6=e=>{async function*t(r={}){let{start:n,end:i}=Na(e.length,r.offset,r.length),o=di(e,0n,n,i);r.onProgress?.(new mt("unixfs:exporter:progress:raw",{bytesRead:BigInt(o.byteLength),totalBytes:i-n,fileSize:BigInt(e.byteLength)})),yield o}return t},r6=async(e,t,r,n,i,o,s,a)=>{if(n.length>0)throw(0,e6.default)(new Error(`No link named ${r} found in raw node ${e}`),"ERR_NOT_FOUND");let l=await s.get(e,a);return{entry:{type:"raw",name:t,path:r,cid:e,content:t6(l),depth:o,size:BigInt(l.length),node:l}}},n6=r6,Ln=X(Xe(),1),xu=X(Xe(),1),md=X(ps(),1),i6=X(fc(),1),o6=X(kt(),1),vd=X(ds(),1),s6=X(hc(),1);function a6(){o6.default._configure(),md.default._configure(i6.default),vd.default._configure(s6.default)}a6();var kd=["uint64","int64","sint64","fixed64","sfixed64"];function l6(e){for(let t of kd){if(e[t]==null)continue;let r=e[t];e[t]=function(){return BigInt(r.call(this).toString())}}return e}function u6(e){return l6(new md.default(e))}function c6(e){for(let t of kd){if(e[t]==null)continue;let r=e[t];e[t]=function(n){return r.call(this,n.toString())}}return e}function h6(){return c6(vd.default.create())}function ja(e,t){let r=u6(e instanceof Uint8Array?e:e.subarray());return t.decode(r)}function za(e,t){let r=h6();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var pi;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(pi||(pi={}));function Ed(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function f6(e){function t(i){if(e[i.toString()]==null)throw new Error("Invalid enum value");return e[i]}let r=function(i,o){let s=t(i);o.int32(s)},n=function(i){let o=i.int32();return t(o)};return Ed("enum",pi.VARINT,r,n)}function Ma(e,t){return Ed("message",pi.LENGTH_DELIMITED,e,t)}var Oe;(function(e){let t;(function(i){i.Raw="Raw",i.Directory="Directory",i.File="File",i.Metadata="Metadata",i.Symlink="Symlink",i.HAMTShard="HAMTShard"})(t=e.DataType||(e.DataType={}));let r;(function(i){i[i.Raw=0]="Raw",i[i.Directory=1]="Directory",i[i.File=2]="File",i[i.Metadata=3]="Metadata",i[i.Symlink=4]="Symlink",i[i.HAMTShard=5]="HAMTShard"})(r||(r={})),function(i){i.codec=()=>f6(r)}(t=e.DataType||(e.DataType={}));let n;e.codec=()=>(n==null&&(n=Ma((i,o,s={})=>{if(s.lengthDelimited!==!1&&o.fork(),i.Type!=null&&(o.uint32(8),e.DataType.codec().encode(i.Type,o)),i.Data!=null&&(o.uint32(18),o.bytes(i.Data)),i.filesize!=null&&(o.uint32(24),o.uint64(i.filesize)),i.blocksizes!=null)for(let a of i.blocksizes)o.uint32(32),o.uint64(a);i.hashType!=null&&(o.uint32(40),o.uint64(i.hashType)),i.fanout!=null&&(o.uint32(48),o.uint64(i.fanout)),i.mode!=null&&(o.uint32(56),o.uint32(i.mode)),i.mtime!=null&&(o.uint32(66),yi.codec().encode(i.mtime,o)),s.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let s={blocksizes:[]},a=o==null?i.len:i.pos+o;for(;i.pos<a;){let l=i.uint32();switch(l>>>3){case 1:s.Type=e.DataType.codec().decode(i);break;case 2:s.Data=i.bytes();break;case 3:s.filesize=i.uint64();break;case 4:s.blocksizes.push(i.uint64());break;case 5:s.hashType=i.uint64();break;case 6:s.fanout=i.uint64();break;case 7:s.mode=i.uint32();break;case 8:s.mtime=yi.codec().decode(i,i.uint32());break;default:i.skipType(l&7);break}}return s})),n),e.encode=i=>za(i,e.codec()),e.decode=i=>ja(i,e.codec())})(Oe||(Oe={}));var yi;(function(e){let t;e.codec=()=>(t==null&&(t=Ma((r,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),r.Seconds!=null&&(n.uint32(8),n.int64(r.Seconds)),r.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(r.FractionalNanoseconds)),i.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let i={},o=n==null?r.len:r.pos+n;for(;r.pos<o;){let s=r.uint32();switch(s>>>3){case 1:i.Seconds=r.int64();break;case 2:i.FractionalNanoseconds=r.fixed32();break;default:r.skipType(s&7);break}}return i})),t),e.encode=r=>za(r,e.codec()),e.decode=r=>ja(r,e.codec())})(yi||(yi={}));var Au;(function(e){let t;e.codec=()=>(t==null&&(t=Ma((r,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),r.MimeType!=null&&(n.uint32(10),n.string(r.MimeType)),i.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let i={},o=n==null?r.len:r.pos+n;for(;r.pos<o;){let s=r.uint32();switch(s>>>3){case 1:i.MimeType=r.string();break;default:r.skipType(s&7);break}}return i})),t),e.encode=r=>za(r,e.codec()),e.decode=r=>ja(r,e.codec())})(Au||(Au={}));var Cu={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},d6=["directory","hamt-sharded-directory"],Tu=parseInt("0644",8),Bu=parseInt("0755",8),Sd=class xd{constructor(t={type:"file"}){x(this,"type"),x(this,"data"),x(this,"blockSizes"),x(this,"hashType"),x(this,"fanout"),x(this,"mtime"),x(this,"_mode"),x(this,"_originalMode");let{type:r,data:n,blockSizes:i,hashType:o,fanout:s,mtime:a,mode:l}=t;if(r!=null&&!Object.values(Cu).includes(r))throw(0,xu.default)(new Error("Type: "+r+" is not valid"),"ERR_INVALID_TYPE");this.type=r??"file",this.data=n,this.hashType=o,this.fanout=s,this.blockSizes=i??[],this._originalMode=0,this.mode=l,this.mtime=a}static unmarshal(t){let r=Oe.decode(t),n=new xd({type:Cu[r.Type!=null?r.Type.toString():"File"],data:r.Data,blockSizes:r.blocksizes,mode:r.mode,mtime:r.mtime!=null?{secs:r.mtime.Seconds??0n,nsecs:r.mtime.FractionalNanoseconds}:void 0});return n._originalMode=r.mode??0,n}set mode(t){t==null?this._mode=this.isDirectory()?Bu:Tu:this._mode=t&4095}get mode(){return this._mode}isDirectory(){return d6.includes(this.type)}addBlockSize(t){this.blockSizes.push(t)}removeBlockSize(t){this.blockSizes.splice(t,1)}fileSize(){if(this.isDirectory())return 0n;let t=0n;return this.blockSizes.forEach(r=>{t+=r}),this.data!=null&&(t+=BigInt(this.data.length)),t}marshal(){let t;switch(this.type){case"raw":t=Oe.DataType.Raw;break;case"directory":t=Oe.DataType.Directory;break;case"file":t=Oe.DataType.File;break;case"metadata":t=Oe.DataType.Metadata;break;case"symlink":t=Oe.DataType.Symlink;break;case"hamt-sharded-directory":t=Oe.DataType.HAMTShard;break;default:throw(0,xu.default)(new Error(`Type: ${t} is not valid`),"ERR_INVALID_TYPE")}let r=this.data;(this.data==null||this.data.length===0)&&(r=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===Tu&&!this.isDirectory()&&(n=void 0),n===Bu&&this.isDirectory()&&(n=void 0));let i;return this.mtime!=null&&(i={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Oe.encode({Type:t,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i})}},p6=X(Ny(),1),Ad={};ie(Ad,{identity:()=>y6});var y6=Fi({prefix:"\0",name:"identity",encode:e=>uw(e),decode:e=>lw(e)}),Cd={};ie(Cd,{base2:()=>w6});var w6=fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Td={};ie(Td,{base8:()=>g6});var g6=fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Bd={};ie(Bd,{base10:()=>b6});var b6=Yr({prefix:"9",name:"base10",alphabet:"0123456789"}),Fd={};ie(Fd,{base16:()=>m6,base16upper:()=>v6});var m6=fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),v6=fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),_d={};ie(_d,{base36:()=>k6,base36upper:()=>E6});var k6=Yr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),E6=Yr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ld={};ie(Ld,{base64:()=>S6,base64pad:()=>x6,base64url:()=>A6,base64urlpad:()=>C6});var S6=fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),x6=fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),A6=fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),C6=fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Id={};ie(Id,{base256emoji:()=>L6});var Ud=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),T6=Ud.reduce((e,t,r)=>(e[r]=t,e),[]),B6=Ud.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function F6(e){return e.reduce((t,r)=>(t+=T6[r],t),"")}function _6(e){let t=[];for(let r of e){let n=B6[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}var L6=Fi({prefix:"\u{1F680}",name:"base256emoji",encode:F6,decode:_6}),Dd={};ie(Dd,{identity:()=>D6});var Nd=0,I6="identity",jd=Bi,U6=e=>Qn(Nd,jd(e)),D6={code:Nd,name:I6,encode:jd,digest:U6},H4=new TextEncoder,V4=new TextDecoder,Fu={...Ad,...Cd,...Td,...Bd,...Fd,...gc,..._d,...yc,...Ld,...Id},q4={...Gh,...Dd};function Oa(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function zd(e=0){return globalThis.Buffer?.allocUnsafe!=null?Oa(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Md(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var _u=Md("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),vo=Md("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=zd(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),N6={utf8:_u,"utf-8":_u,hex:Fu.base16,latin1:vo,ascii:vo,binary:vo,...Fu},j6=N6;function z6(e,t="utf8"){let r=j6[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Oa(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}var $a=class at{constructor(t,r,n=0){this._options=t,this._popCount=0,this._parent=r,this._posAtParent=n,this._children=new p6.default,this.key=null}async put(t,r){let n=await this._findNewBucketAndPos(t);await n.bucket._putAt(n,t,r)}async get(t){let r=await this._findChild(t);if(r!=null)return r.value}async del(t){let r=await this._findPlace(t),n=r.bucket._at(r.pos);n!=null&&n.key===t&&r.bucket._delAt(r.pos)}leafCount(){return this._children.compactArray().reduce((t,r)=>r instanceof at?t+r.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let t=this._children.compactArray();for(let r of t)r instanceof at?yield*r.eachLeafSeries():yield r}serialize(t,r){let n=[];return r(this._children.reduce((i,o,s)=>(o!=null&&(o instanceof at?i.push(o.serialize(t,r)):i.push(t(o,s))),i),n))}async asyncTransform(t,r){return await Od(this,t,r)}toJSON(){return this.serialize(O6,$6)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){let r=await this._findPlace(t),n=r.bucket._at(r.pos);if(!(n instanceof at)&&n!=null&&n.key===t)return n}async _findPlace(t){let r=this._options.hash(typeof t=="string"?z6(t):t),n=await r.take(this._options.bits),i=this._children.get(n);return i instanceof at?await i._findPlace(r):{bucket:this,pos:n,hash:r,existingChild:i}}async _findNewBucketAndPos(t){let r=await this._findPlace(t);if(r.existingChild!=null&&r.existingChild.key!==t){let n=new at(this._options,r.bucket,r.pos);r.bucket._putObjectAt(r.pos,n);let i=await n._findPlace(r.existingChild.hash);return i.bucket._putAt(i,r.existingChild.key,r.existingChild.value),await n._findNewBucketAndPos(r.hash)}return r}_putAt(t,r,n){this._putObjectAt(t.pos,{key:r,value:n,hash:t.hash})}_putObjectAt(t,r){this._children.get(t)==null&&this._popCount++,this._children.set(t,r)}_delAt(t){if(t===-1)throw new Error("Invalid position");this._children.get(t)!=null&&this._popCount--,this._children.unset(t),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let t=this._children.find(M6);if(t!=null&&!(t instanceof at)){let r=t.hash;r.untake(this._options.bits);let n={pos:this._posAtParent,hash:r,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(t){return this._children.get(t)}};function M6(e){return!!e}function O6(e,t){return e.key}function $6(e){return e}async function Od(e,t,r){let n=[];for(let i of e._children.compactArray())if(i instanceof $a)await Od(i,t,r);else{let o=await t(i);n.push({bitField:e._children.bitField(),children:o})}return await r(n)}var P6=[255,254,252,248,240,224,192,128],R6=[1,3,7,15,31,63,127,255],H6=class{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,r=0;for(;t>0&&this._haveBits();){let n=this._value[this._currentBytePos],i=this._currentBitPos+1,o=Math.min(i,t),s=V6(n,i-o,o);r=(r<<o)+s,t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return r}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function V6(e,t,r){let n=q6(t,r);return(e&n)>>>t}function q6(e,t){return P6[e]&R6[Math.min(t+e-1,7)]}function W6(e,t){t==null&&(t=e.reduce((i,o)=>i+o.length,0));let r=zd(t),n=0;for(let i of e)r.set(i,n),n+=i.length;return Oa(r)}function G6(e){function t(r){return r instanceof Lu?r:new Lu(r,e)}return t}var Lu=class{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let r=0;for(;t>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.availableBits(),t),o=n.take(i);r=(r<<i)+o,t-=i,this._availableBits-=i,n.availableBits()===0&&this._currentBufferIndex++}return r}untake(e){let t=e;for(;t>0;){let r=this._buffers[this._currentBufferIndex],n=Math.min(r.totalBits()-r.availableBits(),t);r.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&r.totalBits()===r.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?W6([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),r=new H6(t);this._buffers.push(r),this._availableBits+=r.availableBits()}};function K6(e){if(e==null||e.hashFn==null)throw new Error("please define an options.hashFn");let t={bits:e.bits??8,hash:G6(e.hashFn)};return new $a(t)}var J6=async function(e){return(await lk.encode(e)).slice(0,8).reverse()},Q6=async(e,t,r)=>{await Promise.all(e.map(async n=>{if(n.Name==null)throw new Error("Unexpected Link without a Name");if(n.Name.length===2){let i=parseInt(n.Name,16);t._putObjectAt(i,new $a({hash:r._options.hash,bits:r._options.bits},t,i));return}await r.put(n.Name.substring(2),!0)}))},Iu=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Z6=e=>{let t=e.bucket,r=[];for(;t._parent!=null;)r.push(t),t=t._parent;return r.push(t),r.reverse()},$d=async(e,t,r,n,i)=>{if(n==null){let c=K6({hashFn:J6});n={rootBucket:c,hamtDepth:1,lastBucket:c}}await Q6(e.Links,n.lastBucket,n.rootBucket);let o=await n.rootBucket._findNewBucketAndPos(t),s=Iu(o.pos),a=Z6(o);a.length>n.hamtDepth&&(n.lastBucket=a[n.hamtDepth],s=Iu(n.lastBucket._posAtParent));let l=e.Links.find(c=>{if(c.Name==null)return!1;let f=c.Name.substring(0,2),w=c.Name.substring(2);return!(f!==s||w!==""&&w!==t)});if(l==null)return;if(l.Name!=null&&l.Name.substring(2)===t)return l.Hash;n.hamtDepth++;let u=await r.get(l.Hash,i);return e=un(u),$d(e,t,r,n,i)},Y6=$d;function X6(e){let[t,r]=e[Symbol.asyncIterator]!=null?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>t.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:t.next(),[r](){return this}}}var Pd=X6;function e8(e){return e[Symbol.asyncIterator]!=null}function t8(e,t){if(e8(e))return async function*(){for await(let a of e)await t(a)&&(yield a)}();let r=Pd(e),{value:n,done:i}=r.next();if(i===!0)return function*(){}();let o=t(n);if(typeof o.then=="function")return async function*(){await o&&(yield n);for await(let a of r)await t(a)&&(yield a)}();let s=t;return function*(){o===!0&&(yield n);for(let a of r)s(a)&&(yield a)}()}var r8=t8;function n8(e){return e[Symbol.asyncIterator]!=null}function i8(e,t){if(n8(e))return async function*(){for await(let a of e)yield t(a)}();let r=Pd(e),{value:n,done:i}=r.next();if(i===!0)return function*(){}();let o=t(n);if(typeof o.then=="function")return async function*(){yield await o;for await(let a of r)yield t(a)}();let s=t;return function*(){yield o;for(let a of r)yield s(a)}()}var Pa=i8;function or(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}var In=globalThis.CustomEvent??Event;async function*Ra(e,t={}){let r=t.concurrency??1/0;r<1&&(r=1/0);let n=t.ordered==null?!1:t.ordered,i=new EventTarget,o=[],s=or(),a=or(),l=!1,u,c=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let d of e){if(o.length===r&&(s=or(),await s.promise),c)break;let h={done:!1};o.push(h),d().then(y=>{h.done=!0,h.ok=!0,h.value=y,i.dispatchEvent(new In("task-complete"))},y=>{h.done=!0,h.err=y,i.dispatchEvent(new In("task-complete"))})}l=!0,i.dispatchEvent(new In("task-complete"))}catch(d){u=d,i.dispatchEvent(new In("task-complete"))}});function f(){return n?o[0]?.done:!!o.find(d=>d.done)}function*w(){for(;o.length>0&&o[0].done;){let d=o[0];if(o.shift(),d.ok)yield d.value;else throw c=!0,s.resolve(),d.err;s.resolve()}}function*p(){for(;f();)for(let d=0;d<o.length;d++)if(o[d].done){let h=o[d];if(o.splice(d,1),d--,h.ok)yield h.value;else throw c=!0,s.resolve(),h.err;s.resolve()}}for(;;){if(f()||(a=or(),await a.promise),u!=null)throw u;if(n?yield*w():yield*p(),l&&o.length===0)break}}var Uu=class{constructor(e){if(x(this,"buffer"),x(this,"mask"),x(this,"top"),x(this,"btm"),x(this,"next"),!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},ko=class{constructor(e={}){x(this,"size"),x(this,"hwm"),x(this,"head"),x(this,"tail"),this.hwm=e.splitLimit??16,this.head=new Uu(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Uu(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}},o8=class extends Error{constructor(e,t){super(e??"The operation was aborted"),x(this,"type"),x(this,"code"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Ha(e={}){return s8(t=>{let r=t.shift();if(r==null)return{done:!0};if(r.error!=null)throw r.error;return{done:r.done===!0,value:r.value}},e)}function s8(e,t){t=t??{};let r=t.onEnd,n=new ko,i,o,s,a=or(),l=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((y,g)=>{o=m=>{o=null,n.push(m);try{y(e(n))}catch(b){g(b)}return i}}):e(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=or()})}},u=y=>o!=null?o(y):(n.push(y),i),c=y=>(n=new ko,o!=null?o({error:y}):(n.push({error:y}),i)),f=y=>{if(s)return i;if(t?.objectMode!==!0&&y?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return u({done:!1,value:y})},w=y=>s?i:(s=!0,y!=null?c(y):u({done:!0})),p=()=>(n=new ko,w(),{done:!0}),d=y=>(w(y),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:l,return:p,throw:d,push:f,end:w,get readableLength(){return n.size},onEmpty:async y=>{let g=y?.signal;if(g?.throwIfAborted(),n.isEmpty())return;let m,b;g!=null&&(m=new Promise((v,S)=>{b=()=>{S(new o8)},g.addEventListener("abort",b)}));try{await Promise.race([a.promise,m])}finally{b!=null&&g!=null&&g?.removeEventListener("abort",b)}}},r==null)return i;let h=i;return i={[Symbol.asyncIterator](){return this},next(){return h.next()},throw(y){return h.throw(y),r!=null&&(r(y),r=void 0),{done:!0}},return(){return h.return(),r!=null&&(r(),r=void 0),{done:!0}},push:f,end(y){return h.end(y),r!=null&&(r(y),r=void 0),i},get readableLength(){return h.readableLength}},i}function a8(e){return e[Symbol.asyncIterator]!=null}function l8(...e){let t=[];for(let r of e)a8(r)||t.push(r);return t.length===e.length?function*(){for(let r of t)yield*r}():async function*(){let r=Ha({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(e.map(async n=>{for await(let i of n)r.push(i)})),r.end()}catch(n){r.end(n)}}),yield*r}()}var u8=l8;function Va(e,...t){if(e==null)throw new Error("Empty pipeline");if(Eo(e)){let n=e;e=()=>n.source}else if(Hd(e)||Rd(e)){let n=e;e=()=>n}let r=[e,...t];if(r.length>1&&Eo(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)Eo(r[n])&&(r[n]=h8(r[n]));return c8(...r)}var c8=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},Rd=e=>e?.[Symbol.asyncIterator]!=null,Hd=e=>e?.[Symbol.iterator]!=null,Eo=e=>e==null?!1:e.sink!=null&&e.source!=null,h8=e=>t=>{let r=e.sink(t);if(r?.then!=null){let n=Ha({objectMode:!0});r.then(()=>{n.end()},s=>{n.end(s)});let i,o=e.source;if(Rd(o))i=async function*(){yield*o,n.end()};else if(Hd(o))i=function*(){yield*o,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return u8(n,i())}return e.source},f8=(e,t,r,n,i,o,s)=>{async function*a(l={}){let u=l.offset??0,c=l.length??t.Links.length,f=t.Links.slice(u,c);l.onProgress?.(new mt("unixfs:exporter:walk:directory",{cid:e})),yield*Va(f,w=>Pa(w,p=>async()=>{let d=p.Name??"",h=`${n}/${d}`;return(await i(p.Hash,d,h,[],o+1,s,l)).entry}),w=>Ra(w,{ordered:!0}),w=>r8(w,p=>p!=null))}return a},d8=f8,sr=X(Xe(),1),p8=X(jy(),1),Vd=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},y8=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},Du=e=>globalThis.DOMException===void 0?new y8(e):new DOMException(e),Nu=e=>{let t=e.reason===void 0?Du("This operation was aborted."):e.reason;return t instanceof Error?t:Du(t)};function w8(e,t,r,n){let i,o=new Promise((s,a)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t===Number.POSITIVE_INFINITY){s(e);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:l}=n;l.aborted&&a(Nu(l)),l.addEventListener("abort",()=>{a(Nu(l))})}i=n.customTimers.setTimeout.call(void 0,()=>{if(typeof r=="function"){try{s(r())}catch(c){a(c)}return}let l=typeof r=="string"?r:`Promise timed out after ${t} milliseconds`,u=r instanceof Error?r:new Vd(l);typeof e.cancel=="function"&&e.cancel(),a(u)},t),(async()=>{try{s(await e)}catch(l){a(l)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()});return o.clear=()=>{clearTimeout(i),i=void 0},o}function g8(e,t,r){let n=0,i=e.length;for(;i>0;){let o=Math.trunc(i/2),s=n+o;r(e[s],t)<=0?(n=++s,i-=o+1):i=o}return n}var St=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Ge,b8=class{constructor(){Ge.set(this,[])}enqueue(e,t){t={priority:0,...t};let r={priority:t.priority,run:e};if(this.size&&St(this,Ge,"f")[this.size-1].priority>=t.priority){St(this,Ge,"f").push(r);return}let n=g8(St(this,Ge,"f"),r,(i,o)=>o.priority-i.priority);St(this,Ge,"f").splice(n,0,r)}dequeue(){return St(this,Ge,"f").shift()?.run}filter(e){return St(this,Ge,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return St(this,Ge,"f").length}};Ge=new WeakMap;var Z=function(e,t,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r},j=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},re,$r,Pr,ft,wi,Rr,Mn,De,jr,ve,On,ke,Hr,ut,$n,ju,zu,qd,Mu,Ou,Pn,So,xo,gi,Wd,Rn,Gd=class extends Error{},m8=class extends p8.default{constructor(e){var t,r,n,i;if(super(),re.add(this),$r.set(this,void 0),Pr.set(this,void 0),ft.set(this,0),wi.set(this,void 0),Rr.set(this,void 0),Mn.set(this,0),De.set(this,void 0),jr.set(this,void 0),ve.set(this,void 0),On.set(this,void 0),ke.set(this,0),Hr.set(this,void 0),ut.set(this,void 0),$n.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:b8,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(n=e.interval)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);Z(this,$r,e.carryoverConcurrencyCount,"f"),Z(this,Pr,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),Z(this,wi,e.intervalCap,"f"),Z(this,Rr,e.interval,"f"),Z(this,ve,new e.queueClass,"f"),Z(this,On,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,Z(this,$n,e.throwOnTimeout===!0,"f"),Z(this,ut,e.autoStart===!1,"f")}get concurrency(){return j(this,Hr,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);Z(this,Hr,e,"f"),j(this,re,"m",gi).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:j(this,$n,"f"),...t},new Promise((r,n)=>{j(this,ve,"f").enqueue(async()=>{var i,o,s;Z(this,ke,(o=j(this,ke,"f"),o++,o),"f"),Z(this,ft,(s=j(this,ft,"f"),s++,s),"f");try{if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new Gd("The task was aborted.");let a=e({signal:t.signal});t.timeout&&(a=w8(Promise.resolve(a),t.timeout)),t.signal&&(a=Promise.race([a,j(this,re,"m",Wd).call(this,t.signal)]));let l=await a;r(l),this.emit("completed",l)}catch(a){if(a instanceof Vd&&!t.throwOnTimeout){r();return}n(a),this.emit("error",a)}finally{j(this,re,"m",qd).call(this)}},t),this.emit("add"),j(this,re,"m",Pn).call(this)})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return j(this,ut,"f")?(Z(this,ut,!1,"f"),j(this,re,"m",gi).call(this),this):this}pause(){Z(this,ut,!0,"f")}clear(){Z(this,ve,new(j(this,On,"f")),"f")}async onEmpty(){j(this,ve,"f").size!==0&&await j(this,re,"m",Rn).call(this,"empty")}async onSizeLessThan(e){j(this,ve,"f").size<e||await j(this,re,"m",Rn).call(this,"next",()=>j(this,ve,"f").size<e)}async onIdle(){j(this,ke,"f")===0&&j(this,ve,"f").size===0||await j(this,re,"m",Rn).call(this,"idle")}get size(){return j(this,ve,"f").size}sizeBy(e){return j(this,ve,"f").filter(e).length}get pending(){return j(this,ke,"f")}get isPaused(){return j(this,ut,"f")}};$r=new WeakMap,Pr=new WeakMap,ft=new WeakMap,wi=new WeakMap,Rr=new WeakMap,Mn=new WeakMap,De=new WeakMap,jr=new WeakMap,ve=new WeakMap,On=new WeakMap,ke=new WeakMap,Hr=new WeakMap,ut=new WeakMap,$n=new WeakMap,re=new WeakSet,ju=function e(){return j(this,Pr,"f")||j(this,ft,"f")<j(this,wi,"f")},zu=function e(){return j(this,ke,"f")<j(this,Hr,"f")},qd=function e(){var t;Z(this,ke,(t=j(this,ke,"f"),t--,t),"f"),j(this,re,"m",Pn).call(this),this.emit("next")},Mu=function e(){j(this,re,"m",xo).call(this),j(this,re,"m",So).call(this),Z(this,jr,void 0,"f")},Ou=function e(){let t=Date.now();if(j(this,De,"f")===void 0){let r=j(this,Mn,"f")-t;if(r<0)Z(this,ft,j(this,$r,"f")?j(this,ke,"f"):0,"f");else return j(this,jr,"f")===void 0&&Z(this,jr,setTimeout(()=>{j(this,re,"m",Mu).call(this)},r),"f"),!0}return!1},Pn=function e(){if(j(this,ve,"f").size===0)return j(this,De,"f")&&clearInterval(j(this,De,"f")),Z(this,De,void 0,"f"),this.emit("empty"),j(this,ke,"f")===0&&this.emit("idle"),!1;if(!j(this,ut,"f")){let t=!j(this,re,"a",Ou);if(j(this,re,"a",ju)&&j(this,re,"a",zu)){let r=j(this,ve,"f").dequeue();return r?(this.emit("active"),r(),t&&j(this,re,"m",So).call(this),!0):!1}}return!1},So=function e(){j(this,Pr,"f")||j(this,De,"f")!==void 0||(Z(this,De,setInterval(()=>{j(this,re,"m",xo).call(this)},j(this,Rr,"f")),"f"),Z(this,Mn,Date.now()+j(this,Rr,"f"),"f"))},xo=function e(){j(this,ft,"f")===0&&j(this,ke,"f")===0&&j(this,De,"f")&&(clearInterval(j(this,De,"f")),Z(this,De,void 0,"f")),Z(this,ft,j(this,$r,"f")?j(this,ke,"f"):0,"f"),j(this,re,"m",gi).call(this)},gi=function e(){for(;j(this,re,"m",Pn).call(this););},Wd=async function e(t){return new Promise((r,n)=>{t.addEventListener("abort",()=>{n(new Gd("The task was aborted."))},{once:!0})})},Rn=async function e(t,r){return new Promise(n=>{let i=()=>{r&&!r()||(this.off(t,i),n())};this.on(t,i)})};async function Kd(e,t,r,n,i,o,s){if(t instanceof Uint8Array){let u=di(t,n,i,o);r.push(u);return}if(t.Data==null)throw(0,sr.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=Sd.unmarshal(t.Data)}catch(u){throw(0,sr.default)(u,"ERR_NOT_UNIXFS")}if(a.data!=null){let u=a.data,c=di(u,n,i,o);r.push(c),n+=BigInt(c.byteLength)}let l=[];if(t.Links.length!==a.blockSizes.length)throw(0,sr.default)(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let u=0;u<t.Links.length;u++){let c=t.Links[u],f=n,w=f+a.blockSizes[u];if((i>=f&&i<w||o>=f&&o<=w||i<f&&o>w)&&l.push({link:c,blockStart:n}),n=w,n>o)break}await Va(l,u=>Pa(u,c=>async()=>{let f=await e.get(c.link.Hash,s);return{...c,block:f}}),u=>Ra(u,{ordered:!0}),async u=>{for await(let{link:c,block:f,blockStart:w}of u){let p;switch(c.Hash.code){case na:p=un(f);break;case Hs:p=f;break;default:r.end((0,sr.default)(new Error(`Unsupported codec: ${c.Hash.code}`),"ERR_NOT_UNIXFS"));return}let d=new m8({concurrency:1});d.on("error",h=>{r.end(h)}),d.add(async()=>{s.onProgress?.(new mt("unixfs:exporter:walk:file",{cid:c.Hash})),await Kd(e,p,r,w,i,o,s)}),await d.onIdle()}}),n>=o&&r.end()}var v8=(e,t,r,n,i,o,s)=>{async function*a(l={}){let u=r.fileSize();if(u===void 0)throw new Error("File was a directory");let{start:c,end:f}=Na(u,l.offset,l.length);if(f===0n)return;let w=0n,p=f-c,d=Ha();l.onProgress?.(new mt("unixfs:exporter:walk:file",{cid:e})),Kd(s,t,d,0n,c,f,l).catch(h=>{d.end(h)});for await(let h of d)if(h!=null){if(w+=BigInt(h.byteLength),w>p)throw d.end(),(0,sr.default)(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");w===p&&d.end(),l.onProgress?.(new mt("unixfs:exporter:progress:unixfs:file",{bytesRead:w,totalBytes:p,fileSize:u})),yield h}if(w<p)throw(0,sr.default)(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}return a},$u=v8,k8=(e,t,r,n,i,o,s)=>{function a(l={}){return l.onProgress?.(new mt("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),Jd(t,n,i,o,s,l)}return a};async function*Jd(e,t,r,n,i,o){let s=e.Links,a=Va(s,l=>Pa(l,u=>async()=>{let c=u.Name!=null?u.Name.substring(2):null;if(c!=null&&c!==""){let f=await r(u.Hash,c,`${t}/${c}`,[],n+1,i,o);return{entries:f.entry==null?[]:[f.entry]}}else{let f=await i.get(u.Hash,o);return e=un(f),o.onProgress?.(new mt("unixfs:exporter:walk:hamt-sharded-directory",{cid:u.Hash})),{entries:Jd(e,t,r,n,i,o)}}}),l=>Ra(l,{ordered:!0}));for await(let{entries:l}of a)yield*l}var E8=k8,S8=(e,t)=>e.Links.find(r=>r.Name===t)?.Hash,x8={raw:$u,file:$u,directory:d8,"hamt-sharded-directory":E8,metadata:(e,t,r,n,i,o,s)=>()=>[],symlink:(e,t,r,n,i,o,s)=>()=>[]},A8=async(e,t,r,n,i,o,s,a)=>{let l=await s.get(e,a),u=un(l),c,f;if(t==null&&(t=e.toString()),u.Data==null)throw(0,Ln.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{c=Sd.unmarshal(u.Data)}catch(p){throw(0,Ln.default)(p,"ERR_NOT_UNIXFS")}if(r==null&&(r=t),n.length>0){let p;if(c?.type==="hamt-sharded-directory"?p=await Y6(u,n[0],s):p=S8(u,n[0]),p==null)throw(0,Ln.default)(new Error("file does not exist"),"ERR_NOT_FOUND");let d=n.shift(),h=`${r}/${d}`;f={cid:p,toResolve:n,name:d??"",path:h}}let w=x8[c.type](e,u,c,r,i,o,s);if(w==null)throw(0,Ln.default)(new Error("could not find content exporter"),"ERR_NOT_FOUND");return c.isDirectory()?{entry:{type:"directory",name:t,path:r,cid:e,content:w,unixfs:c,depth:o,node:u,size:c.fileSize()},next:f}:{entry:{type:"file",name:t,path:r,cid:e,content:w,unixfs:c,depth:o,node:u,size:c.fileSize()},next:f}},C8=A8,T8={[na]:C8,[Hs]:n6,[Pc]:Gk,[Vk.code]:Xk},Qd=async(e,t,r,n,i,o,s)=>{let a=T8[e.code];if(a==null)throw(0,Pk.default)(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return a(e,t,r,n,Qd,i,o,s)},B8=Qd,F8=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),_8=e=>{if(e instanceof Uint8Array)return{cid:ne.decode(e),toResolve:[]};let t=ne.asCID(e);if(t!=null)return{cid:t,toResolve:[]};if(typeof e=="string"){e.indexOf("/ipfs/")===0&&(e=e.substring(6));let r=F8(e);return{cid:ne.parse(r[0]),toResolve:r.slice(1)}}throw(0,Da.default)(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*L8(e,t,r={}){let{cid:n,toResolve:i}=_8(e),o=n.toString(),s=o,a=i.length;for(;;){let l=await B8(n,o,s,i,a,t,r);if(l.entry==null&&l.next==null)throw(0,Da.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(l.entry!=null&&(yield l.entry),l.next==null)return;i=l.next.toResolve,n=l.next.cid,o=l.next.name,s=l.next.path}}async function I8(e,t,r={}){let n=await $k(L8(e,t,r));if(n==null)throw(0,Da.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return n}var U8=zk(),D8=Aa({fileChunkEncoder:si,smallFileEncoder:si,chunker:Of(1024*1024),fileLayout:Pf(1024)});async function N8(e){let t=z8(e),r=await M8(t);return{cid:r.at(-1).cid,blocks:r}}async function j8(e,t,r){let n=await I8(t.toString(),e,{length:r.size}),i=[];for await(let o of n.content())i.push(o);return new File(i,n.name,{type:r.type,lastModified:0})}function z8(e){let{readable:t,writable:r}=new TransformStream({},U8),n=Ik({writable:r,settings:D8}),i=new O8("",e);return(async()=>(await i.finalize(n),await n.close()))(),t}async function M8(e){let t=[];return await e.pipeTo(new WritableStream({write(r){t.push(r)}})),t}var Hn,O8=class{constructor(e,t){ar(this,Hn,void 0),x(this,"name"),this.name=e,Me(this,Hn,t)}async finalize(e){let t=Hf(e);return await be(this,Hn).stream().pipeTo(new WritableStream({async write(r){await t.write(r)}})),await t.close()}};Hn=new WeakMap;async function $8(e,t,r,n){let i;for(let o of r){let s=await P8(e,o);i=await o2(e,t,o.key,s,n);let a=i.root.toString();if(!i.additions.some(l=>l.cid.toString()===a)&&!await e.get(i.root))throw new Error(`missing root in additions: ${i.additions.length} ${a} keys: ${r.map(l=>l.key).toString()}`);for(let{cid:l,bytes:u}of[...i.additions,...i.removals,i.event])e.putSync(l,u);t=i.head}return{head:t}}async function P8(e,t){let r;t.del?r={del:!0}:(await R8(e,t.value),r={doc:t.value});let n=await cr({value:r,hasher:Le,codec:he});return e.putSync(n.cid,n.bytes),n.cid}async function R8(e,t){t._files&&await Pu(e,t._files),t._publicFiles&&await Pu(e,t._publicFiles,!0)}async function Pu(e,t,r=!1){let n=e.parent,i=new Ga(n),o=[];for(let s in t)if(File===t[s].constructor){let a=t[s],{cid:l,blocks:u}=await N8(a);o.push(s);for(let c of u)i.putSync(c.cid,c.bytes);t[s]={cid:l,type:a.type,size:a.size}}if(o.length){let s=await n.loader?.commit(i,{files:t},{public:r});if(s)for(let a of o)t[a]={car:s,...t[a]}}}async function H8(e,t,r){if(!t.length)throw new Error("Getting from an empty database");let n=await s2(e,t,r);if(!n)throw new Error(`Missing key ${r}`);return await qa(e,n)}function Zd(e,{doc:t}){t&&(t._files&&Ru(e,t._files),t._publicFiles&&Ru(e,t._publicFiles,!0))}function Ru(e,t,r=!1){for(let n in t){let i=t[n];if(i.cid&&(r&&(i.url=`https://${i.cid.toString()}.ipfs.w3s.link/`),i.car&&e.loader)){let o=e.loader;i.file=async()=>await j8({get:async s=>{let a=await(await o.loadFileCar(i.car,r)).get(s);if(!a)throw new Error(`Missing block ${s.toString()}`);return a.bytes}},i.cid,i)}t[n]=i}}async function qa(e,t){let r=await e.get(t);if(!r)throw new Error(`Missing linked block ${t.toString()}`);let{value:n}=await Ct({bytes:r.bytes,hasher:Le,codec:he});return Zd(e,n),n}var V8=class extends Sr{async get(e){try{return await super.get(e)}catch(t){return console.error("missing event",e.toString(),t),{value:null}}}};async function Wa(e,t,r,n){let i=n.dirty?new V8(e):new Sr(e);return{result:(await rs(e,i,t,r,[],new Set,new Set,n.limit||1/0)).reverse(),head:t}}async function rs(e,t,r,n,i=[],o,s,a){if(a<=0)return i;let l=r.map(u=>u.toString());for(let u of n)if(l.includes(u.toString()))return i;for(let u of r){if(s.has(u.toString()))continue;s.add(u.toString());let{value:c}=await t.get(u);if(!c)continue;let{key:f,value:w}=c.data;if(o.has(f))c.parents&&(i=await rs(e,t,c.parents,n,i,o,s,a));else{o.add(f);let p=await qa(e,w);i.push({key:f,value:p.doc,del:p.del,clock:u}),a--,c.parents&&(i=await rs(e,t,c.parents,n,i,o,s,a))}}return i}async function*Yd(e,t){for await(let[r,n]of Yh(e,t)){let i=await qa(e,n);yield{key:r,value:i.doc,del:i.del}}}async function*q8(e,t){for await(let r of Jh(e,t))yield r}var Ao=!1;async function W8(e,t){if(Ao)return;Ao=!0;let r=new X8(e);for(let o of t)if(!await r.get(o))throw new Error("Missing head block: "+o.toString());for await(let o of Yd(r,t));for await(let[,o]of Yh(r,t))if(!await r.get(o))throw new Error("Missing entry block: "+o.toString());for await(let o of Jh(r,t));let n=await qi(r,t);for(let{cid:o,bytes:s}of[...n.additions,...n.removals])r.loggedBlocks.putSync(o,s);await Wa(r,t,[],{});let i=await e.commitCompaction(r.loggedBlocks,t);return Ao=!1,i}async function G8({bytes:e}){let t=Uint8Array.from(atob(e),i=>i.charCodeAt(0)),{cid:r,value:n}=await Ct({bytes:t,codec:he,hasher:Le});return new an({cid:r,value:n,bytes:t})}async function K8(e,t){let r=await e.get(qm(t));if(!r)throw new Error(`Missing block ${t}`);let{cid:n,value:i}=await Ct({bytes:r.bytes,codec:he,hasher:Le});return new an({cid:n,value:i,bytes:r.bytes})}var Xd=class ep extends Ys{constructor(t,r,n){super(t,n),x(this,"crdt"),x(this,"defaultHeader",ep.defaultHeader),this.crdt=r}async _applyCarHeader(t){for(let[r,n]of Object.entries(t.indexes))Wo({_crdt:this.crdt},r,void 0,n)}makeCarHeader({indexes:t},r,n=!1){return n?{indexes:t,cars:[],compact:r}:{indexes:t,cars:r,compact:[]}}};x(Xd,"defaultHeader",{cars:[],compact:[],indexes:new Map});var J8=Xd,tp=class rp extends Ys{constructor(t,r,n){super(t,n),x(this,"defaultHeader",rp.defaultHeader),x(this,"clock"),x(this,"awaitingCompact",!1),x(this,"compacting",Promise.resolve()),x(this,"writing",Promise.resolve()),x(this,"remoteFileStore"),x(this,"fileStore"),this.fileStore=new Dh(this.name),this.clock=r}async _readyForMerge(){await this.compacting}async _setWaitForWrite(t){let r=this.writing;return this.writing=r.then(async()=>(await t(),r)),this.writing.then(()=>{})}async compact(t){if(await this.ready,this.carLog.length<2||this.awaitingCompact)return;this.awaitingCompact=!0;let r=async()=>{if(this.isCompacting||this.isWriting)return;this.isCompacting=!0;let n=this.clock.head,i=await W8(t,this.clock.head);return await this.clock.applyHead(n,n,null),i};this.compacting=this._setWaitForWrite(r),this.compacting.finally(()=>{this.isCompacting=!1,this.awaitingCompact=!1}),await this.compacting}async loadFileCar(t,r=!1){return await this.storesLoadCar(t,this.fileStore,this.remoteFileStore,r)}async _applyCarHeader(t,r=!1){r?await this.clock.applyHead(t.head,this.clock.head):await this.clock.applyHead(t.head,[])}makeCarHeader(t,r,n=!1){if(np(t)){let i=[];for(let[,o]of Object.entries(t.files))i.push(o.cid);return{files:i}}else{let{head:i}=t;return n?{head:i,cars:[],compact:r}:{head:i,cars:r,compact:[]}}}};x(tp,"defaultHeader",{cars:[],compact:[],head:[]});var Q8=tp;function np(e){return e&&e.files!==void 0}var Ga=class extends Bt{constructor(e){super(),x(this,"parent"),e.transactions.add(this),this.parent=e}async get(e){return this.parent.get(e)}async superGet(e){return super.get(e)}},ip=class{constructor(e,t,r){if(x(this,"ready"),x(this,"name",null),x(this,"loader",null),x(this,"opts",{}),x(this,"transactions",new Set),this.opts=r||this.opts,e){if(this.name=e,!t)throw new Error("missing loader");this.loader=t,this.ready=this.loader.ready}else this.ready=Promise.resolve()}async put(){throw new Error("use a transaction to put")}async get(e){if(!e)throw new Error("required cid");for(let t of this.transactions){let r=await t.superGet(e);if(r)return r}if(this.loader)return await this.loader.getBlock(e)}async commitCompaction(e,t){return await this.loader.commit(e,{head:t},{compact:!0,noLoader:!0})}async*entries(){let e=new Set;for(let t of this.transactions)for await(let r of t.entries())e.has(r.cid.toString())||(e.add(r.cid.toString()),yield r)}async executeTransaction(e,t){let r=new Ga(this),n=await e(r),{car:i,done:o}=await t(r,n);return i?{...o,car:i}:o}},Z8=class extends ip{constructor(e,t,r){e?super(e,new J8(e,t,r),r):super(null)}async transaction(e,t){return this.executeTransaction(e,async(r,n)=>(t.set(n.name,n),{car:await this.loader?.commit(r,{indexes:t}),done:n}))}},Y8=class extends ip{constructor(e,t,r){e?super(e,new Q8(e,t,r),r):super(null)}async transaction(e,t,r={noLoader:!1}){return this.executeTransaction(e,async(n,i)=>({car:await this.loader?.commit(n,i,r),done:i}))}},X8=class{constructor(e){x(this,"blocks"),x(this,"loader",null),x(this,"loggedBlocks"),this.blocks=e,this.loader=e.loader,this.loggedBlocks=new Ga(e)}async get(e){let t=await this.blocks.get(e);return t&&this.loggedBlocks.putSync(e,t.bytes),t}};function e5(e){let t=[],r=!1;async function*n(){if(r||t.length===0)return;r=!0;let i=[];try{for(;t.length>0;){t.sort((s,a)=>a.updates?1:-1);let o=t.shift();if(o&&(await e(o.newHead,o.prevHead),o.updates&&i.push(...o.updates),!t.some(s=>s.updates)||o.updates)){let s=t.every(a=>a.updates!==null);yield{updates:i,all:s},i.length=0}}}finally{r=!1;let o=n(),s=await o.next();for(;!s.done;)s=await o.next()}}return{push(i){return t.push(i),n()}}}var t5=class{constructor(){x(this,"head",[]),x(this,"zoomers",new Set),x(this,"watchers",new Set),x(this,"emptyWatchers",new Set),x(this,"blocks",null),x(this,"applyHeadQueue"),this.applyHeadQueue=e5(this.int_applyHead.bind(this))}setHead(e){this.head=e}async applyHead(e,t,r=null){for await(let{updates:n,all:i}of this.applyHeadQueue.push({newHead:e,prevHead:t,updates:r}))this.processUpdates(n,i,t)}async processUpdates(e,t,r){let n=e;this.watchers.size&&!t&&(n=(await Wa(this.blocks,this.head,r,{})).result),this.zoomers.forEach(i=>i()),this.notifyWatchers(n||[])}notifyWatchers(e){this.emptyWatchers.forEach(t=>t()),this.watchers.forEach(t=>t(e||[]))}onTick(e){this.watchers.add(e)}onTock(e){this.emptyWatchers.add(e)}onZoom(e){this.zoomers.add(e)}async int_applyHead(e,t){let r=Co(this.head);if(e=Co(e),await r5(e,this.blocks),Hu(r,e))return;let n=Co(t);if(Hu(r,n)){this.setHead(e);return}let i=this.head,o=!1;if(!this.blocks)throw new Error("missing blocks");await this.blocks.transaction(async s=>{i=await n5(e,s,i);let a=await qi(s,i);for(let{cid:l,bytes:u}of[...a.additions,...a.removals])s.putSync(l,u);return{head:i}},void 0,{noLoader:o}),this.setHead(i)}};function Co(e){return e.sort((t,r)=>t.toString().localeCompare(r.toString()))}async function r5(e,t){e.map(async r=>{if(!await t.get(r))throw new Error("int_applyHead missing block: "+r.toString())})}function Hu(e,t){return e.toString()===t.toString()}async function n5(e,t,r){for(let n of e)try{r=await Jo(t,r,n)}catch(i){console.error("failed to advance",n.toString(),i);continue}return r}var i5=class{constructor(e,t){x(this,"name"),x(this,"opts",{}),x(this,"ready"),x(this,"blocks"),x(this,"indexBlocks"),x(this,"indexers",new Map),x(this,"clock",new t5),this.name=e||null,this.opts=t||this.opts,this.blocks=new Y8(this.name,this.clock,this.opts),this.clock.blocks=this.blocks,this.indexBlocks=new Z8(this.opts.persistIndexes&&this.name?this.name+".idx":null,this,this.opts),this.ready=Promise.all([this.blocks.ready,this.indexBlocks.ready]).then(()=>{}),this.clock.onZoom(()=>{for(let r of this.indexers.values())r._resetIndex()}),this.clock.onTock(async()=>{this.blocks.loader&&this.blocks.loader.carLog.length<100||await this.compact()})}async bulk(e,t){await this.ready;let r=this.blocks.loader,n=[...this.clock.head],i=(async()=>{if(await r?.compacting,r?.isCompacting)throw new Error("cant bulk while compacting");let o=await this.blocks.transaction(async s=>{let{head:a}=await $8(s,this.clock.head,e,t);return e=e.map(({key:l,value:u,del:c,clock:f})=>(Zd(this.blocks,{doc:u}),{key:l,value:u,del:c,clock:f})),r?.awaitingCompact&&console.log("missing?",a.toString()),r?.isCompacting&&console.log("compacting?",a.toString()),{head:a}});return await this.clock.applyHead(o.head,n,e),o})();if(r){let o=r.writing;r.writing=o.then(async()=>(r.isWriting=!0,await i,r.isWriting=!1,o))}return await i}async allDocs(){await this.ready;let e=[];for await(let t of Yd(this.blocks,this.clock.head))e.push(t);return{result:e,head:this.clock.head}}async vis(){await this.ready;let e=[];for await(let t of q8(this.blocks,this.clock.head))e.push(t);return e.join(`
`)}async getBlock(e){return await this.ready,await K8(this.blocks,e)}async getThatBlock(){return await G8({cid:"bafyreib7ee4pscqpuioxobmh3ac5xbbslypmaqqbkugalhw67hnco6dvoa",bytes:"omRkYXRhpGNrZXl4JDAxOGFmNzdiLWZmMTUtNzI5Ny04ODZiLTYwMjViM2MxODI2ZWRyb2902CpYJQABcRIgKVLI53HO1TFDbPUoSaybd0mop2oX/CRFm1RrpiY4ne9kdHlwZWNwdXRldmFsdWXYKlglAAFxEiAGw53MVtPzeeGT/itfdLBfCVu6MTj96AHU6v9a3K/wYGdwYXJlbnRzgdgqWCUAAXESIJiL5qjdpgghUfbQLpKJeCgMX+ubhoTpYBoZHYdzbQJ/"})}async get(e){await this.ready;let t=await H8(this.blocks,this.clock.head,e);return t.del?null:t}async changes(e=[],t={}){return await this.ready,await Wa(this.blocks,this.clock.head,e,t)}async compact(){await this.ready,this.blocks.loader&&await this.blocks.loader.compact(this.blocks)}},zr=class{constructor(e,t){x(this,"name"),x(this,"opts",{}),x(this,"_listening",!1),x(this,"_listeners",new Set),x(this,"_noupdate_listeners",new Set),x(this,"_crdt"),x(this,"_writeQueue"),this.name=e||null,this.opts=t||this.opts,this._crdt=new i5(e,this.opts),this._writeQueue=Ry(async r=>await this._crdt.bulk(r)),this._crdt.clock.onTock(()=>{this._no_update_notify()})}async get(e){let t=await this._crdt.get(e).catch(n=>{throw n.message=`Not found: ${e} - `+n.message,n});if(!t)throw new Error(`Not found: ${e}`);let{doc:r}=t;return{_id:e,...r}}async put(e){let{_id:t,...r}=e,n=t||$y(),i=await this._writeQueue.push({key:n,value:r});return{id:n,clock:i?.head}}async del(e){let t=await this._writeQueue.push({key:e,del:!0});return{id:e,clock:t?.head}}async changes(e=[],t={}){let{result:r,head:n}=await this._crdt.changes(e,t);return{rows:r.map(({key:i,value:o,del:s,clock:a})=>({key:i,value:s?{_id:i,_deleted:!0}:{_id:i,...o},clock:a})),clock:n}}async allDocs(){let{result:e,head:t}=await this._crdt.allDocs();return{rows:e.map(({key:r,value:n,del:i})=>({key:r,value:i?{_id:r,_deleted:!0}:{_id:r,...n}})),clock:t}}async allDocuments(){return this.allDocs()}subscribe(e,t){return t?(this._listening||(this._listening=!0,this._crdt.clock.onTick(r=>{this._notify(r)})),this._listeners.add(e),()=>{this._listeners.delete(e)}):(this._noupdate_listeners.add(e),()=>{this._noupdate_listeners.delete(e)})}async query(e,t={}){return await(typeof e=="string"?Wo({_crdt:this._crdt},e):Wo({_crdt:this._crdt},o5(e.toString()),e)).query(t)}async compact(){await this._crdt.compact()}async getDashboardURL(e=!0){let t="https://dashboard.fireproof.storage/";if(!this._crdt.blocks.loader?.remoteCarStore)return new URL("/howto",t);e&&await this.compact();let r=await this._crdt.blocks.loader?.metaStore?.load();if(!r)throw new Error("Can't sync empty database: save data first");if(r.length>1)throw new Error("Can't sync database with split heads: make an update first");let n=r[0],i={car:n.car.toString()};n.key&&(i.key=n.key.toString()),this.name&&(i.name=this.name);let o=new URL("/import#"+new URLSearchParams(i).toString(),t);return console.log("Import to dashboard: "+o.toString()),o}openDashboard(){this.getDashboardURL().then(e=>{e&&window.open(e.toString(),"_blank")})}async _notify(e){if(this._listeners.size){let t=e.map(({key:r,value:n})=>({_id:r,...n}));for(let r of this._listeners)await(async()=>await r(t))().catch(n=>{console.error("subscriber error",n)})}}async _no_update_notify(){if(this._noupdate_listeners.size)for(let e of this._noupdate_listeners)await(async()=>await e([]))().catch(t=>{console.error("subscriber error",t)})}};x(zr,"databases",new Map);function W4(e,t){return zr.databases.has(e)||zr.databases.set(e,new zr(e,t)),zr.databases.get(e)}function o5(e){let t=/\(([^,()]+,\s*[^,()]+|\[[^\]]+\],\s*[^,()]+)\)/g,r=null;return Array.from(e.matchAll(t),n=>n[1].trim()).length===0&&(r=/=>\s*(.*)/.exec(e)),r?r[1]:e}var Vu=class extends Ih{constructor(e,t,r="data"){super(e),Ee(this,"tag","remote-data"),Ee(this,"connection"),Ee(this,"type"),this.connection=t,this.type=r}prefix(){return`fp.${this.name}`}async load(e){let t=await this.connection.dataDownload({type:this.type,name:this.prefix(),car:e.toString()});if(!t)throw new Error(`missing remote car ${e.toString()}`);return{cid:e,bytes:t}}async save(e,t){let r={type:this.type,name:this.prefix(),car:e.cid.toString(),size:e.bytes.length.toString()};return await this.connection.dataUpload(e.bytes,r,t)}async remove(e){throw new Error("not implemented")}},s5=class extends Lh{constructor(e,t){super(e),Ee(this,"tag","remote-meta"),Ee(this,"connection"),Ee(this,"subscribers",new Map),this.connection=t}onLoad(e,t){let r=this.subscribers.get(e)||[];return r.push(t),this.subscribers.set(e,r),()=>{let n=this.subscribers.get(e)||[],i=n.indexOf(t);i>-1&&n.splice(i,1)}}prefix(){return`fp.${this.name}.${this.STORAGE_VERSION}`}async handleByteHeads(e,t="main"){let r=this.dbMetasForByteHeads(e),n=this.subscribers.get(t)||[];for(let i of n)await i(r);return r}async load(e="main"){let t=await this.connection.metaDownload({name:this.prefix(),branch:e});return t?this.handleByteHeads(t,e):null}async save(e,t="main"){let r=new TextEncoder().encode(this.makeHeader(e)),n=await this.connection.metaUpload(r,{name:this.prefix(),branch:t});return n?this.handleByteHeads(n,t):null}dbMetasForByteHeads(e){return e.map(t=>{let r=new TextDecoder().decode(t);return this.parseHeader(r)})}},a5=op,qu=128,l5=127,u5=~l5,c5=Math.pow(2,31);function op(e,t,r){t=t||[],r=r||0;for(var n=r;e>=c5;)t[r++]=e&255|qu,e/=128;for(;e&u5;)t[r++]=e&255|qu,e>>>=7;return t[r]=e|0,op.bytes=r-n+1,t}var h5=ns,f5=128,Wu=127;function ns(e,n){var r=0,n=n||0,i=0,o=n,s,a=e.length;do{if(o>=a)throw ns.bytes=0,new RangeError("Could not decode varint");s=e[o++],r+=i<28?(s&Wu)<<i:(s&Wu)*Math.pow(2,i),i+=7}while(s>=f5);return ns.bytes=o-n,r}var d5=Math.pow(2,7),p5=Math.pow(2,14),y5=Math.pow(2,21),w5=Math.pow(2,28),g5=Math.pow(2,35),b5=Math.pow(2,42),m5=Math.pow(2,49),v5=Math.pow(2,56),k5=Math.pow(2,63),E5=function(e){return e<d5?1:e<p5?2:e<y5?3:e<w5?4:e<g5?5:e<b5?6:e<m5?7:e<v5?8:e<k5?9:10},S5={encode:a5,decode:h5,encodingLength:E5},x5=S5,bi=x5,is=(e,t=0)=>[bi.decode(e,t),bi.decode.bytes],mi=(e,t,r=0)=>(bi.encode(e,t,r),t),vi=e=>bi.encodingLength(e),G4=new Uint8Array(0),A5=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},Ka=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},os=(e,t)=>{let r=t.byteLength,n=vi(e),i=n+vi(r),o=new Uint8Array(i+r);return mi(e,o,0),mi(r,o,n),o.set(t,i),new Ja(e,r,t,o)},C5=e=>{let t=Ka(e),[r,n]=is(t),[i,o]=is(t.subarray(n)),s=t.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Ja(r,i,s,t)},T5=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&A5(e.bytes,r.bytes)}},Ja=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}};function B5(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(r[s]!==255)throw new TypeError(o+" is ambiguous");r[s]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var h=0,y=0,g=0,m=d.length;g!==m&&d[g]===0;)g++,h++;for(var b=(m-g)*c+1>>>0,v=new Uint8Array(b);g!==m;){for(var S=d[g],T=0,B=b-1;(S!==0||T<y)&&B!==-1;B--,T++)S+=256*v[B]>>>0,v[B]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");y=T,g++}for(var N=b-y;N!==b&&v[N]===0;)N++;for(var L=l.repeat(h);N<b;++N)L+=e.charAt(v[N]);return L}function w(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var h=0;if(d[h]!==" "){for(var y=0,g=0;d[h]===l;)y++,h++;for(var m=(d.length-h)*u+1>>>0,b=new Uint8Array(m);d[h];){var v=r[d.charCodeAt(h)];if(v===255)return;for(var S=0,T=m-1;(v!==0||S<g)&&T!==-1;T--,S++)v+=a*b[T]>>>0,b[T]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=S,h++}if(d[h]!==" "){for(var B=m-g;B!==m&&b[B]===0;)B++;for(var N=new Uint8Array(y+(m-B)),L=y;B!==m;)N[L++]=b[B++];return N}}}function p(d){var h=w(d);if(h)return h;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:w,decode:p}}var F5=B5,_5=F5,L5=_5,I5=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},U5=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sp(this,e)}},D5=class{constructor(e){this.decoders=e}or(e){return sp(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},sp=(e,t)=>new D5({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),N5=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new I5(e,t,r),this.decoder=new U5(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},ap=({name:e,prefix:t,encode:r,decode:n})=>new N5(e,t,r,n),lp=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=L5(r,t);return ap({prefix:e,name:t,encode:n,decode:o=>Ka(i(o))})},j5=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),a=0,l=0,u=0;for(let c=0;c<o;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<r|f,a+=r,a>=8&&(a-=8,s[u++]=255&l>>a)}if(a>=r||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s},z5=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>r;)s-=r,o+=t[i&a>>s];if(s&&(o+=t[i&a<<r-s]),n)for(;o.length*r&7;)o+="=";return o},tt=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>ap({prefix:t,name:e,encode(i){return z5(i,n,r)},decode(i){return j5(i,n,r,e)}}),ct=lp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),K4=lp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Vn=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),J4=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q4=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Z4=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Y4=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),X4=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),eS=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),tS=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rS=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Gu=(e,t)=>{let{bytes:r,version:n}=e;switch(n){case 0:return O5(r,ss(e),t||ct.encoder);default:return $5(r,ss(e),t||Vn.encoder)}},Ku=new WeakMap,ss=e=>{let t=Ku.get(e);if(t==null){let r=new Map;return Ku.set(e,r),r}return t},Ye=class we{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Ir)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==P5)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return we.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=os(t,r);return we.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return we.equals(this,t)}static equals(t,r){let n=r;return n&&t.code===n.code&&t.version===n.version&&T5(t.multihash,n.multihash)}toString(t){return Gu(this,t)}toJSON(){return{"/":Gu(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof we)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:o,bytes:s}=r;return new we(n,i,o,s||Ju(n,i,o.bytes))}else if(r[R5]===!0){let{version:n,multihash:i,code:o}=r,s=C5(i);return we.create(n,o,s)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Ir)throw new Error(`Version 0 CID must use dag-pb (code: ${Ir}) block encoding`);return new we(t,r,n,n.bytes)}case 1:{let i=Ju(t,r,n.bytes);return new we(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return we.create(0,Ir,t)}static createV1(t,r){return we.create(1,t,r)}static decode(t){let[r,n]=we.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=we.inspectBytes(t),n=r.size-r.multihashSize,i=Ka(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let o=i.subarray(r.multihashSize-r.digestSize),s=new Ja(r.multihashCode,r.digestSize,o,i);return[r.version===0?we.createV0(s):we.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,w]=is(t.subarray(r));return r+=w,f},i=n(),o=Ir;if(i===18?(i=0,r=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=r,a=n(),l=n(),u=r+l,c=u-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:u}}static parse(t,r){let[n,i]=M5(t,r),o=we.decode(i);if(o.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ss(o).set(n,t),o}},M5=(e,t)=>{switch(e[0]){case"Q":{let r=t||ct;return[ct.prefix,r.decode(`${ct.prefix}${e}`)]}case ct.prefix:{let r=t||ct;return[ct.prefix,r.decode(e)]}case Vn.prefix:{let r=t||Vn;return[Vn.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}},O5=(e,t,r)=>{let{prefix:n}=r;if(n!==ct.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let o=r.encode(e).slice(1);return t.set(n,o),o}else return i},$5=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let o=r.encode(e);return t.set(n,o),o}else return i},Ir=112,P5=18,Ju=(e,t,r)=>{let n=vi(e),i=n+vi(t),o=new Uint8Array(i+r.byteLength);return mi(e,o,0),mi(t,o,n),o.set(r,i),o},R5=Symbol.for("@ipld/js-cid/CID"),up=({name:e,code:t,encode:r})=>new H5(e,t,r),H5=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?os(this.code,t):t.then(r=>os(this.code,r))}else throw Error("Unknown type, must be binary type")}};function Un({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*V5(e,t){if(t!=null&&typeof t=="object")if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r],o=Ye.asCID(n);o?yield[i.join("/"),o]:typeof n=="object"&&(yield*as(n,i))}else{let r=Ye.asCID(t);r?yield[e.join("/"),r]:yield*as(t,e)}}function*as(e,t){if(e==null||e instanceof Uint8Array)return;let r=Ye.asCID(e);r&&(yield[t.join("/"),r]);for(let[n,i]of Object.entries(e)){let o=[...t,n];yield*V5(o,i)}}function*q5(e,t){if(Array.isArray(t))for(let[r,n]of t.entries()){let i=[...e,r];yield i.join("/"),typeof n=="object"&&!Ye.asCID(n)&&(yield*ls(n,i))}else yield*ls(t,e)}function*ls(e,t){if(!(e==null||typeof e!="object"))for(let[r,n]of Object.entries(e)){let i=[...t,r];yield i.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!Ye.asCID(n)&&(yield*q5(i,n))}}function W5(e,t){let r=e;for(let[n,i]of t.entries()){if(r=r[i],r==null)throw new Error(`Object has no property at ${t.slice(0,n+1).map(s=>`[${JSON.stringify(s)}]`).join("")}`);let o=Ye.asCID(r);if(o)return{value:o,remaining:t.slice(n+1).join("/")}}return{value:r}}var yn=class{constructor({cid:e,bytes:t,value:r}){if(!e||!t||typeof r>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:Un(),bytes:Un(),value:Un(),asBlock:Un()})}links(){return as(this.value,[])}tree(){return ls(this.value,[])}get(e="/"){return W5(this.value,e.split("/").filter(Boolean))}};async function G5({value:e,codec:t,hasher:r}){if(typeof e>"u")throw new Error('Missing required argument "value"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.encode(e),i=await r.digest(n),o=Ye.create(1,t.code,i);return new yn({value:e,bytes:n,cid:o})}async function K5({bytes:e,codec:t,hasher:r}){if(!e)throw new Error('Missing required argument "bytes"');if(!t||!r)throw new Error("Missing required argument: codec or hasher");let n=t.decode(e),i=await r.digest(e),o=Ye.create(1,t.code,i);return new yn({value:n,bytes:e,cid:o})}var cp=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),hp=up({name:"sha2-256",code:18,encode:cp("SHA-256")}),nS=up({name:"sha2-512",code:19,encode:cp("SHA-512")}),Qa={};ny(Qa,{code:()=>n4,decode:()=>o4,encode:()=>i4,name:()=>r4});var J5=["string","number","bigint","symbol"],Q5=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Z5(e){if(e===null)return"null";if(e===void 0)return"undefined";if(e===!0||e===!1)return"boolean";let t=typeof e;return J5.includes(t)?t:t==="function"?"Function":Array.isArray(e)?"Array":Y5(e)?"Buffer":X5(e)||"Object"}function Y5(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function X5(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(Q5.includes(t))return t}var C=class{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};C.uint=new C(0,"uint",!0);C.negint=new C(1,"negint",!0);C.bytes=new C(2,"bytes",!0);C.string=new C(3,"string",!0);C.array=new C(4,"array",!1);C.map=new C(5,"map",!1);C.tag=new C(6,"tag",!1);C.float=new C(7,"float",!0);C.false=new C(7,"false",!0);C.true=new C(7,"true",!0);C.null=new C(7,"null",!0);C.undefined=new C(7,"undefined",!0);C.break=new C(7,"break",!0);var M=class{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},xr=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",eE=new TextDecoder,tE=new TextEncoder;function ki(e){return xr&&globalThis.Buffer.isBuffer(e)}function fp(e){return e instanceof Uint8Array?ki(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}var rE=xr?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):Zu(e,t,r):(e,t,r)=>r-t>64?eE.decode(e.subarray(t,r)):Zu(e,t,r),nE=xr?e=>e.length>64?globalThis.Buffer.from(e):Qu(e):e=>e.length>64?tE.encode(e):Qu(e),Ve=e=>Uint8Array.from(e),Za=xr?(e,t,r)=>ki(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),iE=xr?(e,t)=>(e=e.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),fp(globalThis.Buffer.concat(e,t))):(e,t)=>{let r=new Uint8Array(t),n=0;for(let i of e)n+i.length>r.length&&(i=i.subarray(0,r.length-n)),r.set(i,n),n+=i.length;return r},oE=xr?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function sE(e,t){if(ki(e)&&ki(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}function Qu(e,t=1/0){let r,n=e.length,i=null,o=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return o}function Zu(e,t,r){let n=[];for(;t<r;){let i=e[t],o=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=r){let a,l,u,c;switch(s){case 1:i<128&&(o=i);break;case 2:a=e[t+1],(a&192)===128&&(c=(i&31)<<6|a&63,c>127&&(o=c));break;case 3:a=e[t+1],l=e[t+2],(a&192)===128&&(l&192)===128&&(c=(i&15)<<12|(a&63)<<6|l&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:a=e[t+1],l=e[t+2],u=e[t+3],(a&192)===128&&(l&192)===128&&(u&192)===128&&(c=(i&15)<<18|(a&63)<<12|(l&63)<<6|u&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),t+=s}return aE(n)}var Yu=4096;function aE(e){let t=e.length;if(t<=Yu)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Yu));return r}var lE=256,dp=class{constructor(e=lE){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){let r=t.length-(this.maxCursor-this.cursor)-1;r<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,r),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=oE(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Za(r,0,this.cursor)}else t=iE(this.chunks,this.cursor);return e&&this.reset(),t}},H="CBOR decode error:",pp="CBOR encode error:",wn=[];wn[23]=1;wn[24]=2;wn[25]=3;wn[26]=5;wn[27]=9;function Ar(e,t,r){if(e.length-t<r)throw new Error(`${H} not enough data for type`)}var ue=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Pt(e,t,r){Ar(e,t,1);let n=e[t];if(r.strict===!0&&n<ue[0])throw new Error(`${H} integer encoded in more bytes than necessary (strict decode)`);return n}function Rt(e,t,r){Ar(e,t,2);let n=e[t]<<8|e[t+1];if(r.strict===!0&&n<ue[1])throw new Error(`${H} integer encoded in more bytes than necessary (strict decode)`);return n}function Ht(e,t,r){Ar(e,t,4);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(r.strict===!0&&n<ue[2])throw new Error(`${H} integer encoded in more bytes than necessary (strict decode)`);return n}function Vt(e,t,r){Ar(e,t,8);let n=e[t]*16777216+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=e[t+4]*16777216+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],o=(BigInt(n)<<BigInt(32))+BigInt(i);if(r.strict===!0&&o<ue[3])throw new Error(`${H} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(r.allowBigInt===!0)return o;throw new Error(`${H} integers outside of the safe integer range are not supported`)}function uE(e,t,r,n){return new M(C.uint,Pt(e,t+1,n),2)}function cE(e,t,r,n){return new M(C.uint,Rt(e,t+1,n),3)}function hE(e,t,r,n){return new M(C.uint,Ht(e,t+1,n),5)}function fE(e,t,r,n){return new M(C.uint,Vt(e,t+1,n),9)}function qt(e,t){return Ie(e,0,t.value)}function Ie(e,t,r){if(r<ue[0]){let n=Number(r);e.push([t|n])}else if(r<ue[1]){let n=Number(r);e.push([t|24,n])}else if(r<ue[2]){let n=Number(r);e.push([t|25,n>>>8,n&255])}else if(r<ue[3]){let n=Number(r);e.push([t|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<ue[4]){let i=[t|27,0,0,0,0,0,0,0],o=Number(n&BigInt(4294967295)),s=Number(n>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=s&255,s=s>>8,i[3]=s&255,s=s>>8,i[2]=s&255,s=s>>8,i[1]=s&255,e.push(i)}else throw new Error(`${H} encountered BigInt larger than allowable range`)}}qt.encodedSize=function(e){return Ie.encodedSize(e.value)};Ie.encodedSize=function(e){return e<ue[0]?1:e<ue[1]?2:e<ue[2]?3:e<ue[3]?5:9};qt.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function dE(e,t,r,n){return new M(C.negint,-1-Pt(e,t+1,n),2)}function pE(e,t,r,n){return new M(C.negint,-1-Rt(e,t+1,n),3)}function yE(e,t,r,n){return new M(C.negint,-1-Ht(e,t+1,n),5)}var Ya=BigInt(-1),yp=BigInt(1);function wE(e,t,r,n){let i=Vt(e,t+1,n);if(typeof i!="bigint"){let o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new M(C.negint,o,9)}if(n.allowBigInt!==!0)throw new Error(`${H} integers outside of the safe integer range are not supported`);return new M(C.negint,Ya-BigInt(i),9)}function Xa(e,t){let r=t.value,n=typeof r=="bigint"?r*Ya-yp:r*-1-1;Ie(e,t.type.majorEncoded,n)}Xa.encodedSize=function(e){let t=e.value,r=typeof t=="bigint"?t*Ya-yp:t*-1-1;return r<ue[0]?1:r<ue[1]?2:r<ue[2]?3:r<ue[3]?5:9};Xa.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function gn(e,t,r,n){Ar(e,t,r+n);let i=Za(e,t+r,t+r+n);return new M(C.bytes,i,r+n)}function gE(e,t,r,n){return gn(e,t,1,r)}function bE(e,t,r,n){return gn(e,t,2,Pt(e,t+1,n))}function mE(e,t,r,n){return gn(e,t,3,Rt(e,t+1,n))}function vE(e,t,r,n){return gn(e,t,5,Ht(e,t+1,n))}function kE(e,t,r,n){let i=Vt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${H} 64-bit integer bytes lengths not supported`);return gn(e,t,9,i)}function Ei(e){return e.encodedBytes===void 0&&(e.encodedBytes=e.type===C.string?nE(e.value):e.value),e.encodedBytes}function to(e,t){let r=Ei(t);Ie(e,t.type.majorEncoded,r.length),e.push(r)}to.encodedSize=function(e){let t=Ei(e);return Ie.encodedSize(t.length)+t.length};to.compareTokens=function(e,t){return EE(Ei(e),Ei(t))};function EE(e,t){return e.length<t.length?-1:e.length>t.length?1:sE(e,t)}function bn(e,t,r,n,i){let o=r+n;Ar(e,t,o);let s=new M(C.string,rE(e,t+r,t+o),o);return i.retainStringBytes===!0&&(s.byteValue=Za(e,t+r,t+o)),s}function SE(e,t,r,n){return bn(e,t,1,r,n)}function xE(e,t,r,n){return bn(e,t,2,Pt(e,t+1,n),n)}function AE(e,t,r,n){return bn(e,t,3,Rt(e,t+1,n),n)}function CE(e,t,r,n){return bn(e,t,5,Ht(e,t+1,n),n)}function TE(e,t,r,n){let i=Vt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${H} 64-bit integer string lengths not supported`);return bn(e,t,9,i,n)}var BE=to;function Cr(e,t,r,n){return new M(C.array,n,r)}function FE(e,t,r,n){return Cr(e,t,1,r)}function _E(e,t,r,n){return Cr(e,t,2,Pt(e,t+1,n))}function LE(e,t,r,n){return Cr(e,t,3,Rt(e,t+1,n))}function IE(e,t,r,n){return Cr(e,t,5,Ht(e,t+1,n))}function UE(e,t,r,n){let i=Vt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${H} 64-bit integer array lengths not supported`);return Cr(e,t,9,i)}function DE(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${H} indefinite length items not allowed`);return Cr(e,t,1,1/0)}function el(e,t){Ie(e,C.array.majorEncoded,t.value)}el.compareTokens=qt.compareTokens;el.encodedSize=function(e){return Ie.encodedSize(e.value)};function Tr(e,t,r,n){return new M(C.map,n,r)}function NE(e,t,r,n){return Tr(e,t,1,r)}function jE(e,t,r,n){return Tr(e,t,2,Pt(e,t+1,n))}function zE(e,t,r,n){return Tr(e,t,3,Rt(e,t+1,n))}function ME(e,t,r,n){return Tr(e,t,5,Ht(e,t+1,n))}function OE(e,t,r,n){let i=Vt(e,t+1,n);if(typeof i=="bigint")throw new Error(`${H} 64-bit integer map lengths not supported`);return Tr(e,t,9,i)}function $E(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${H} indefinite length items not allowed`);return Tr(e,t,1,1/0)}function tl(e,t){Ie(e,C.map.majorEncoded,t.value)}tl.compareTokens=qt.compareTokens;tl.encodedSize=function(e){return Ie.encodedSize(e.value)};function PE(e,t,r,n){return new M(C.tag,r,1)}function RE(e,t,r,n){return new M(C.tag,Pt(e,t+1,n),2)}function HE(e,t,r,n){return new M(C.tag,Rt(e,t+1,n),3)}function VE(e,t,r,n){return new M(C.tag,Ht(e,t+1,n),5)}function qE(e,t,r,n){return new M(C.tag,Vt(e,t+1,n),9)}function rl(e,t){Ie(e,C.tag.majorEncoded,t.value)}rl.compareTokens=qt.compareTokens;rl.encodedSize=function(e){return Ie.encodedSize(e.value)};var WE=20,GE=21,KE=22,JE=23;function QE(e,t,r,n){if(n.allowUndefined===!1)throw new Error(`${H} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new M(C.null,null,1):new M(C.undefined,void 0,1)}function ZE(e,t,r,n){if(n.allowIndefinite===!1)throw new Error(`${H} indefinite length items not allowed`);return new M(C.break,void 0,1)}function nl(e,t,r){if(r){if(r.allowNaN===!1&&Number.isNaN(e))throw new Error(`${H} NaN values are not supported`);if(r.allowInfinity===!1&&(e===1/0||e===-1/0))throw new Error(`${H} Infinity values are not supported`)}return new M(C.float,e,t)}function YE(e,t,r,n){return nl(ol(e,t+1),3,n)}function XE(e,t,r,n){return nl(sl(e,t+1),5,n)}function e3(e,t,r,n){return nl(mp(e,t+1),9,n)}function il(e,t,r){let n=t.value;if(n===!1)e.push([C.float.majorEncoded|WE]);else if(n===!0)e.push([C.float.majorEncoded|GE]);else if(n===null)e.push([C.float.majorEncoded|KE]);else if(n===void 0)e.push([C.float.majorEncoded|JE]);else{let i,o=!1;(!r||r.float64!==!0)&&(gp(n),i=ol(ze,1),n===i||Number.isNaN(n)?(ze[0]=249,e.push(ze.slice(0,3)),o=!0):(bp(n),i=sl(ze,1),n===i&&(ze[0]=250,e.push(ze.slice(0,5)),o=!0))),o||(t3(n),i=mp(ze,1),ze[0]=251,e.push(ze.slice(0,9)))}}il.encodedSize=function(e,t){let r=e.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!t||t.float64!==!0){gp(r);let n=ol(ze,1);if(r===n||Number.isNaN(r))return 3;if(bp(r),n=sl(ze,1),r===n)return 5}return 9};var wp=new ArrayBuffer(9),Be=new DataView(wp,1),ze=new Uint8Array(wp,0);function gp(e){if(e===1/0)Be.setUint16(0,31744,!1);else if(e===-1/0)Be.setUint16(0,64512,!1);else if(Number.isNaN(e))Be.setUint16(0,32256,!1);else{Be.setFloat32(0,e);let t=Be.getUint32(0),r=(t&2139095040)>>23,n=t&8388607;if(r===255)Be.setUint16(0,31744,!1);else if(r===0)Be.setUint16(0,(e&2147483648)>>16|n>>13,!1);else{let i=r-127;i<-24?Be.setUint16(0,0):i<-14?Be.setUint16(0,(t&2147483648)>>16|1<<24+i,!1):Be.setUint16(0,(t&2147483648)>>16|i+15<<10|n>>13,!1)}}}function ol(e,t){if(e.length-t<2)throw new Error(`${H} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,i=r&1023,o;return n===0?o=i*2**-24:n!==31?o=(i+1024)*2**(n-25):o=i===0?1/0:NaN,r&32768?-o:o}function bp(e){Be.setFloat32(0,e,!1)}function sl(e,t){if(e.length-t<4)throw new Error(`${H} not enough data for float32`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function t3(e){Be.setFloat64(0,e,!1)}function mp(e,t){if(e.length-t<8)throw new Error(`${H} not enough data for float64`);let r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}il.compareTokens=qt.compareTokens;function G(e,t,r){throw new Error(`${H} encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function ro(e){return()=>{throw new Error(`${H} ${e}`)}}var U=[];for(let e=0;e<=23;e++)U[e]=G;U[24]=uE;U[25]=cE;U[26]=hE;U[27]=fE;U[28]=G;U[29]=G;U[30]=G;U[31]=G;for(let e=32;e<=55;e++)U[e]=G;U[56]=dE;U[57]=pE;U[58]=yE;U[59]=wE;U[60]=G;U[61]=G;U[62]=G;U[63]=G;for(let e=64;e<=87;e++)U[e]=gE;U[88]=bE;U[89]=mE;U[90]=vE;U[91]=kE;U[92]=G;U[93]=G;U[94]=G;U[95]=ro("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)U[e]=SE;U[120]=xE;U[121]=AE;U[122]=CE;U[123]=TE;U[124]=G;U[125]=G;U[126]=G;U[127]=ro("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)U[e]=FE;U[152]=_E;U[153]=LE;U[154]=IE;U[155]=UE;U[156]=G;U[157]=G;U[158]=G;U[159]=DE;for(let e=160;e<=183;e++)U[e]=NE;U[184]=jE;U[185]=zE;U[186]=ME;U[187]=OE;U[188]=G;U[189]=G;U[190]=G;U[191]=$E;for(let e=192;e<=215;e++)U[e]=PE;U[216]=RE;U[217]=HE;U[218]=VE;U[219]=qE;U[220]=G;U[221]=G;U[222]=G;U[223]=G;for(let e=224;e<=243;e++)U[e]=ro("simple values are not supported");U[244]=G;U[245]=G;U[246]=G;U[247]=QE;U[248]=ro("simple values are not supported");U[249]=YE;U[250]=XE;U[251]=e3;U[252]=G;U[253]=G;U[254]=G;U[255]=ZE;var Pe=[];for(let e=0;e<24;e++)Pe[e]=new M(C.uint,e,1);for(let e=-1;e>=-24;e--)Pe[31-e]=new M(C.negint,e,1);Pe[64]=new M(C.bytes,new Uint8Array(0),1);Pe[96]=new M(C.string,"",1);Pe[128]=new M(C.array,0,1);Pe[160]=new M(C.map,0,1);Pe[244]=new M(C.false,!1,1);Pe[245]=new M(C.true,!0,1);Pe[246]=new M(C.null,null,1);function r3(e){switch(e.type){case C.false:return Ve([244]);case C.true:return Ve([245]);case C.null:return Ve([246]);case C.bytes:return e.value.length?void 0:Ve([64]);case C.string:return e.value===""?Ve([96]):void 0;case C.array:return e.value===0?Ve([128]):void 0;case C.map:return e.value===0?Ve([160]):void 0;case C.uint:return e.value<24?Ve([Number(e.value)]):void 0;case C.negint:if(e.value>=-24)return Ve([31-Number(e.value)])}}var n3={float64:!1,mapSorter:s3,quickEncodeToken:r3};function i3(){let e=[];return e[C.uint.major]=qt,e[C.negint.major]=Xa,e[C.bytes.major]=to,e[C.string.major]=BE,e[C.array.major]=el,e[C.map.major]=tl,e[C.tag.major]=rl,e[C.float.major]=il,e}var vp=i3(),To=new dp,Xu=class kp{constructor(t,r){this.obj=t,this.parent=r}includes(t){let r=this;do if(r.obj===t)return!0;while(r=r.parent);return!1}static createCheck(t,r){if(t&&t.includes(r))throw new Error(`${pp} object contains circular references`);return new kp(r,t)}},ot={null:new M(C.null,null),undefined:new M(C.undefined,void 0),true:new M(C.true,!0),false:new M(C.false,!1),emptyArray:new M(C.array,0),emptyMap:new M(C.map,0)},vt={number(e,t,r,n){return!Number.isInteger(e)||!Number.isSafeInteger(e)?new M(C.float,e):e>=0?new M(C.uint,e):new M(C.negint,e)},bigint(e,t,r,n){return e>=BigInt(0)?new M(C.uint,e):new M(C.negint,e)},Uint8Array(e,t,r,n){return new M(C.bytes,e)},string(e,t,r,n){return new M(C.string,e)},boolean(e,t,r,n){return e?ot.true:ot.false},null(e,t,r,n){return ot.null},undefined(e,t,r,n){return ot.undefined},ArrayBuffer(e,t,r,n){return new M(C.bytes,new Uint8Array(e))},DataView(e,t,r,n){return new M(C.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,r,n){if(!e.length)return r.addBreakTokens===!0?[ot.emptyArray,new M(C.break)]:ot.emptyArray;n=Xu.createCheck(n,e);let i=[],o=0;for(let s of e)i[o++]=qn(s,r,n);return r.addBreakTokens?[new M(C.array,e.length),i,new M(C.break)]:[new M(C.array,e.length),i]},Object(e,t,r,n){let i=t!=="Object",o=i?e.keys():Object.keys(e),s=i?e.size:o.length;if(!s)return r.addBreakTokens===!0?[ot.emptyMap,new M(C.break)]:ot.emptyMap;n=Xu.createCheck(n,e);let a=[],l=0;for(let u of o)a[l++]=[qn(u,r,n),qn(i?e.get(u):e[u],r,n)];return o3(a,r),r.addBreakTokens?[new M(C.map,s),a,new M(C.break)]:[new M(C.map,s),a]}};vt.Map=vt.Object;vt.Buffer=vt.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))vt[`${e}Array`]=vt.DataView;function qn(e,t={},r){let n=Z5(e),i=t&&t.typeEncoders&&t.typeEncoders[n]||vt[n];if(typeof i=="function"){let s=i(e,n,t,r);if(s!=null)return s}let o=vt[n];if(!o)throw new Error(`${pp} unsupported type: ${n}`);return o(e,n,t,r)}function o3(e,t){t.mapSorter&&e.sort(t.mapSorter)}function s3(e,t){let r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);let i=r.type.major,o=vp[i].compareTokens(r,n);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function Ep(e,t,r,n){if(Array.isArray(t))for(let i of t)Ep(e,i,r,n);else r[t.type.major](e,t,n)}function a3(e,t,r){let n=qn(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){let i=r.quickEncodeToken(n);if(i)return i;let o=t[n.type.major];if(o.encodedSize){let s=o.encodedSize(n,r),a=new dp(s);if(o(a,n,r),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return fp(a.chunks[0])}}return To.reset(),Ep(To,n,t,r),To.toBytes(!0)}function l3(e,t){return t=Object.assign({},n3,t),a3(e,vp,t)}var u3={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},c3=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Pe[e];if(t===void 0){let r=U[e];if(!r)throw new Error(`${H} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let n=e&31;t=r(this.data,this.pos,n,this.options)}return this.pos+=t.encodedLength,t}},Qr=Symbol.for("DONE"),no=Symbol.for("BREAK");function h3(e,t,r){let n=[];for(let i=0;i<e.value;i++){let o=Zr(t,r);if(o===no){if(e.value===1/0)break;throw new Error(`${H} got unexpected break to lengthed array`)}if(o===Qr)throw new Error(`${H} found array but not enough entries (got ${i}, expected ${e.value})`);n[i]=o}return n}function f3(e,t,r){let n=r.useMaps===!0,i=n?void 0:{},o=n?new Map:void 0;for(let s=0;s<e.value;s++){let a=Zr(t,r);if(a===no){if(e.value===1/0)break;throw new Error(`${H} got unexpected break to lengthed map`)}if(a===Qr)throw new Error(`${H} found map but not enough entries (got ${s} [no key], expected ${e.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${H} non-string keys not supported (got ${typeof a})`);if(r.rejectDuplicateMapKeys===!0&&(n&&o.has(a)||!n&&a in i))throw new Error(`${H} found repeat map key "${a}"`);let l=Zr(t,r);if(l===Qr)throw new Error(`${H} found map but not enough entries (got ${s} [no value], expected ${e.value})`);n?o.set(a,l):i[a]=l}return n?o:i}function Zr(e,t){if(e.done())return Qr;let r=e.next();if(r.type===C.break)return no;if(r.type.terminal)return r.value;if(r.type===C.array)return h3(r,e,t);if(r.type===C.map)return f3(r,e,t);if(r.type===C.tag){if(t.tags&&typeof t.tags[r.value]=="function"){let n=Zr(e,t);return t.tags[r.value](n)}throw new Error(`${H} tag not supported (${r.value})`)}throw new Error("unsupported")}function d3(e,t){if(!(e instanceof Uint8Array))throw new Error(`${H} data to decode must be a Uint8Array`);t=Object.assign({},u3,t);let r=t.tokenizer||new c3(e,t),n=Zr(r,t);if(n===Qr)throw new Error(`${H} did not find any content to decode`);if(n===no)throw new Error(`${H} got unexpected break`);if(!r.done())throw new Error(`${H} too many terminals, data makes no sense`);return n}var p3=Sp,ec=128,y3=127,w3=~y3,g3=Math.pow(2,31);function Sp(e,t,r){t=t||[],r=r||0;for(var n=r;e>=g3;)t[r++]=e&255|ec,e/=128;for(;e&w3;)t[r++]=e&255|ec,e>>>=7;return t[r]=e|0,Sp.bytes=r-n+1,t}var b3=us,m3=128,tc=127;function us(e,n){var r=0,n=n||0,i=0,o=n,s,a=e.length;do{if(o>=a)throw us.bytes=0,new RangeError("Could not decode varint");s=e[o++],r+=i<28?(s&tc)<<i:(s&tc)*Math.pow(2,i),i+=7}while(s>=m3);return us.bytes=o-n,r}var v3=Math.pow(2,7),k3=Math.pow(2,14),E3=Math.pow(2,21),S3=Math.pow(2,28),x3=Math.pow(2,35),A3=Math.pow(2,42),C3=Math.pow(2,49),T3=Math.pow(2,56),B3=Math.pow(2,63),F3=function(e){return e<v3?1:e<k3?2:e<E3?3:e<S3?4:e<x3?5:e<A3?6:e<C3?7:e<T3?8:e<B3?9:10},_3={encode:p3,decode:b3,encodingLength:F3},L3=_3,Si=L3,cs=(e,t=0)=>[Si.decode(e,t),Si.decode.bytes],xi=(e,t,r=0)=>(Si.encode(e,t,r),t),Ai=e=>Si.encodingLength(e),iS=new Uint8Array(0),I3=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},al=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},U3=(e,t)=>{let r=t.byteLength,n=Ai(e),i=n+Ai(r),o=new Uint8Array(i+r);return xi(e,o,0),xi(r,o,n),o.set(t,i),new ll(e,r,t,o)},D3=e=>{let t=al(e),[r,n]=cs(t),[i,o]=cs(t.subarray(n)),s=t.subarray(n+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new ll(r,i,s,t)},N3=(e,t)=>{if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&I3(e.bytes,r.bytes)}},ll=class{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}};function j3(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(r[s]!==255)throw new TypeError(o+" is ambiguous");r[s]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var h=0,y=0,g=0,m=d.length;g!==m&&d[g]===0;)g++,h++;for(var b=(m-g)*c+1>>>0,v=new Uint8Array(b);g!==m;){for(var S=d[g],T=0,B=b-1;(S!==0||T<y)&&B!==-1;B--,T++)S+=256*v[B]>>>0,v[B]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");y=T,g++}for(var N=b-y;N!==b&&v[N]===0;)N++;for(var L=l.repeat(h);N<b;++N)L+=e.charAt(v[N]);return L}function w(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var h=0;if(d[h]!==" "){for(var y=0,g=0;d[h]===l;)y++,h++;for(var m=(d.length-h)*u+1>>>0,b=new Uint8Array(m);d[h];){var v=r[d.charCodeAt(h)];if(v===255)return;for(var S=0,T=m-1;(v!==0||S<g)&&T!==-1;T--,S++)v+=a*b[T]>>>0,b[T]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=S,h++}if(d[h]!==" "){for(var B=m-g;B!==m&&b[B]===0;)B++;for(var N=new Uint8Array(y+(m-B)),L=y;B!==m;)N[L++]=b[B++];return N}}}function p(d){var h=w(d);if(h)return h;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:w,decode:p}}var z3=j3,M3=z3,O3=M3,$3=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},P3=class{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xp(this,e)}},R3=class{constructor(e){this.decoders=e}or(e){return xp(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},xp=(e,t)=>new R3({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}}),H3=class{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new $3(e,t,r),this.decoder=new P3(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Ap=({name:e,prefix:t,encode:r,decode:n})=>new H3(e,t,r,n),Cp=({prefix:e,name:t,alphabet:r})=>{let{encode:n,decode:i}=O3(r,t);return Ap({prefix:e,name:t,encode:n,decode:o=>al(i(o))})},V3=(e,t,r,n)=>{let i={};for(let c=0;c<t.length;++c)i[t[c]]=c;let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),a=0,l=0,u=0;for(let c=0;c<o;++c){let f=i[e[c]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);l=l<<r|f,a+=r,a>=8&&(a-=8,s[u++]=255&l>>a)}if(a>=r||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s},q3=(e,t,r)=>{let n=t[t.length-1]==="=",i=(1<<r)-1,o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>r;)s-=r,o+=t[i&a>>s];if(s&&(o+=t[i&a<<r-s]),n)for(;o.length*r&7;)o+="=";return o},rt=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Ap({prefix:t,name:e,encode(i){return q3(i,n,r)},decode(i){return V3(i,n,r,e)}}),ht=Cp({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),oS=Cp({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Wn=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sS=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),aS=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),lS=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),uS=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cS=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hS=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fS=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),dS=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),rc=(e,t)=>{let{bytes:r,version:n}=e;switch(n){case 0:return G3(r,hs(e),t||ht.encoder);default:return K3(r,hs(e),t||Wn.encoder)}},nc=new WeakMap,hs=e=>{let t=nc.get(e);if(t==null){let r=new Map;return nc.set(e,r),r}return t},Tp=class ge{constructor(t,r,n,i){this.code=r,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Ur)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==J3)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ge.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=U3(t,r);return ge.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return ge.equals(this,t)}static equals(t,r){let n=r;return n&&t.code===n.code&&t.version===n.version&&N3(t.multihash,n.multihash)}toString(t){return rc(this,t)}toJSON(){return{"/":rc(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof ge)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:i,multihash:o,bytes:s}=r;return new ge(n,i,o,s||ic(n,i,o.bytes))}else if(r[Q3]===!0){let{version:n,multihash:i,code:o}=r,s=D3(i);return ge.create(n,o,s)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Ur)throw new Error(`Version 0 CID must use dag-pb (code: ${Ur}) block encoding`);return new ge(t,r,n,n.bytes)}case 1:{let i=ic(t,r,n.bytes);return new ge(t,r,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return ge.create(0,Ur,t)}static createV1(t,r){return ge.create(1,t,r)}static decode(t){let[r,n]=ge.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=ge.inspectBytes(t),n=r.size-r.multihashSize,i=al(t.subarray(n,n+r.multihashSize));if(i.byteLength!==r.multihashSize)throw new Error("Incorrect length");let o=i.subarray(r.multihashSize-r.digestSize),s=new ll(r.multihashCode,r.digestSize,o,i);return[r.version===0?ge.createV0(s):ge.createV1(r.codec,s),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[f,w]=cs(t.subarray(r));return r+=w,f},i=n(),o=Ur;if(i===18?(i=0,r=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let s=r,a=n(),l=n(),u=r+l,c=u-s;return{version:i,codec:o,multihashCode:a,digestSize:l,multihashSize:c,size:u}}static parse(t,r){let[n,i]=W3(t,r),o=ge.decode(i);if(o.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return hs(o).set(n,t),o}},W3=(e,t)=>{switch(e[0]){case"Q":{let r=t||ht;return[ht.prefix,r.decode(`${ht.prefix}${e}`)]}case ht.prefix:{let r=t||ht;return[ht.prefix,r.decode(e)]}case Wn.prefix:{let r=t||Wn;return[Wn.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}},G3=(e,t,r)=>{let{prefix:n}=r;if(n!==ht.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let i=t.get(n);if(i==null){let o=r.encode(e).slice(1);return t.set(n,o),o}else return i},K3=(e,t,r)=>{let{prefix:n}=r,i=t.get(n);if(i==null){let o=r.encode(e);return t.set(n,o),o}else return i},Ur=112,J3=18,ic=(e,t,r)=>{let n=Ai(e),i=n+Ai(t),o=new Uint8Array(i+r.byteLength);return xi(e,o,0),xi(t,o,n),o.set(r,i),o},Q3=Symbol.for("@ipld/js-cid/CID"),Bp=42;function Z3(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=Tp.asCID(e);if(!t)return null;let r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new M(C.tag,Bp),new M(C.bytes,r)]}function Y3(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function X3(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var e4={float64:!0,typeEncoders:{Object:Z3,undefined:Y3,number:X3}};function t4(e){if(e[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Tp.decode(e.subarray(1))}var Fp={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Fp.tags[Bp]=t4;var r4="dag-cbor",n4=113,i4=e=>l3(e,e4),o4=e=>d3(e,Fp),s4=class extends yn{constructor({cid:e,value:t,bytes:r,prefix:n}){super({cid:e,value:t,bytes:r}),this.prefix=n}static create(e,t){return a4({data:e,parents:t??[]})}};async function a4(e){let{cid:t,bytes:r}=await G5({value:e,codec:Qa,hasher:hp});return new yn({cid:t,value:e,bytes:r})}async function l4(e){let{cid:t,value:r}=await K5({bytes:e,codec:Qa,hasher:hp});return new yn({cid:t,value:r,bytes:e})}var u4=(e,t)=>Ye.parse(e,t),Ke,oc=class{constructor(e){sy(this,Ke,new Map),e&&ay(this,Ke,new Map(e.map(t=>[t.cid.toString(),t.bytes])))}async get(e){let t=Zt(this,Ke).get(e.toString());if(t)return{cid:e,bytes:t}}async put(e,t){Zt(this,Ke).set(e.toString(),t)}putSync(e,t){Zt(this,Ke).set(e.toString(),t)}async delete(e){Zt(this,Ke).delete(e.toString())}deleteSync(e){Zt(this,Ke).delete(e.toString())}*entries(){for(let[e,t]of Zt(this,Ke))yield{cid:u4(e),bytes:t}}};Ke=new WeakMap;function c4(e){return e.fileStore!==void 0}var io=class{constructor(){Ee(this,"ready"),Ee(this,"loaded"),Ee(this,"eventBlocks",new oc),Ee(this,"parents",[]),Ee(this,"loader"),this.ready=Promise.resolve(),this.loaded=Promise.resolve()}async refresh(){await this.loader.remoteMetaStore.load("main"),await this.loader.remoteWAL?._process()}connect(e){this.loader=e,this.connectStorage(e),this.connectMeta(e)}connectMeta(e){this.loader=e;let t=new s5(e.name,this);t.onLoad("main",async r=>{r&&await e.handleDbMetasFromStore(r)}),e.remoteMetaStore=t,this.loaded=e.ready.then(async()=>{e.remoteMetaLoading=t.load("main").then(()=>{}),e.remoteMetaLoading.then(()=>{this.loader.remoteWAL?._process()})})}connectStorage(e){this.loader=e,e.remoteCarStore=new Vu(e.name,this),c4(e)&&(e.remoteFileStore=new Vu(e.name,this,"file"))}async createEventBlock(e){let t={dbMeta:e},r=await s4.create(t,this.parents),n=new oc;return await this.eventBlocks.put(r.cid,r.bytes),await n.put(r.cid,r.bytes),r}async decodeEventBlock(e){return await l4(e)}},Xt=oy(ly(),1),h4=class extends io{constructor(e,t){super(),Ee(this,"uploadUrl"),Ee(this,"downloadUrl"),this.uploadUrl=new URL(e),this.downloadUrl=new URL(t)}async dataUpload(e,t){sc(t);let r=new URL(`${this.uploadUrl.toString()}?${new URLSearchParams({cache:Math.random().toString(),...t}).toString()}`),n=await(0,Xt.default)(r);if(!n.ok)throw new Error("failed to get upload url for data "+new Date().toISOString()+" "+n.statusText);let{uploadURL:i}=await n.json(),o=await(0,Xt.default)(i,{method:"PUT",body:e});if(!o.ok)throw new Error("failed to upload data "+o.statusText)}async metaUpload(e,t){ac(t);let r=new URL(`${this.uploadUrl.toString()}?${new URLSearchParams({type:"meta",...t}).toString()}`),n=await(0,Xt.default)(r);if(!n.ok)throw new Error("failed to get upload url for meta");let{uploadURL:i}=await n.json();if(!i)throw new Error("missing uploadURL");let o=await(0,Xt.default)(i,{method:"PUT",body:e});if(!o.ok)throw new Error("failed to upload data "+o.statusText);return null}async dataDownload(e){sc(e);let{type:t,name:r,car:n}=e,i=new URL(`${t}/${r}/${n}.car`,this.downloadUrl),o=await(0,Xt.default)(i);return o.ok?new Uint8Array(await o.arrayBuffer()):null}async metaDownload(e){ac(e);let{name:t,branch:r}=e,n=new URL(`meta/${t}/${r+".json?cache="+Math.floor(Math.random()*1e6)}`,this.downloadUrl),i=await(0,Xt.default)(n);return i.ok?[new Uint8Array(await i.arrayBuffer())]:null}},f4=class extends io{constructor({metaUpload:e,metaDownload:t,dataUpload:r,dataDownload:n}){super(),this.metaUpload=e,this.metaDownload=t,this.dataUpload=r,this.dataDownload=n}},pS={s3:({_crdt:{blocks:{loader:e}}},{upload:t,download:r})=>{let n=new h4(t,r);return n.connect(e),n},raw:({_crdt:{blocks:{loader:e}}},t)=>{let r=new f4(t);return r.connect(e),r}};function sc(e){let{type:t,name:r,car:n}=e;if(!r)throw new Error("name is required");if(!n)throw new Error("car is required");if(t!=="file"&&t!=="data")throw new Error("type must be file or data")}function ac(e){let{name:t,branch:r}=e;if(!t)throw new Error("name is required");if(!r)throw new Error("branch is required")}var mn=class extends io{constructor(r){super();cl(this,"name");this.name=r}async dataUpload(r,{car:n}){let i=new URL(`/fireproof?car=${n}`,document.location.origin),o=Fr.fromUint8Array(r),s=await fetch(i,{method:"PUT",body:o});if(!s.ok)throw new Error("failed to upload data "+s.statusText)}async dataDownload({car:r}){let n=new URL(`/fireproof?car=${r}`,document.location.origin),i=await fetch(n);if(!i.ok)throw new Error("failed to download data "+i.statusText);let o=await i.text();return Fr.toUint8Array(o)}async metaUpload(r,{name:n}){let i=await this.createEventBlock(r),o=Fr.fromUint8Array(i.bytes),s={cid:i.cid.toString(),data:o,parents:this.parents.map(u=>u.toString())},a=new URL(`/fireproof?meta=${n}`,document.location.origin),l=await fetch(a,{method:"PUT",body:JSON.stringify(s)});if(!l.ok)throw new Error("failed to upload meta "+l.statusText);return this.parents=[i.cid],null}async metaDownload({name:r}){let n=new URL(`/fireproof?meta=${r}`,document.location.origin),i=await fetch(n);if(!i.ok)throw new Error("failed to download meta "+i.statusText);let o=await i.json(),s=await Promise.all(o.map(async u=>{let c=u.data,f=Fr.toUint8Array(c);return await this.createEventBlock(f)})),a=s.map(u=>u.cid),l=new Map([...this.parents,...a].map(u=>[u.toString(),u]));return this.parents=Array.from(l.values()),s.map(u=>u.bytes)}};var ul=new Map;var d4={netlify:(e,t,r)=>{let{name:n,_crdt:{blocks:{loader:i}}}=e;if(!n)throw new Error("database name is required");if(!r&&ul.has(n))return ul.get(n);let o=new mn(n);return o.connect(i),ul.set(n,o),o}};return zp(p4);})();
/*! Bundled license information:

uuidv7/dist/index.js:
  (**
   * uuidv7: An experimental implementation of the proposed UUID Version 7
   *
   * @license Apache-2.0
   * @copyright 2021-2023 LiosK
   * @packageDocumentation
   *)
*/
//# sourceMappingURL=index.iife.js.map
